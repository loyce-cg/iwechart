!function t(e,s,n){function i(o,r){if(!s[o]){if(!e[o]){var l="function"==typeof require&&require;if(!r&&l)return l(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=s[o]={exports:{}};e[o][0].call(d.exports,(function(t){return i(e[o][1][t]||t)}),d,d.exports,t,e,s,n)}return s[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(t,e,s){var n=privmxViewRequire("privmx-view");e.exports=n},{}],2:[function(t,e,s){(function(t){!function(t,n){"object"==typeof s&&void 0!==e?e.exports=n():"function"==typeof define&&define.amd?define(n):t.ResizeObserver=n()}(this,(function(){"use strict";var e=function(){if("undefined"!=typeof Map)return Map;function t(t,e){var s=-1;return t.some((function(t,n){return t[0]===e&&(s=n,!0)})),s}return(function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var s=t(this.__entries__,e),n=this.__entries__[s];return n&&n[1]},e.prototype.set=function(e,s){var n=t(this.__entries__,e);~n?this.__entries__[n][1]=s:this.__entries__.push([e,s])},e.prototype.delete=function(e){var s=this.__entries__,n=t(s,e);~n&&s.splice(n,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var s=0,n=this.__entries__;s<n.length;s++){var i=n[s];t.call(e,i[1],i[0])}},e}())}(),s="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,n=void 0!==t&&t.Math===Math?t:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),i="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(n):function(t){return setTimeout((function(){return t(Date.now())}),1e3/60)};var a=["top","right","bottom","left","width","height","size","weight"],o="undefined"!=typeof MutationObserver,r=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var s=!1,n=!1,a=0;function o(){s&&(s=!1,t()),n&&l()}function r(){i(o)}function l(){var t=Date.now();if(s){if(t-a<2)return;n=!0}else s=!0,n=!1,setTimeout(r,e);a=t}return l}(this.refresh.bind(this),20)}return t.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},t.prototype.removeObserver=function(t){var e=this.observers_,s=e.indexOf(t);~s&&e.splice(s,1),!e.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},t.prototype.updateObservers_=function(){var t=this.observers_.filter((function(t){return t.gatherActive(),t.hasActive()}));return t.forEach((function(t){return t.broadcastActive()})),t.length>0},t.prototype.connect_=function(){s&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),o?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){s&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(t){var e=t.propertyName,s=void 0===e?"":e;a.some((function(t){return!!~s.indexOf(t)}))&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),l=function(t,e){for(var s=0,n=Object.keys(e);s<n.length;s++){var i=n[s];Object.defineProperty(t,i,{value:e[i],enumerable:!1,writable:!1,configurable:!0})}return t},c=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||n},d=g(0,0,0,0);function p(t){return parseFloat(t)||0}function h(t){for(var e=[],s=1;s<arguments.length;s++)e[s-1]=arguments[s];return e.reduce((function(e,s){return e+p(t["border-"+s+"-width"])}),0)}function u(t){var e=t.clientWidth,s=t.clientHeight;if(!e&&!s)return d;var n=c(t).getComputedStyle(t),i=function(t){for(var e={},s=0,n=["top","right","bottom","left"];s<n.length;s++){var i=n[s],a=t["padding-"+i];e[i]=p(a)}return e}(n),a=i.left+i.right,o=i.top+i.bottom,r=p(n.width),l=p(n.height);if("border-box"===n.boxSizing&&(Math.round(r+a)!==e&&(r-=h(n,"left","right")+a),Math.round(l+o)!==s&&(l-=h(n,"top","bottom")+o)),!function(t){return t===c(t).document.documentElement}(t)){var u=Math.round(r+a)-e,m=Math.round(l+o)-s;1!==Math.abs(u)&&(r-=u),1!==Math.abs(m)&&(l-=m)}return g(i.left,i.top,r,l)}var m="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof c(t).SVGGraphicsElement}:function(t){return t instanceof c(t).SVGElement&&"function"==typeof t.getBBox};function f(t){return s?m(t)?function(t){var e=t.getBBox();return g(0,0,e.width,e.height)}(t):u(t):d}function g(t,e,s,n){return{x:t,y:e,width:s,height:n}}var k=function(){function t(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=g(0,0,0,0),this.target=t}return t.prototype.isActive=function(){var t=f(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},t}(),v=function(t,e){var s,n,i,a,o,r,c,d=(n=(s=e).x,i=s.y,a=s.width,o=s.height,r="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,c=Object.create(r.prototype),l(c,{x:n,y:i,width:a,height:o,top:i,right:n+a,bottom:o+i,left:n}),c);l(this,{target:t,contentRect:d})},y=function(){function t(t,s,n){if(this.activeObservations_=[],this.observations_=new e,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=s,this.callbackCtx_=n}return t.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof c(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new k(t)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof c(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach((function(e){e.isActive()&&t.activeObservations_.push(e)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map((function(t){return new v(t.target,t.broadcastRect())}));this.callback_.call(t,e,t),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),b="undefined"!=typeof WeakMap?new WeakMap:new e,T=function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var s=r.getInstance(),n=new y(e,s,this);b.set(this,n)};return["observe","unobserve","disconnect"].forEach((function(t){T.prototype[t]=function(){var e;return(e=b.get(this))[t].apply(e,arguments)}})),void 0!==n.ResizeObserver?n.ResizeObserver:T}))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("../window/main/MainWindowView"),i=t("../window/tasks/TasksWindowView"),a=t("../window/taskGroupForm/TaskGroupFormWindowView"),o=t("../window/task/TaskWindowView"),r=t("../window/taskGroupSelector/TaskGroupSelectorWindowView"),l=t("../component/taskGroupsPanel/TaskGroupsPanelView"),c=t("pmc-web"),d=t("../component/taskPanel/TaskPanelView"),p=t("../main/FastListCreator"),h=t("../component/iconPicker/IconPickerData"),u=t("../window/detachTaskGroup/DetachTaskGroupWindowView"),m=t("../window/iconPicker/IconPickerWindowView");c.Starter.objectFactory.register(u.DetachTaskGroupWindowView),c.Starter.objectFactory.register(m.IconPickerWindowView),c.Starter.objectFactory.register(n.MainWindowView),c.Starter.objectFactory.register(i.TasksWindowView),c.Starter.objectFactory.register(a.TaskGroupFormWindowView),c.Starter.objectFactory.register(o.TaskWindowView),c.Starter.objectFactory.register(r.TaskGroupSelectorWindowView),c.Starter.addEventListener("instanceregistered",(function(t){if(t.instance&&"com.privmx.core.window.sectionsummary.SectionSummaryWindowView"==t.instance.className){var e=new l.TaskGroupsPanelView(t.instance,t.instance.personsComponent,!0);e.$container=c.JQuery('<div class="tasks-component taskgroupspanel-container"></div>'),t.instance.registerModule("tasks",e)}}),"tasks","ethernal"),c.Starter.addEventListener("request-task-panel-view",(function(t){var e=new d.TaskPanelView(t.parent,t.parent.personsComponent);t.parent.registerPreview(t.name,e)}),"tasks","ethernal"),c.Starter.addEventListener("request-fast-list-creator",(function(t){var e=new p.FastListCreator;t.parent.registerFastListCreator(t.name,e)}),"tasks","ethernal"),c.Starter.addEventListener("request-icon-picker-data",(function(t){var e={items:h.IconPickerData.items,colors:h.IconPickerData.colors};t.parent.registerIconPickerData(t.name,e)}),"tasks","ethernal")},{"../component/iconPicker/IconPickerData":4,"../component/taskGroupsPanel/TaskGroupsPanelView":6,"../component/taskPanel/TaskPanelView":11,"../main/FastListCreator":17,"../window/detachTaskGroup/DetachTaskGroupWindowView":27,"../window/iconPicker/IconPickerWindowView":29,"../window/main/MainWindowView":32,"../window/task/TaskWindowView":34,"../window/taskGroupForm/TaskGroupFormWindowView":36,"../window/taskGroupSelector/TaskGroupSelectorWindowView":39,"../window/tasks/TasksWindowView":43,"pmc-web":1}],4:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=function(){function t(){}return t.splitIconStr=function(t){var e=JSON.parse(t);return{icon:"fa"==e.type?'{"type":"fa","fa":"'+e.fa+'"}':'{"type":"shape","shape":"'+e.shape+'"}',color:e.color}},t.items=[null,'{"type":"fa","fa":"circle"}','{"type":"fa","fa":"square"}','{"type":"fa","fa":"star"}','{"type":"fa","fa":"tag"}','{"type":"fa","fa":"coffee"}','{"type":"fa","fa":"exclamation"}','{"type":"fa","fa":"flag"}','{"type":"fa","fa":"globe"}','{"type":"fa","fa":"wrench"}','{"type":"fa","fa":"file-text"}','{"type":"fa","fa":"suitcase"}','{"type":"fa","fa":"home"}','{"type":"fa","fa":"plane"}','{"type":"fa","fa":"heart"}','{"type":"fa","fa":"money"}','{"type":"fa","fa":"users"}'],t.colors=["var(--body-fg)","var(--body-extra-info-fg)","var(--color-warning)","hsla(var(--task-status-inprogress-h), var(--task-status-inprogress-s), calc(var(--task-status-inprogress-l) - 10%), var(--task-status-inprogress-a))","hsla(var(--task-status-done-h), var(--task-status-done-s), calc(var(--task-status-done-l) - 12%), var(--task-status-done-a))"],t}();s.IconPickerData=n,n.prototype.className="com.privmx.plugin.tasks.component.iconPicker.IconPickerData"},{}],5:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=function(){function t(t){this.options=t,this._timeoutId=null,this._firstScheduleTime=null}return t.prototype.schedule=function(){var t=this,e=performance.now();if(this._timeoutId){if(clearTimeout(this._timeoutId),this._timeoutId=null,this._firstScheduleTime+this.options.maxWaitingTime<=e)return void this._render()}else this._firstScheduleTime=e;this._timeoutId=setTimeout((function(){t._render()}),this.options.rescheduleDelay)},t.prototype._render=function(){this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null),this.options.renderCallback()},t}();s.LazyRenderScheduler=n,n.prototype.className="com.privmx.plugin.tasks.component.taskGroupsPanel.LazyRenderScheduler"},{}],6:[function(t,e,s){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)});Object.defineProperty(s,"__esModule",{value:!0});var a,o=t("pmc-web"),r=t("./template/main.html"),l=t("./template/taskgroup.html"),c=t("./template/entry.html"),d=t("./template/tg-badge.html"),p=t("../../window/taskGroupForm/template/icon.html"),h=t("../../main/Types"),u=t("../../main/FastList"),m=t("../../main/TasksSorter"),f=t("../../main/data/Task"),g=t("../../main/TaskGroupsSorter"),k=t("../iconPicker/IconPickerData"),v=t("../../main/utils/DragDrop"),y=t("./LazyRenderScheduler");!function(t){t[t.top=-999999]="top",t[t.up=-1]="up",t[t.down=1]="down",t[t.bottom=999999]="bottom"}(a||(a={}));var b=function(t){function e(e,s,n){void 0===n&&(n=!1);var i=t.call(this,e)||this;return i.personsComponent=s,i.isSummaryWindow=!1,i.model=null,i.isActive=!1,i.order=40,i.preventSort=!1,i.onColResizerDocumentMouseUpBound=i.onColResizerDocumentMouseUp.bind(i),i.onColResizerDocumentMouseMoveBound=i.onColResizerDocumentMouseMove.bind(i),i.projects={},i.taskGroups={},i.tasks={},i.emptyEntryTemplate=null,i.emptyTgBadgeTemplate=null,i.emptyTgIconTemplates=null,i.freeAvatars={},i.hasAvatarsToRender=!1,i.collapsedTaskGroups=[],i.nVisibleCols=8,i.selectedTasks=[],i.pointer={entryId:null,projectId:null,taskGroupId:null,taskId:null},i.hoverTaskGroup=null,i.visibleTaskGroupElements={},i.tasksLines={},i.hasAssignedToColumn=!0,i.hasCreatedColumn=!0,i.hasModifiedColumn=!0,i.prevTasksHeightRecalcAvailWidth=null,i.previewDirty=!1,i.previewExit=o.Q.defer(),i.nowTimestamp=null,i.nowDMY=null,i._onContainerWidthChangedTO=null,i._onContainerHeightChangedTO=null,i._statuses=[],i.dragDropTaskFullIds=null,i.kanbanDragDropTaskFullIds=null,i.dragDropContainerRect=null,i.scrollIntoViewInterval=null,i.scrollIntoViewSpeed=null,i.lazyRenderScheduler=new y.LazyRenderScheduler({rescheduleDelay:100,maxWaitingTime:1e3,renderCallback:function(){i.repaint()}}),i.clipboardElementAddedAt=null,i.clipboardData=null,i.personTooltip=n?null:new o.component.persontooltip.PersonTooltipView(i.templateManager,i.personsComponent),i.taskTooltip=i.addComponent("tasktooltip",new o.component.tasktooltip.TaskTooltipView(i)),i.taskTooltip.refreshAvatars=function(){i.personsComponent.refreshAvatars()},i.notifications=i.addComponent("notifications",new o.component.notification.NotificationView(i,{xs:!0})),i.customSelectFilter=i.addComponent("customSelectFilter",new o.component.customselect.CustomSelectView(i,{})).onChange(i.onFilterChange.bind(i)),i._statuses=f.Task.getStatuses(),i}return i(e,t),e.prototype.init=function(t){var e=this;this.isSummaryWindow="com.privmx.core.window.sectionsummary.SectionSummaryWindowView"==this.parent.className,this.isSummaryWindow&&document.querySelectorAll(".window-sectionsummary.single-mode").length>0&&(this.isSummaryWindow=!1);var s=JSON.parse(t);(this.setModel(s),this.$container.on("click",".btn.settings",this.onSettingsButtonClick.bind(this)),this.$container.on("click",".context-menu-backdrop2",this.onSettingsMenuBackdropClick.bind(this)),this.$container.on("change","input[data-setting]",this.onSettingChanged.bind(this)),this.$container.on("click","button[data-setting]",this.onSettingChanged.bind(this)),this.$container.on("click","span.show-recently-modified[data-setting]",this.onSettingChanged.bind(this)),this.$container.on("click","span.kanban-mode[data-setting]",this.onSettingChanged.bind(this)),this.$container.on("mousedown","tr.entry-task, .kanban-task-box-content",this.onTaskMouseDown.bind(this)),this.$container.on("mouseup","tr.entry-task, .kanban-task-box-content",this.onTaskMouseUp.bind(this)),this.$container.on("dblclick","tr.entry-task, .kanban-task-box-content",this.onTaskDoubleClick.bind(this)),this.$container.on("click",'[data-action="taskgroup-new"]',this.onNewTaskGroupClick.bind(this)),this.$container.on("click",'[data-action="taskgroup-edit"]',this.onEditTaskGroupClick.bind(this)),this.$container.on("click",'[data-action="taskgroup-paste"]',this.onPasteIntoTaskGroupClick.bind(this)),this.$container.on("click",'[data-action="task-new"]',this.onNewTaskClick.bind(this)),this.$container.on("click",'[data-action="task-delete-selected"]',this.onDeleteTaskClick.bind(this)),this.$container.on("click",'[data-action="task-restore-selected"]',this.onRestoreTaskClick.bind(this)),this.$container.on("click",'[data-action="taskgroup-toggle-collapsed-all"]',this.onToggleCollapsedAllClick.bind(this)),this.$container.on("click",'[data-action-id="item-new-task"]',this.onNewTaskClick.bind(this)),this.$container.on("click",'[data-action-id="item-new-taskgroup"]',this.onNewTaskGroupClick.bind(this)),this.$container.on("click",'[data-action="tg-move-to-top"]',this.onTaskGroupMoveToTop.bind(this)),this.$container.on("click",'[data-action="tg-move-up"]',this.onTaskGroupMoveUp.bind(this)),this.$container.on("click",'[data-action="tg-move-down"]',this.onTaskGroupMoveDown.bind(this)),this.$container.on("click",'[data-action="tg-move-to-bottom"]',this.onTaskGroupMoveToBottom.bind(this)),this.$container.on("click",".pin-taskgroup",this.onPinTaskGroupClick.bind(this)),this.$container.on("click",".pin-task",this.onPinTaskClick.bind(this)),this.$container.on("click",".btn.refresh",this.onFullRefreshClick.bind(this)),this.$container.on("click",'[data-action="mark-all-as-read"]',this.onMarkAllAsReadClick.bind(this)),this.$container.on("click",".taskgroup-header",this.onTaskGroupHeaderClick.bind(this)),this.$container.on("click","th[data-sort-by], td[data-sort-by]",this.onTableHeaderClick.bind(this)),this.$container.on("mousedown",".col-resizer",this.onColResizerMouseDown.bind(this)),this.$container.on("click","[data-action=task-cut-selected]",this.onCutClick.bind(this)),this.$container.on("click","[data-action=task-copy-selected]",this.onCopyClick.bind(this)),this.$container.on("click","[data-action=task-paste-selected]",this.onPasteClick.bind(this)),this.$container.on("click","[data-action=task-move-selected]",this.onMoveClick.bind(this)),this.$container.on("click",'[data-action="show-hidden-tasks"]',this.onShowHiddenTasksClick.bind(this)),this.$container.on("keydown",this.onKeyDown.bind(this)),this.$container.on("mouseenter","li.badge-default",this.onTgBadgeMouseEnter.bind(this)),this.$container.on("mouseleave",".task-taskgroups-badges",this.onTgBadgeMouseLeave.bind(this)),this.$container.on("mouseover",".entry",this.onEntryMouseOver.bind(this)),this.$container.on("mouseout",".entry",this.onEntryMouseOut.bind(this)),this.$dropZoneHighlightsContainer=this.$container.find(".dropzone-higlights-container"),this.initDragDrop(),this.initKanbanDragDrop(),window.ResizeObserver)&&new window.ResizeObserver((function(t){var s=t[0].contentRect.width;e.onSizeChanged(s)})).observe(this.$container[0]);return this.personTooltip&&this.personTooltip.init(this.$container),this.taskTooltip.$container=this.$container,this.notifications.$container=this.$container.find(".notifications-container-wrapper"),o.Q.all([this.taskTooltip.triggerInit(),this.notifications.triggerInit(),this.customSelectFilter.triggerInit()]).then((function(){e.hasAvatarsToRender=!1,e.personsComponent.refreshAvatars()}))},e.prototype.setModel=function(t){this.model=t,t&&(this.fastListSettings={sortBy:"hash-id",sortAsc:!1,hTask:27,hTask2ndLine:16,hTaskNextLines:18,hTaskGroup:40,hHeader:21,hKanbanHeader:21,hEmptyTgInfo:43,hKanbanEmptyTgInfo:83,hHiddenTasksInfo:43,hKanbanEntryBox:68,hKanbanLastEntryBox:108},this.collapsedTaskGroups=JSON.parse(this.model.settings["collapsed-taskgroups"]),this.updateColumnsVisibilityInfo()),this.render()},e.prototype.setData=function(t){this.setModel(JSON.parse(t))},e.prototype.debug=function(t){this.model?this.model.debug&&console.log(this.model.projectName,performance.now(),t):console.warn("no model",performance.now(),t)},e.prototype.getIconId=function(t){return t.type+"--"+("fa"==t.type?t.fa:t.shape)},e.prototype.isContainerReady=function(){return this.$container&&this.$container.hasClass("active")},e.prototype.repaintWhenReady=function(){var t=this,e=o.Q.defer();return this.isContainerReady()?(this.repaint(),e.resolve()):setTimeout((function(){t.repaintWhenReady().then(e.resolve,e.reject)}),100),e.promise},e.prototype.render=function(){var t=this,e=this.$container.find(".notifications-container-wrapper"),s=this.$container.find(".dropzone-higlights-container"),n=this.$container.find(".tooltip-component");if(this.$container.empty(),this.model){var i=this.templateManager.createTemplate(p.func);this.emptyTgIconTemplates={};for(var a=0,h=k.IconPickerData.items;a<h.length;a++){var m=h[a];if(m){var f=JSON.parse(m);this.emptyTgIconTemplates[this.getIconId(f)]=i.renderToJQ(m)[0]}}this.emptyTgBadgeTemplate=this.templateManager.createTemplate(d.func).renderToJQ()[0];var g=this.templateManager.createTemplate(l.func);this.emptyEntryTemplate=this.templateManager.createTemplate(c.func).renderToJQ(this.model.emptyTaskGroupModel,g)[0],this.removeTextNodes(this.emptyEntryTemplate);var v=this.templateManager.createTemplate(o.component.template.conversation);this.$container.append(this.templateManager.createTemplate(r.func).renderToJQ(this.model,v)),this.setColWidths(this.model.colWidths),this.$goToChat=this.$container.find(".go-to-chat"),this.$goToNotes=this.$container.find(".go-to-notes"),this.$goToCalendar=this.$container.find(".go-to-calendar"),this.$modeSwitch=this.$container.find('[data-setting="show-recently-modified"]').children(".fa"),this.$kanbanModeSwitch=this.$container.find('[data-setting="kanban-mode"]').children(".fa"),this.$goToChat.toggleClass("hidden",!this.model.otherPluginsAvailability.chat),this.$goToNotes.toggleClass("hidden",!this.model.otherPluginsAvailability.notes),this.$goToCalendar.toggleClass("hidden",!this.model.otherPluginsAvailability.calendar),this.hasAvatarsToRender=!1,this.personsComponent.refreshAvatars(),this.customSelectFilter.setContainer(this.$container.find(".filter-container")),e.length>0&&this.$container.find(".notifications-container-wrapper").replaceWith(e),s.length>0&&this.$container.find(".dropzone-higlights-container").replaceWith(s),n.length>0&&this.$container.append(n),this.$settingsMenu=this.$container.find(".context-menu-settings"),this.updateClasses(),this.updateSettingsMenu();var y=this.$container.find(".fl-container")[0];o.JQuery(y).pfScroll(),y=y.childNodes[0];var b=this.$container.find(".fl-padding-container")[0],T=this.$container.find(".fl-entries-container")[0];this.fastList=new u.FastList(y,b,T),this.fastList.debug=this.debug.bind(this),this.fastList.setEmptyElementCreator(this.createFastListEmptyElement.bind(this)),this.fastList.setElementFiller(this.fillFastListElement.bind(this)),this.fastList.setBeforeRender(this.beforeFastListRender.bind(this)),this.fastList.setAfterRender(this.afterFastListRender.bind(this)),this.fastList.setBeforeDelElement(this.beforeFastListDeleteElement.bind(this)),o.Q().then((function(){return t.updateTaskHeights(null,!1)})).then((function(){t.updateFastListEntries(),t.fastList.init(t.isContainerReady())}))}else this.$container.html('<div class="notifications-container-wrapper"></div><div class="dropzone-higlights-container"></div>')},e.prototype.repaint=function(){if(this.debug("starting repaint()"),this.model)try{this.updateClasses(),this.updateFastListEntries(),this.renderFastList(),this.debug("finished repaint()")}catch(t){this.debug("repaint() error: "+t),console.error(t)}else this.debug("repaint() error: no model present")},e.prototype.showsFixedSection=function(){return this.model.isAllTasks||this.model.isTasksAssignedToMe||this.model.isTasksCreatedByMe||this.model.isTrash},e.prototype.isInRecentlyModifiedMode=function(){return this.getSetting("show-recently-modified")},e.prototype.isInKanbanMode=function(){return this.getSetting("kanban-mode")},e.prototype.getHideDone=function(){return this.getSetting(this.isKanban()?"kanban-filter":"filter")==h.Filter.onlyNotDone},e.prototype.getShowOrphans=function(){return this.getSetting("show-orphans")},e.prototype.getSetting=function(t){return this.model.settings[t]},e.prototype.setSetting=function(t,e){this.model.settings[t]=e},e.prototype.settingChanged=function(t,e,s){var n=this;void 0===s&&(s=!0),this.model&&this.model.projectId&&(this.triggerEvent("settingChanged",t,e,s),this.model&&this.model.settings&&(this.model.settings[t]=e,"show-"==t.substr(0,5)&&"-column"==t.substr(t.length-7,7)?(this.updateColumnsVisibilityInfo(),this.updateTaskHeights(null,!1).then((function(){n.repaint()}))):this.repaint(),this.updateSettingsMenu()))},e.prototype.updateColumnsVisibilityInfo=function(){this.hasAssignedToColumn=!!this.model.settings["show-assigned-to-column"],this.hasCreatedColumn=!!this.model.settings["show-created-column"],this.hasModifiedColumn=!!this.model.settings["show-modified-column"]},e.prototype.updateSettingsMenu=function(){var t=this.model.uniqueSafeId;for(var e in this.model.settings)this.$container.find("#tasks-settings-"+e+"-"+t).prop("checked",this.getSetting(e));var s=this.isInRecentlyModifiedMode();this.$container.find("#tasks-settings-show-recently-modified-"+t).data("checked",s).children(".fa").toggleClass("fa-list-alt",s).toggleClass("fa-th-list",!s).end().attr("title",this.parent.i18n("plugin.tasks.component.taskGroupsPanel.viewMode"+(s?"MultipleLists":"SingleList")));var n=this.isInKanbanMode();this.$container.find("#tasks-settings-kanban-mode-"+t).data("checked",n).toggleClass("kanban-on",n).toggleClass("kanban-off",!n).attr("title",this.parent.i18n("plugin.tasks.component.taskGroupsPanel."+(n?"normalMode":"kanbanMode")));var i=["show-task-column","show-status-column","show-attachments-column","show-created-column"];this.isKanban()||(i=[]);for(var a=!0,o=this.$container.find(".context-menu-content").children("li"),r=0;r<o.length;++r){var l=o.eq(r);if(l.is(".subitem")){var c=!a||i.indexOf(l.find("input").data("setting"))>=0;l.toggleClass("disabled",c),l.find("input").prop("disabled",c)}else{a=l.find("input").is(":checked");c=!1;if(this.isKanban()){var d=l.find("input").data("setting");c=i.indexOf(d)>=0,a=a&&!c}l.toggleClass("disabled",c),l.find("input").prop("disabled",c)}}},e.prototype.updateClasses=function(){if(this.model){this.$container.toggleClass("combines-multiple-sections",this.model.combinesMultipleSections);var t=this.model.settings["show-recently-modified"];this.$container.toggleClass("mode-default",!t),this.$container.toggleClass("mode-recently-modified",!!t),this.$modeSwitch.toggleClass("fa-th-list",!t),this.$modeSwitch.toggleClass("fa-list-alt",!!t);var e=this.model.settings["kanban-mode"];this.$container.toggleClass("not-kanban-mode",!e),this.$container.toggleClass("kanban-mode",!!e),this.$kanbanModeSwitch.toggleClass("fa-th",!e),this.$kanbanModeSwitch.toggleClass("fa-align-justify",!!e);var s=this.model.settings["show-header-per-list"];this.$container.toggleClass("single-header",!s);var n=this.areAllCollapsed();this.$container.toggleClass("all-collapsed",n);var i=this.fastListSettings.sortBy,a=this.fastListSettings.sortAsc,o=this.$container.find(".floating-single-header").find("th");o.removeClass("sorted-asc").removeClass("sorted-desc"),o.filter("[data-sort-by='"+i+"']").addClass("sorted-"+(a?"asc":"desc"));var r=this.model.settings[this.isKanban()?"kanban-filter":"filter"]==h.Filter.onlyNotDone;this.$container.toggleClass("hide-done",!!r);var l=!this.model.settings["show-list-progress"];this.$container.toggleClass("hide-list-progress",l);var c=!this.model.settings["show-task-numbers"];this.$container.toggleClass("hide-task-numbers",c);var d=!!this.model.settings["show-full-task-descriptions"];this.$container.toggleClass("show-full-task-descriptions",d),this.$container.toggleClass("hide-full-task-descriptions",!d);var p=!!this.model.settings["show-all-other-list-names"];this.$container.toggleClass("show-all-other-list-names",p),this.$container.toggleClass("dont-show-all-other-list-names",!p);var u=this.model.settings[this.isKanban()?"kanban-filter":"filter"]==h.Filter.onlyUnread;this.$container.toggleClass("show-only-unread",u);var m=!!this.model.settings["texts-with-status-color"];this.$container.toggleClass("texts-with-status-color",m),this.$container.toggleClass("no-texts-with-status-color",!m);var f=!!this.model.settings["narrow-issue-rows"];this.$container.toggleClass("narrow-issue-rows",f),this.$container.toggleClass("no-narrow-issue-rows",!f);this.nVisibleCols=1;for(var g=!1,k=0,v=["hash-id","task","status","assigned-to","attachments","created","modified"];k<v.length;k++){var y=v[k],b=!!this.model.settings["show-"+y+"-column"];this.$container.toggleClass("no-"+y,!b),this.$container.toggleClass("no-"+y+"-resizer",!g),b&&(this.nVisibleCols++,g=!0)}this.$container.toggleClass("no-task-in-clipboard",this.isClipboardEmpty()),this.$container.toggleClass("no-task-selected",0==this.selectedTasks.length),this.$container.toggleClass("no-taskgroups",1==Object.keys(this.model.taskGroups).length),this.$container.toggleClass("no-creating-new-tasks",!this.model.canCreateNewTasks)}},e.prototype.areAllCollapsed=function(){for(var t in this.model.taskGroups)if(!this.model.taskGroups[t].isCollapsed)return!1;return!0},e.prototype.setPreviewDirty=function(t){this.previewDirty=t},e.prototype.initKanbanDragDrop=function(){var t=this;this.kanbanDragDrop=new v.DragDrop(this.$container,"td.for-kanban-tasks.with-task",".kanban-dropzone"),this.kanbanDragDrop.bringToTop=!0,this.kanbanDragDrop.setOnDragStart((function(e,s){(s.ctrlKey||s.metaKey)&&((l=s.currentTarget).childNodes[0].classList.contains("selected")||t.onTaskMouseDown(s));t.currKanbanDropZones=[],t.kanbanDragDropCurrColumnId=null,t.kanbanDragDropCurrFullTaskGroupId=null,t.scrollIntoViewSpeed=0,t.scrollIntoViewInterval=setInterval(t.scrollIntoViewStep.bind(t),1e3/60),t.cacheDragDropContainerRect();for(var n=e.children(".kanban-task-box-content").attr("data-task-full-id").split("/"),i=[n[0]+"/"+n[1]+"/"+n[2]],a=0,r=t.selectedTasks;a<r.length;a++){var l=r[a];i.indexOf(l)<0&&i.push(l)}t.kanbanDragDropTaskFullIds=i;for(var c=[],d=0,p=t.fastList.entries;d<p.length;d++){if((v=p[d]).data&&v.data.tasksByStatus)for(var h in v.data.tasksByStatus){var u=v.data.tasksByStatus[h];if(u){var m=u.context.projectId+"/"+u.context.taskGroupId+"/"+u.task.id;i.indexOf(m)>=0&&c.indexOf(v)<0&&c.push(v)}}}for(var f={},g=0,k=c=JSON.parse(JSON.stringify(c));g<k.length;g++){var v=k[g];for(var y in v.data.tasksByStatus){var b=v.data.tasksByStatus[y];if(y in f||(f[y]=[]),b){var T=b.context.projectId+"/"+b.context.taskGroupId+"/"+b.task.id;i.indexOf(T)>=0&&f[y].push({context:b.context,task:b.task})}}}var w=0;for(var C in f)w=Math.max(w,f[C].length);for(var S=[],I=0;I<w;++I){var D={};for(var E in f){var P=f[E][I];P&&(D[E]=P)}S.push({data:{context:null,tasksByStatus:D},height:t.fastListSettings.hKanbanEntryBox,startsAt:0})}c=S;for(var x=o.JQuery(t.fastList.entriesContainer).find("td.for-kanban-tasks.with-task").outerWidth(),H=o.JQuery("<tbody class='fl-entries-container ghost-image'></tbody>"),$=0,A=c;$<A.length;$++){v=A[$],l=t.createFastListEmptyElement();t.fillFastListElement(l,v),l.querySelectorAll("td.for-kanban-tasks.with-task").forEach((function(t){t.childNodes[0].classList.add("selected"),t.style.width=x+"px"})),l.classList.remove("last-row-in-tg"),l.style.height=t.fastListSettings.hKanbanEntryBox+"px",H.append(l)}o.JQuery(t.fastList.entriesContainer).parent().append(H),s.dataTransfer.setDragImage(H[0],0,0),t.personsComponent.refreshAvatars(),o.Q().then((function(){H.remove()}))})),this.kanbanDragDrop.setOnDragCancel((function(e){clearInterval(t.scrollIntoViewInterval),t.scrollIntoViewInterval=null,t.scrollIntoViewSpeed=0,t.clearDragDropHighlights(),t.kanbanDragDropCurrColumnId=null,t.kanbanDragDropCurrFullTaskGroupId=null})),this.kanbanDragDrop.setOnDragDrop((function(e,s){var n;clearInterval(t.scrollIntoViewInterval),t.scrollIntoViewInterval=null,t.scrollIntoViewSpeed=0;var i=null,a=null,o=null;null!==t.kanbanDragDropCurrColumnId&&(i=t.getTaskStatusFromNumId(t.kanbanDragDropCurrColumnId)),null!==t.kanbanDragDropCurrFullTaskGroupId&&(a=(n=t.kanbanDragDropCurrFullTaskGroupId.split("/"))[0],o=n[1]);var r=t.kanbanDragDropTaskFullIds;t.triggerEvent("dropTasks",r,i,a,o),t.clearDragDropHighlights(),t.kanbanDragDropCurrColumnId=null,t.kanbanDragDropCurrFullTaskGroupId=null})),this.kanbanDragDrop.setOnDragEnterZone((function(e,s){for(var n=!1,i=0,a=t.currKanbanDropZones;i<a.length;i++){if((o=a[i]).dropZoneElement==s[0]){n=!0;break}}if(!n){var o={fullTaskGroupId:s[0].getAttribute("data-kanban-dropzone-taskgroup-full-id"),status:s[0].getAttribute("data-kanban-dropzone-status"),dropZoneElement:s[0],highlightElement:null};t.currKanbanDropZones.push(o),t.highlightKanbanDropZone(o)}})),this.kanbanDragDrop.setOnDragLeaveZone((function(e,s){var n=-1;for(var i in t.currKanbanDropZones){if(t.currKanbanDropZones[i].dropZoneElement==s[0]){n=Number(i);break}}n>=0&&(t.currKanbanDropZones.length<=1&&t.removeKanbanDropZoneHighlight(t.currKanbanDropZones[n]),t.currKanbanDropZones.splice(n,1))})),this.kanbanDragDrop.setOnMouseMove((function(e){if(t.tryScrollWhileDragging(e.currY),t.currKanbanDropZones&&1==t.currKanbanDropZones.length){var s=t.currKanbanDropZones[0];if(null===s.status){var n=t.kanbanDragDrop.containerWidth;Math.floor(t.getCurrentNVisibleCols()*e.prevX/n)!=Math.floor(t.getCurrentNVisibleCols()*e.currX/n)&&t.highlightKanbanDropZone(s)}}}))},e.prototype.clearDragDropHighlights=function(){this.currKanbanDropZones=[],this.$dropZoneHighlightsContainer.html("")},e.prototype.highlightKanbanDropZone=function(t){var e=this.$dropZoneHighlightsContainer.children(),s=0==e.length,n=s?o.JQuery("<div></div>"):e.eq(0),i=this.$dropZoneHighlightsContainer.width(),a=i/this.getCurrentNVisibleCols(),r=null===t.status?Math.floor(this.getCurrentNVisibleCols()*this.kanbanDragDrop.mouseX/i):this.getTaskStatusNumId(t.status);this.kanbanDragDropCurrColumnId=r,this.kanbanDragDropCurrFullTaskGroupId=null;var l=a*r,c=0,d=a,p=0;if(this.model.settings["show-recently-modified"])c=0,p=this.$dropZoneHighlightsContainer.height();else{for(var h=o.JQuery(t.dropZoneElement).closest("tr.entry"),u=0,m=this.$dropZoneHighlightsContainer.height(),f=parseInt(this.$dropZoneHighlightsContainer.css("top")),g=null,k=h;k.length>0;){if(k.hasClass("entry-taskgroup")){g=k;break}k=k.prev()}null!=g&&g.length>0&&(u=(g[0],h[0],g.offset().top-f));for(var v=null,y=h.next();y.length>0;){if(y.hasClass("entry-taskgroup")){v=y;break}y=y.next()}null!=v&&v.length>0&&(m=v.offset().top-f),c=u,p=m-u;for(var b=null,T=parseInt(h[0].dataset.entryId);T>=0;){var w=this.fastList.entries[T];if(w.data.taskGroup){b=w.data.taskGroup;break}T--}b&&(this.kanbanDragDropCurrFullTaskGroupId=b.projectId+"/"+b.id)}var C={left:l,top:c,width:d,height:p};s?n.css({left:l+d/2,top:c+p/2,width:0,height:0}):n.css(C),t.highlightElement=n[0],t.highlightElement.style.visibility="visible",s&&(this.$dropZoneHighlightsContainer.append(n),o.Q().then((function(){n.css(C)})))},e.prototype.removeKanbanDropZoneHighlight=function(t){t.highlightElement.style.visibility="hidden"},e.prototype.getTaskStatusNumId=function(t){return t==f.TaskStatus.IDEA?0:t==f.TaskStatus.TODO?1:t==f.TaskStatus.INPROGRESS?2:t==f.TaskStatus.DONE?3:0},e.prototype.getTaskStatusFromNumId=function(t){return 0==t?f.TaskStatus.IDEA:1==t?f.TaskStatus.TODO:2==t?f.TaskStatus.INPROGRESS:3==t?f.TaskStatus.DONE:f.TaskStatus.UNKNOWN},e.prototype.initDragDrop=function(){var t=this;this.dragDrop=new v.DragDrop(this.$container,"tr.entry-task",".dropzone"),this.dragDrop.setOnDragStart((function(e,s){(s.ctrlKey||s.metaKey)&&((l=s.currentTarget).classList.contains("selected")||t.onTaskMouseDown(s));t.currDropZones=[],t.dragDropCurrFullTaskGroupId=null,t.scrollIntoViewSpeed=0,t.scrollIntoViewInterval=setInterval(t.scrollIntoViewStep.bind(t),1e3/60),t.cacheDragDropContainerRect();for(var n=t.getEntry(e[0]),i=[n.data.context.projectId+"/"+n.data.context.taskGroupId+"/"+n.data.task.id],a=0,r=t.selectedTasks;a<r.length;a++){var l=r[a];i.indexOf(l)<0&&i.push(l)}t.dragDropTaskFullIds=i;for(var c=[],d=0,p=t.fastList.entries;d<p.length;d++){var h=p[d];if(h.data&&h.data.task){var u=h.data.context.projectId+"/"+h.data.context.taskGroupId+"/"+h.data.task.id;i.indexOf(u)>=0&&c.push(h)}}var m=o.JQuery("<tbody class='fl-entries-container ghost-image'></tbody>"),f={};o.JQuery(t.fastList.entriesContainer).children("tr.entry.entry-task").first().children(".for-task").each((function(t,e){var s=null;for(var n in e.classList)if("task-"==e.classList[n].substr(0,5)){s=e.classList[n];break}s&&(f[s]=o.JQuery(e).outerWidth())})).outerWidth();for(var g=0,k=c;g<k.length;g++){var v=k[g];l=t.createFastListEmptyElement();for(var y in t.fillFastListElement(l,v),l.classList.add("selected"),f){var b=l.querySelector(".for-task."+y).style;b.width=f[y]+"px",b.minWidth=f[y]+"px",b.maxWidth=f[y]+"px"}m.append(l)}o.JQuery(t.fastList.entriesContainer).parent().append(m),s.dataTransfer.setDragImage(m[0],0,0),t.personsComponent.refreshAvatars(),o.Q().then((function(){m.remove()}))})),this.dragDrop.setOnDragCancel((function(e){clearInterval(t.scrollIntoViewInterval),t.scrollIntoViewInterval=null,t.scrollIntoViewSpeed=0,t.clearDragDropHighlights(),t.dragDropCurrFullTaskGroupId=null})),this.dragDrop.setOnDragDrop((function(e,s){var n;clearInterval(t.scrollIntoViewInterval),t.scrollIntoViewInterval=null,t.scrollIntoViewSpeed=0;var i=null,a=null;null!==t.dragDropCurrFullTaskGroupId&&(i=(n=t.dragDropCurrFullTaskGroupId.split("/"))[0],a=n[1]);var o=t.dragDropTaskFullIds;t.triggerEvent("dropTasks",o,null,i,a),t.clearDragDropHighlights(),t.dragDropCurrFullTaskGroupId=null})),this.dragDrop.setOnDragEnterZone((function(e,s){for(var n=!1,i=0,a=t.currDropZones;i<a.length;i++){if((o=a[i]).dropZoneElement==s[0]){n=!0;break}}if(!n){var o={fullTaskGroupId:s[0].getAttribute("data-dropzone-taskgroup-full-id"),dropZoneElement:s[0],highlightElement:null};t.currDropZones.push(o),t.highlightDropZone(o)}})),this.dragDrop.setOnDragLeaveZone((function(e,s){var n=-1;for(var i in t.currDropZones){if(t.currDropZones[i].dropZoneElement==s[0]){n=Number(i);break}}n>=0&&(t.currDropZones.length<=1&&t.removeDropZoneHighlight(t.currDropZones[n]),t.currDropZones.splice(n,1))})),this.dragDrop.setOnMouseMove((function(e){t.tryScrollWhileDragging(e.currY)}))},e.prototype.highlightDropZone=function(t){var e=this.$dropZoneHighlightsContainer.children(),s=0==e.length,n=s?o.JQuery("<div></div>"):e.eq(0),i=0,a=this.$dropZoneHighlightsContainer.width(),r=0;if(this.model.settings["show-recently-modified"])i=0,r=this.$dropZoneHighlightsContainer.height();else{for(var l=o.JQuery(t.dropZoneElement).closest("tr.entry"),c=0,d=this.$dropZoneHighlightsContainer.height(),p=parseInt(this.$dropZoneHighlightsContainer.css("top")),h=null,u=l;u.length>0;){if(u.hasClass("entry-taskgroup")){h=u;break}u=u.prev()}null!=h&&h.length>0&&(c=(h[0],l[0],h.offset().top-p));for(var m=null,f=l.next();f.length>0;){if(f.hasClass("entry-taskgroup")){m=f;break}f=f.next()}null!=m&&m.length>0&&(d=m.offset().top-p),i=c,r=d-c;for(var g=null,k=parseInt(l[0].dataset.entryId);k>=0;){var v=this.fastList.entries[k];if(v.data.taskGroup){g=v.data.taskGroup;break}k--}g&&(this.dragDropCurrFullTaskGroupId=g.projectId+"/"+g.id)}var y={left:0,top:i,width:a,height:r};s?n.css({left:0+a/2,top:i+r/2,width:0,height:0}):n.css(y),t.highlightElement=n[0],t.highlightElement.style.visibility="visible",s&&(this.$dropZoneHighlightsContainer.append(n),o.Q().then((function(){n.css(y)})))},e.prototype.removeDropZoneHighlight=function(t){t.highlightElement.style.visibility="hidden"},e.prototype.cacheDragDropContainerRect=function(){var t=o.JQuery(this.fastList.container).offset();this.dragDropContainerRect={x:t.left,y:t.top,w:o.JQuery(this.fastList.container).width(),h:o.JQuery(this.fastList.container).height()}},e.prototype.tryScrollWhileDragging=function(t){var e=t-this.dragDropContainerRect.y,s=this.dragDropContainerRect.h-(t-this.dragDropContainerRect.y),n=null,i=0;if((e=Math.max(0,e))<(s=Math.max(0,s))&&e<=100&&(n="top",i=e),s<e&&s<=100&&(n="btm",i=s),n){var a=100-i;a=Math.min(Math.max(a,0),100)/100,"top"==n&&(a=-a),this.scrollIntoViewSpeed=a}else this.scrollIntoViewSpeed=0},e.prototype.scrollIntoViewStep=function(){var t=10*this.scrollIntoViewSpeed,e=this.fastList.container.scrollTop,s=this.fastList.container.scrollHeight-this.fastList.container.clientHeight,n=Math.round(Math.min(s,Math.max(0,e+t)));if(n!=e){var i;if(this.fastList.container.scrollTo(0,n),this.toggleDropZoneHighlightsAnimations(!1),this.isKanban())(i=this.currKanbanDropZones[this.currKanbanDropZones.length-1])&&(document.contains(i.dropZoneElement)?this.highlightKanbanDropZone(i):this.removeKanbanDropZoneHighlight(i));else(i=this.currDropZones[this.currDropZones.length-1])&&(document.contains(i.dropZoneElement)?this.highlightDropZone(i):this.removeDropZoneHighlight(i));this.toggleDropZoneHighlightsAnimations(!0)}},e.prototype.toggleDropZoneHighlightsAnimations=function(t){this.$dropZoneHighlightsContainer.toggleClass("no-animations",!t)},e.prototype.updateFastListEntries=function(){if(this.debug("starting updateFastListEntries()"),this.model){var t=!this.model.settings["show-recently-modified"],e=this.model.settings["show-header-per-list"],s=this.model.settings["show-orphans"],n=this.model.settings[this.isKanban()?"kanban-filter":"filter"],i=this.fastListSettings.sortBy,a=this.fastListSettings.sortAsc,o=this.fastListSettings.hTaskGroup,r=this.fastListSettings.hHeader,l=this.fastListSettings.hKanbanHeader,c=this.fastListSettings.hEmptyTgInfo,d=this.fastListSettings.hKanbanEmptyTgInfo,p=this.fastListSettings.hKanbanEntryBox,h=this.fastListSettings.hKanbanLastEntryBox,u=this.fastListSettings.hHiddenTasksInfo,k=!!this.currSearchFilter,v=this.currSearchFilter,y=k||!this.model.showsEmptyTaskGroups,b=0,T={};if(t){for(var w in this.model.taskGroups)T[w]={tg:this.model.taskGroups[w],tasks:[]};for(var w in this.model.tasks){if((V=this.model.tasks[w]).trashed==this.model.isTrash&&(this.meetsFilter(n,V)&&(!k||f.Task.matchesSearchString(V.id,V.cachedSearchString,v)))){for(var C=0,S=V.taskGroupIds;C<S.length;C++){var I=S[C];I in T&&T[I].tasks.push(V)}(0==V.taskGroupIds.length||1==V.taskGroupIds.length&&"__orphans__"==V.taskGroupIds[0])&&T[V.projectId+"/__orphans__"].tasks.push(V)}}if(!this.model.settings["show-orphans"])for(var w in this.model.taskGroups)w.indexOf("__orphans__")>=0&&(b+=T[w].tasks.length,delete T[w])}else for(var w in T.__recently_modified__={tg:this.getRecentlyModifiedTaskGroupModel(this.model.projectId),tasks:[]},this.model.tasks){(V=this.model.tasks[w]).trashed==this.model.isTrash&&(this.meetsFilter(n,V)&&(k&&!f.Task.matchesSearchString(V.id,V.cachedSearchString,v)||T.__recently_modified__.tasks.push(V)))}var D=[];for(var E in T){D.push(T[E]);var P=T[E].tasks;T[E].tg.isCollapsed||(T[E].tasks=m.TasksSorter.sort(P,i,a,T[E].tg.id))}var x=!1,H=!1,$=[],A=(D=g.TaskGroupsSorter.sort(D,this.model.projects).filter((function(t){return!y||0!=t.tasks.length||"__recently_modified__"==t.tg.id}))).length;for(var w in D){var M=Number(w),_=D[w],G=this.model.projects[_.tg.projectId],L=G?G.pinnedTaskGroupIds:[],O=L.indexOf(_.tg.id)>=0,N={taskGroupId:_.tg.id,projectId:_.tg.projectId,isFirstPinnedTg:!x&&O&&0==M,isLastPinnedTg:!x&&O&&M+1<A&&L.indexOf(D[M+1].tg.id)<0,isFirstNotPinnedTg:!x&&!H&&!O,isLastNotPinnedTg:M==A-1&&!O};if(N.isFirstNotPinnedTg&&(H=!0),O||(x=!0),t){var R=this.model.combinesMultipleSections?_.tg.name+" ("+this.model.projects[_.tg.projectId].name+")":_.tg.name;$.push({height:o,startsAt:0,data:{taskGroup:_.tg,context:N,computedName:R}})}if(!_.tg.isCollapsed){e&&$.push({height:r,startsAt:0,data:{header:!0,context:N}}),0==_.tasks.length&&$.push({height:this.isKanban()?d:c,startsAt:0,data:{emptyTgInfo:!0,context:N}});for(var F=0,j=_.tasks;F<j.length;F++){var V=j[F];$.push({height:this.getTaskHeight(V.id),startsAt:0,data:{task:V,context:N}})}}}t&&!s&&b>0&&$.push({height:u,startsAt:0,data:{hiddenTasksInfo:b,context:null}});var W=this.selectedTasks.slice(),z=this.getClipboardTasks();W.push.apply(W,z);for(var B={},J=0,K=W;J<K.length;J++){B[K[J]]=0}for(var Q=[],Z=0,q=$;Z<q.length;Z++){if((nt=q[Z]).data.task){var U=nt.data.context.projectId+"/"+nt.data.context.taskGroupId+"/"+nt.data.task.id;W.indexOf(U)>=0&&B[U]++}}for(var Y in B)0==B[Y]&&Q.push(Y);var X=this.selectedTasks.length;this.selectedTasks=this.selectedTasks.filter((function(t){return Q.indexOf(t)<0})),this.selectedTasks.length<X&&this.notifySelectionChanged(),this.updateClipboard(z.filter((function(t){return Q.indexOf(t)<0})),this.getClipboardIsCut());var tt=this._statuses;if(this.isKanban()){for(var et=[],st=0;st<$.length;++st){var nt;if((nt=$[st]).data.task){for(var it={},at=0,ot=tt;at<ot.length;at++){it[ot[at]]=[]}for(var rt=st;rt<$.length;++rt){var lt=$[rt];if(!lt.data.task){st=rt-1;break}it[(V=lt.data.task).status]&&it[V.status].push(lt),rt+1==$.length&&(st=rt)}for(var ct=0,dt=0,pt=tt;dt<pt.length;dt++){var ht=pt[dt];ct=Math.max(ct,it[ht].length)}for(rt=0;rt<ct;++rt){for(var ut={},mt=0,ft=tt;mt<ft.length;mt++){var gt=ft[mt];ut[gt]=it[gt][rt]?it[gt][rt].data:null}var kt={height:rt+1==ct?h:p,startsAt:0,data:{context:null,tasksByStatus:ut,isLastTGRow:rt+1==ct}};et.push(kt)}}else nt.data.header?et.push({height:l,startsAt:0,data:{context:null,kanbanHeader:!0}}):et.push(nt)}$=et}this.fastList.setEntries($),this.debug("updateFastListEntries(): num entries = "+$.length),this.debug("updateFastListEntries(): sum entries start+height = "+$.map((function(t){return t.startsAt+"+"+t.height})).join(","))}else this.debug("updateFastListEntries() error: no model")},e.prototype.getRecentlyModifiedTaskGroupModel=function(t){var e=this.model.projects[t];e||(e=this.model.projects[Object.keys(this.model.projects)[0]]);for(var s={},n=0,i=f.Task.getStatuses();n<i.length;n++){s[i[n]]=0}return{id:"__recently_modified__",name:this.parent.i18n("plugin.tasks.component.taskGroupsPanel.recentlyModifiedGroup"),projectId:t,taskLabelClasses:e?e.taskLabelClasses:this.model.defaultTaskLabelClasses,isCollapsed:!1,isDetached:!1,isOrphans:!1,nTasksByStatus:s,isClosed:!1,icon:null,withUnread:!1}},e.prototype.setOrphansTaskGroupModels=function(t){var e=JSON.parse(t);for(var s in e){var n=e[s];this.model.taskGroups[n.projectId+"/"+n.id]=n}this.lazyRenderScheduler.schedule()},e.prototype.renderFastList=function(){this.debug("starting renderFastList()"),this.fastList.render(),this.debug("finished renderFastList()")},e.prototype.fillFastListElement=function(t,e){var s=e.data,n=t.childNodes;if(this.collectUnusedAvatars(t),t.classList.contains("kanban-dropzone")&&t.classList.remove("kanban-dropzone"),t.classList.contains("dropzone")&&t.classList.remove("dropzone"),t.setAttribute("draggable","false"),s.task){var i=s.taskCache;i||(i={createdCalendarDate:this.parent.helper.calendarDate(s.task.createdAt),createdDateWithHourLocal:this.parent.helper.dateWithHourLocal(s.task.createdAt),modifiedCalendarDate:this.parent.helper.calendarDate(s.task.modifiedAt),modifiedDateWithHourLocal:this.parent.helper.dateWithHourLocal(s.task.modifiedAt)},s.taskCache=i);var a=this.isKanban(),r=!this.model.settings["show-task-numbers"];a||this.isInRecentlyModifiedMode()||t.setAttribute("draggable","true");var l=s.context.projectId+"/"+s.context.taskGroupId+"/"+s.task.id,c=s.task.pinnedInTaskGroupIds.indexOf(s.context.taskGroupId)>=0,d=this.isTaskOverdue(s.task);t.className="entry entry-task"+(a?"":" dropzone")+(this.isTaskSelected(l)?" selected":"")+(this.isTaskCut(l)?" cut":"")+(c?" pinned":"")+(s.task.unread?" unread":"")+(d?" overdue":"")+" status-"+s.task.status,n[1].childNodes[0].className="task-label "+s.task.labelClass,n[1].childNodes[0].innerText="#"+(a&&r?"":s.task.id),n[2].childNodes[0].style.height=e.height-7+"px",n[2].childNodes[0].childNodes[0].childNodes[0].innerText=s.task.title,n[2].childNodes[0].childNodes[0].childNodes[2].innerText=s.task.description,n[3].className="for-task task-status "+s.task.labelClass+"-color",n[3].innerText=f.Task.getStatusText(s.task.status),this.hasAssignedToColumn&&this.appendAvatars(n[4],s.task.assignedTo),n[5].title=this.getAttachmentsString(s.task),n[5].innerText=this.getAttachmentsString(s.task),this.hasCreatedColumn&&(n[6].prepend(this.getAvatar(s.task.createdBy)),n[6].childNodes[1].innerText=i.createdCalendarDate,n[6].childNodes[1].title=i.createdDateWithHourLocal),this.hasModifiedColumn&&(n[7].prepend(this.getAvatar(s.task.modifiedBy)),n[7].childNodes[1].innerText=i.modifiedCalendarDate,n[7].childNodes[1].title=i.modifiedDateWithHourLocal);var p=n[2].childNodes[0].childNodes[1];p.childNodes[0].classList.toggle("hidden",0==s.task.nComments),p.childNodes[1].classList.toggle("hidden",0==s.task.attachments.length);var h=p.childNodes[2];h.classList.toggle("hidden",!s.task.startTimestamp),s.task.startTimestamp&&h.setAttribute("title",this.formatTaskDateRange(s.task.startTimestamp,s.task.endTimestamp,s.task.wholeDays));for(var u=3,m=u;m<p.childNodes.length;++m)p.childNodes[m].classList.toggle("hidden",!0);for(var g=this.model.settings["show-all-other-list-names"],k=(m=0,s.task.taskGroupIds.length);m<k;++m){var v=s.task.taskGroupIds[m];if(v!=s.context.taskGroupId){var y=this.model.taskGroups[v];if(!y)continue;if(!(T=this.model.projects[y.projectId]))continue;(S=p.childNodes[u])||(S=this.emptyTgBadgeTemplate.cloneNode(!0),p.append(S));var b=1;g||m+1!=k&&(m+2!=k||s.task.taskGroupIds[m+1]!=s.context.taskGroupId)||(b=s.task.taskGroupIds.length-1),this.fillTgBadge(S,y.name,T.pinnedTaskGroupIds.indexOf(v)>=0,y.icon,b),++u}}}else if(s.taskGroup){t.className="entry entry-taskgroup hover"+(s.taskGroup.isClosed?" closed":"")+(this.isKanban()?" kanban-dropzone":" dropzone")+(s.taskGroup.withUnread?" with-unread":"");var T;c=(T=this.model.projects[s.context.projectId])&&T.pinnedTaskGroupIds.indexOf(s.context.taskGroupId)>=0;n[8].colSpan=this.getCurrentNVisibleCols();for(var w=n[8].children[0].children[0].children[1].children[0].children[0];w.firstChild;)w.removeChild(w.firstChild);if(s.taskGroup.icon)(S=this.emptyTgIconTemplates[this.getIconId(s.taskGroup.icon)].cloneNode(!0)).style.color=s.taskGroup.icon.color,n[8].children[0].children[0].children[1].children[0].children[0].appendChild(S);n[8].children[0].children[0].children[1].children[0].children[1].innerText=s.computedName,n[8].children[0].children[0].children[1].children[0].title=s.computedName,n[8].children[0].children[0].children[1].children[0].classList.toggle("orphans-tg-label",s.taskGroup.isOrphans),n[8].className="for-taskgroup taskgroup"+(s.taskGroup.isCollapsed?" collapsed":""),n[8].classList.toggle("orphans-tg",s.taskGroup.isOrphans),n[8].classList.toggle("pinned",c),n[8].children[0].children[1].children[0].setAttribute("data-payload",s.taskGroup.id),n[8].children[0].children[1].children[0].setAttribute("data-taskgroup-project-id",s.taskGroup.projectId),n[8].children[0].children[1].children[1].setAttribute("data-payload",s.taskGroup.id),n[8].children[0].children[1].children[1].setAttribute("data-taskgroup-project-id",s.taskGroup.projectId),n[8].children[0].children[1].children[2].setAttribute("data-payload",s.taskGroup.id),n[8].children[0].children[1].children[2].setAttribute("data-taskgroup-project-id",s.taskGroup.projectId);var C=n[8].children[0].children[1].children[3];C.children[0].classList.toggle("hidden-o",s.context.isFirstPinnedTg||s.context.isFirstNotPinnedTg),C.children[1].classList.toggle("hidden-o",s.context.isFirstPinnedTg||s.context.isFirstNotPinnedTg),C.children[2].classList.toggle("hidden-o",s.context.isLastPinnedTg||s.context.isLastNotPinnedTg),C.children[3].classList.toggle("hidden-o",s.context.isLastPinnedTg||s.context.isLastNotPinnedTg),this.fillProgressBar(n[8].children[0].children[0].children[3],s.taskGroup.nTasksByStatus)}else if(s.header){t.className="entry entry-header"+(this.isKanban()?"":" dropzone");for(m=9;m<17;++m){var S;(S=t.children[m]).dataset.sortBy==this.fastListSettings.sortBy?S.className="for-header sorted-"+(this.fastListSettings.sortAsc?"asc":"desc"):S.className="for-header"}}else if(s.emptyTgInfo)t.className="entry entry-empty-tg-info"+(this.isKanban()?" kanban-dropzone":" dropzone"),n[17].colSpan=this.getCurrentNVisibleCols();else if(s.hiddenTasksInfo)t.className="entry entry-hidden-tasks-info",n[18].colSpan=this.getCurrentNVisibleCols(),n[18].children[0].textContent=this.parent.i18n("plugin.tasks.component.taskGroupsPanel.table.hiddenTasks.info",s.hiddenTasksInfo);else if(s.kanbanHeader)t.className="entry entry-kanban-header"+(this.isKanban()?" kanban-dropzone":"");else if(s.tasksByStatus){a=this.isKanban(),r=!this.model.settings["show-task-numbers"];t.className="entry entry-kanban-tasks"+(s.isLastTGRow?" last-row-in-tg":"");var I=this._statuses,D=I.length;for(m=0;m<D;++m){var E=s.tasksByStatus[I[m]],P=E?E.task:null,x=E?E.context:null,H=P&&x?x.projectId+"/"+x.taskGroupId:"",$=(l=P&&x?x.projectId+"/"+x.taskGroupId+"/"+P.id:"",n[23+m]),A=$.childNodes[0];t.setAttribute("data-kanban-has-"+I[m],P?"1":"0"),A.classList.toggle("empty",!P),A.classList.toggle("selected",P&&this.isTaskSelected(l)),A.classList.toggle("unread",P&&P.unread),$.classList.toggle("with-task",!!P),$.classList.toggle("no-task",!P),$.classList.toggle("unassigned",P&&0==P.assignedTo.length),$.setAttribute("data-kanban-dropzone-taskgroup-full-id",H),A.setAttribute("draggable",P?"true":"false"),A.setAttribute("data-task-full-id",l),A.childNodes[0].childNodes[0].textContent=P?"#"+(a&&r?"":P.id):"",A.childNodes[0].childNodes[0].className="task-label "+(P?P.labelClass+" has-task-tooltip":""),A.childNodes[0].childNodes[0].setAttribute("data-task-id",P?P.id:""),o.JQuery(A.childNodes[0].childNodes[0]).data("task-id",P?P.id:""),A.childNodes[0].childNodes[1].textContent=P?P.title:"",A.childNodes[0].childNodes[2].textContent=P&&P.description?" "+P.description:"";var M=A.childNodes[1],_=M.childNodes[0],G=M.childNodes[1],L=M.childNodes[2];G.textContent=P?this.parent.helper.calendarDate(P.modifiedAt):"",G.title=P?this.parent.helper.dateWithHourLocal(P.modifiedAt):"",P&&_.prepend(this.getAvatar(P.modifiedBy)),L.textContent="",P&&this.appendAvatars(L,P.assignedTo)}}t.style.height=e.height+"px"},e.prototype.getCurrentNVisibleCols=function(){return this.isKanban()?this.model.settings["kanban-filter"]==h.Filter.onlyNotDone?3:4:this.nVisibleCols},e.prototype.fillProgressBar=function(t,e){var s=0;for(var n in e)s+=e[n];for(var i=0;i<this._statuses.length;++i){var a=t.children.length-i-1,o=t.children[a],r=e[this._statuses[i]];o.innerText=""+r,o.style.width=(0==s?0:100*r/s)+"%"}},e.prototype.fillTgBadge=function(t,e,s,n,i){var a=null;n&&((a=this.emptyTgIconTemplates[this.getIconId(n)].cloneNode(!0)).style.color=n.color);t.classList.toggle("hidden",!1),t.childNodes[0].classList.toggle("pinned",s),t.childNodes[0].title=e,t.childNodes[0].childNodes[0].classList.toggle("hidden",1==i),i>1&&(t.childNodes[0].childNodes[0].innerText="("+i+")");for(var o=t.childNodes[0].childNodes[1];o.firstChild;)o.removeChild(o.firstChild);a&&o.appendChild(a),t.childNodes[0].childNodes[2].innerText=e},e.prototype.formatTaskDateRange=function(t,e,s){var n=new Date(t),i=new Date(e),a=function(t){return(t<10?"0":"")+t};return n.getDate()==i.getDate()&&n.getMonth()==i.getMonth()&&n.getFullYear()==i.getFullYear()?s?this.formatDate(n,!0):this.formatDate(n)+" - "+a(i.getHours())+":"+a(i.getMinutes()):this.formatDate(n,s)+" - "+this.formatDate(i,s)},e.prototype.formatDate=function(t,e){void 0===e&&(e=!1);var s=function(t){return(t<10?"0":"")+t},n=s(t.getDate())+"."+s(t.getMonth()+1)+"."+t.getFullYear();return e||(n+=" "+s(t.getHours())+":"+s(t.getMinutes())),n},e.prototype.beforeFastListRender=function(){var t=new Date;this.nowTimestamp=t.getTime(),this.nowDMY={day:t.getDate(),month:t.getMonth(),year:t.getFullYear()}},e.prototype.afterFastListRender=function(t){this.hasAvatarsToRender&&this.personsComponent.$main&&(this.hasAvatarsToRender=!1,this.personsComponent.refreshAvatars()),this.visibleTaskGroupElements={};for(var e=this.fastList.entriesContainer.childElementCount,s=0;s<e;++s){var n=this.fastList.entriesContainer.children[s];if(n.classList.contains("entry-taskgroup")){var i=parseInt(n.dataset.entryId),a=this.fastList.entries[i];if(a){var o=a.data.context.projectId+"/"+a.data.context.taskGroupId;this.visibleTaskGroupElements[o]=n}}}this.updateHoverTaskGroup()},e.prototype.beforeFastListDeleteElement=function(t){this.collectUnusedAvatars(t)},e.prototype.createFastListEmptyElement=function(){return this.emptyEntryTemplate.cloneNode(!0)},e.prototype.getAttachmentsString=function(t){if(!t.attachments)return"";if(t._cached_attachments)return t._cached_attachments;var e=t.attachments.length>0?"("+t.attachments.length+") "+t.attachments.map((function(t){return JSON.parse(t).name})).join(", "):"";return t._cached_attachments=e,e},e.prototype.appendAvatars=function(t,e){for(var s=0,n=e;s<n.length;s++){var i=n[s];t.append(this.getAvatar(i))}},e.prototype.createAvatar=function(){var t=document.createElement("canvas");t.className="icon not-rendered",t.setAttribute("data-auto-refresh","true"),t.setAttribute("data-auto-size","true");var e=document.createElement("span");return e.className="av-cnv",e.append(t),e},e.prototype.getAvatar=function(t){if(this.freeAvatars[t]&&this.freeAvatars[t].length>0)return this.freeAvatars[t].pop();this.freeAvatars[t]||(this.freeAvatars[t]=[]);var e=this.createAvatar();return e.childNodes[0].setAttribute("data-hashmail-image",t),e.childNodes[0].setAttribute("data-tooltip-trigger",t),this.hasAvatarsToRender=!0,e},e.prototype.collectUnusedAvatars=function(t){for(var e=o.JQuery(t).find(".av-cnv"),s=e.length-1;s>=0;--s){var n=e[s],i=n.childNodes[0].getAttribute("data-hashmail-image");this.freeAvatars[i]||(this.freeAvatars[i]=[]),this.freeAvatars[i].push(n),n.remove()}},e.prototype.removeTextNodes=function(t){for(var e=t.childNodes.length-1;e>=0;--e){var s=t.childNodes[e];if(s.nodeType==Node.TEXT_NODE||s.nodeType==Node.COMMENT_NODE)s.remove();else if(s.nodeType==Node.ELEMENT_NODE){if("1"==s.dataset.keepText)continue;this.removeTextNodes(s)}}},e.prototype.grabFocus=function(){this.$container.children(".panel").focus()},e.prototype.isTaskOverdue=function(t){return"done"!=t.status&&(!!this.nowDMY&&(t.wholeDays?t.overdueInfo.year!=this.nowDMY.year?t.overdueInfo.year<this.nowDMY.year:t.overdueInfo.month!=this.nowDMY.month?t.overdueInfo.month<this.nowDMY.month:t.overdueInfo.day!=this.nowDMY.day&&t.overdueInfo.day<this.nowDMY.day:t.overdueInfo.timestamp<this.nowTimestamp))},e.prototype.onSizeChanged=function(t){this.$container.toggleClass("collapse-header-button-texts",t<520),this.$settingsMenu&&this.$settingsMenu.hasClass("visible")&&this.$settingsMenu.removeClass("visible"),this.$container.toggleClass("hide-progress",t<440)},e.prototype.onSettingsButtonClick=function(t){var e=o.JQuery(t.currentTarget).next();this.$settingsMenu.children(".context-menu-content").css("right",Math.round(e.outerWidth(!0))-30),this.$settingsMenu.addClass("visible")},e.prototype.onSettingsMenuBackdropClick=function(){this.$settingsMenu.removeClass("visible")},e.prototype.onSettingChanged=function(t){var e=o.JQuery(t.currentTarget).data("setting"),s=!this.model.settings[e];this.settingChanged(e,s)},e.prototype.onTaskMouseDown=function(t){var e=this,s=this.getPointerEntryId(),n=t.currentTarget;this.isKanban()&&"TD"==n.tagName&&(n=n.childNodes[0]);var i=this.buildPointer(n);if(i){var a=i.projectId+"/"+i.taskGroupId+"/"+i.taskId;o.Q().then((function(){if(e.previewDirty)return e.previewExit=o.Q.defer(),e.triggerEvent("confirmPreviewExit"),e.previewExit.promise})).then((function(){if(t.ctrlKey||t.metaKey)e.toggleTaskSelection(a);else if(t.shiftKey)e.selectRange(s,i.entryId);else{var n=e.selectedTasks.includes(a);e.selectTask(a,!n)}e.pointer=i,e.updateClasses(),e.renderFastList(),e.notifySelectionChanged()}))}},e.prototype.onTaskMouseUp=function(t){var e=this;if(!(t.ctrlKey||t.metaKey||t.shiftKey)){this.getPointerEntryId();var s=t.currentTarget;this.isKanban()&&"TD"==s.tagName&&(s=s.childNodes[0]);var n=this.buildPointer(s);if(n){var i=n.projectId+"/"+n.taskGroupId+"/"+n.taskId;o.Q().then((function(){if(e.previewDirty)return e.previewExit=o.Q.defer(),e.triggerEvent("confirmPreviewExit"),e.previewExit.promise})).then((function(){e.selectTask(i,!0),e.pointer=n,e.updateClasses(),e.renderFastList(),e.notifySelectionChanged()}))}}},e.prototype.onTaskDoubleClick=function(t){if(!o.JQuery(t.target).is("i.fa.fa-thumb-tack")){var e=t.currentTarget;if(e.classList.contains("kanban-task-box-content")){if(!e.classList.contains("empty")){var s=e.dataset.taskFullId.split("/")[2];this.triggerEvent("openTaskWindow",s,!0)}}else{var n=this.getEntry(e);this.triggerEvent("openTaskWindow",n.data.task.id,!0)}}},e.prototype.onNewTaskGroupClick=function(t){t.stopPropagation();var e=t.currentTarget.getAttribute("data-payload")+"";e||(e=this.model.projectId),this.$settingsMenu.removeClass("visible"),this.triggerEvent("newTaskGroup",e)},e.prototype.onEditTaskGroupClick=function(t){var e=t.currentTarget.getAttribute("data-payload")+"",s=t.currentTarget.getAttribute("data-taskgroup-project-id")+"";this.triggerEvent("editTaskGroup",s,e)},e.prototype.onPasteIntoTaskGroupClick=function(t){var e=t.currentTarget.getAttribute("data-payload")+"",s=t.currentTarget.getAttribute("data-taskgroup-project-id")+"";this.pasteTasks(e,s)},e.prototype.onNewTaskClick=function(t){var e=o.JQuery(t.currentTarget),s=t.currentTarget.getAttribute("data-payload")+"",n=t.currentTarget.getAttribute("data-taskgroup-project-id")+"";s&&"__"==s.substr(0,2)&&(s="__orphans__"),!n&&e.is('[data-action-id="item-new-task"]')&&this.model.projectId!=h.CustomTasksElements.ALL_TASKS_ID&&this.model.projectId!=h.CustomTasksElements.TASKS_ASSIGNED_TO_ME_ID&&this.model.projectId!=h.CustomTasksElements.TASKS_CREATED_BY_ME_ID&&(n=this.model.projectId),this.triggerEvent("newTask",n,s)},e.prototype.onDeleteTaskClick=function(t){this.selectedTasks&&0!=this.selectedTasks.length&&(this.lockSelection(),this.triggerEvent("deleteTasks",JSON.stringify(this.selectedTasks)))},e.prototype.onRestoreTaskClick=function(t){this.selectedTasks&&0!=this.selectedTasks.length&&(this.lockSelection(),this.triggerEvent("restoreTasks",JSON.stringify(this.selectedTasks)))},e.prototype.onTaskGroupHeaderClick=function(t){for(var e=o.JQuery(t.target),s=!1,n=0,i=["div.taskgroup-header","div.left","div.right","span.taskgroup-label","div.progress",'[data-action="taskgroup-toggle-collapsed"]',"i.fa.fa-caret-down"];n<i.length;n++){var a=i[n];e.is(a)&&(s=!0)}if(!s&&e.parent().is(".progress")&&(s=!0),s){var r=e.closest(".entry")[0],l=this.fastList.entries[Number(r.getAttribute("data-entry-id"))];if(l.data.taskGroup.isCollapsed=!l.data.taskGroup.isCollapsed,t.ctrlKey||t.metaKey)this.setAllCollapsed(l.data.taskGroup.isCollapsed);else{var c=this.collapsedTaskGroups,d=l.data.taskGroup.projectId+"/"+l.data.taskGroup.id,p=c.indexOf(d);p>=0!=l.data.taskGroup.isCollapsed&&(l.data.taskGroup.isCollapsed?c.push(d):p>=0&&c.splice(p,1)),this.saveCollapsed()}}},e.prototype.onToggleCollapsedAllClick=function(t){this.setAllCollapsed(!this.$container.hasClass("all-collapsed"))},e.prototype.setAllCollapsed=function(t){var e=[];for(var s in this.model.taskGroups){var n=this.model.taskGroups[s];n.isCollapsed=t,t&&e.push(n.projectId+"/"+n.id)}this.collapsedTaskGroups=e,this.saveCollapsed()},e.prototype.saveCollapsed=function(){this.model.settings["collapsed-taskgroups"]=JSON.stringify(this.collapsedTaskGroups),this.triggerEvent("settingChanged","collapsed-taskgroups",this.model.settings["collapsed-taskgroups"],!0),this.repaint()},e.prototype.onTaskGroupMoveToTop=function(t){this.moveTaskGroup(t.target,-999999)},e.prototype.onTaskGroupMoveUp=function(t){this.moveTaskGroup(t.target,-1)},e.prototype.onTaskGroupMoveDown=function(t){this.moveTaskGroup(t.target,1)},e.prototype.onTaskGroupMoveToBottom=function(t){this.moveTaskGroup(t.target,999999)},e.prototype.moveTaskGroup=function(t,e){var s=o.JQuery(t).closest(".entry")[0],n=this.getEntry(s);n&&n.data.taskGroup&&this.triggerEvent("moveTaskGroup",n.data.taskGroup.id,e)},e.prototype.onPinTaskGroupClick=function(t){if(!this.showsFixedSection()&&!this.model.isConv2Section){var e=o.JQuery(t.currentTarget).closest(".entry")[0],s=this.getEntry(e);if(s&&s.data.taskGroup){var n=s.data.taskGroup.id,i=this.model.projects[s.data.taskGroup.projectId];if(i){var a=i.pinnedTaskGroupIds.indexOf(n)<0;this.triggerEvent("toggleTaskGroupPinned",n,a)}}}},e.prototype.onPinTaskClick=function(t){if(!this.showsFixedSection()&&!this.model.isConv2Section){var e=o.JQuery(t.currentTarget).closest(".entry")[0],s=this.getEntry(e);if(s&&s.data.task){var n=s.data.task,i=s.data.context.taskGroupId,a=n.pinnedInTaskGroupIds.indexOf(i)<0;this.triggerEvent("toggleTaskPinned",n.id,i,a)}}},e.prototype.onFullRefreshClick=function(){this.triggerEvent("fullRefresh",!0,!0)},e.prototype.onMarkAllAsReadClick=function(t){t.stopPropagation(),this.$settingsMenu.removeClass("visible"),this.triggerEvent("markAllAsRead")},e.prototype.onTableHeaderClick=function(t){if(!this.preventSort){var e=o.JQuery(t.currentTarget).data("sort-by");this.fastListSettings.sortBy==e?this.fastListSettings.sortAsc=!this.fastListSettings.sortAsc:this.fastListSettings.sortBy=e,this.repaint()}},e.prototype.onColResizerMouseDown=function(t){var e=this;this.preventSort=!0;var s=o.JQuery(t.currentTarget),n=s.closest("th");0==n.length&&(n=s.closest("td.for-header"));var i=n.prevAll(":visible").first();if(this.colResizerPos0=i.outerWidth(),this.colResizerPos1=n.outerWidth(),this.colResizerClient0=t.clientX,this.colResizerLeftCol=i.data("col"),this.colResizerRightCol=n.data("col"),this.$colResizerLeftCols=this.$container.find("col[data-col='"+i.data("col")+"']"),this.$colResizerRightCols=this.$container.find("col[data-col='"+n.data("col")+"']"),this.colResizerPosMin=20,this.colResizerPosMax=this.colResizerPos0+this.colResizerPos1-this.colResizerPosMin,t.ctrlKey||t.metaKey){var a=this.$colResizerLeftCols.data("default-width");null!=a&&this.$colResizerLeftCols.css("width",a),null!=(a=this.$colResizerRightCols.data("default-width"))&&this.$colResizerRightCols.css("width",a),setTimeout((function(){e.preventSort=!1}),100);var r={};return"task"!=this.colResizerLeftCol&&(r[this.colResizerLeftCol]=parseInt(this.$colResizerLeftCols.css("width")),this.model.colWidths[this.colResizerLeftCol]=r[this.colResizerLeftCol]),"task"!=this.colResizerRightCol&&(r[this.colResizerRightCol]=parseInt(this.$colResizerRightCols.css("width")),this.model.colWidths[this.colResizerRightCol]=r[this.colResizerRightCol]),this.triggerEvent("setColWidths",JSON.stringify(r)),void this.updateTaskHeights()}o.JQuery(document).on("mouseup",this.onColResizerDocumentMouseUpBound),o.JQuery(document).on("mousemove",this.onColResizerDocumentMouseMoveBound)},e.prototype.onColResizerDocumentMouseUp=function(t){var e=this;o.JQuery(document).off("mouseup",this.onColResizerDocumentMouseUpBound),o.JQuery(document).off("mousemove",this.onColResizerDocumentMouseMoveBound),setTimeout((function(){e.preventSort=!1}),100);var s={};"task"!=this.colResizerLeftCol&&(s[this.colResizerLeftCol]=parseInt(this.$colResizerLeftCols.css("width")),this.model.colWidths[this.colResizerLeftCol]=s[this.colResizerLeftCol]),"task"!=this.colResizerRightCol&&(s[this.colResizerRightCol]=parseInt(this.$colResizerRightCols.css("width")),this.model.colWidths[this.colResizerRightCol]=s[this.colResizerRightCol]),this.triggerEvent("setColWidths",JSON.stringify(s)),this.updateTaskHeights()},e.prototype.onColResizerDocumentMouseMove=function(t){var e=t.clientX-this.colResizerClient0,s=Math.min(this.colResizerPosMax,Math.max(this.colResizerPosMin,this.colResizerPos0+e));"task"!=this.colResizerLeftCol&&this.$colResizerLeftCols.css("width",s),"task"!=this.colResizerRightCol&&this.$colResizerRightCols.css("width",this.colResizerPos1-(s-this.colResizerPos0))},e.prototype.onCutClick=function(){this.cutSelectedTasks()},e.prototype.onCopyClick=function(){this.copySelectedTasks()},e.prototype.onPasteClick=function(){this.pasteTasksIntoSelection()},e.prototype.onMoveClick=function(t){this.$container.hasClass("no-taskgroups")||this.$container.hasClass("no-task-selected")||this.model.combinesMultipleSections||this.moveTasks()},e.prototype.onShowHiddenTasksClick=function(t){this.settingChanged("show-orphans",!0,!0)},e.prototype.onKeyDown=function(t){var e=this;if("x"!=t.key&&"X"!=t.key||!t.ctrlKey&&!t.metaKey)if("c"!=t.key&&"C"!=t.key||!t.ctrlKey&&!t.metaKey)if("v"!=t.key&&"V"!=t.key||!t.ctrlKey&&!t.metaKey)if("Delete"==t.key)this.lockSelection(),t.stopPropagation(),this.triggerEvent("deleteTasks",JSON.stringify(this.selectedTasks));else if("ArrowUp"==t.key||"ArrowDown"==t.key){if(this.taskSelectionLocked)return;t.stopPropagation();var s="ArrowDown"==t.key,n=void 0;t.shiftKey?(t.altKey&&(s=!s),(n=s?this.getLastSelectionEntryId():this.getFirstSelectionEntryId())<0&&(n=this.getPointerEntryId()),t.altKey||(n=this.getClosestTaskEntryId(n,s?1:-1))):n=this.getClosestTaskEntryId(this.getPointerEntryId(),s?1:-1);var i=this.getPointerFromId(n);if(null!=i){var a=i.projectId+"/"+i.taskGroupId+"/"+i.taskId;o.Q().then((function(){if(e.previewDirty)return e.previewExit=o.Q.defer(),e.triggerEvent("confirmPreviewExit"),e.previewExit.promise})).then((function(){t.shiftKey?t.altKey?e.deselectTask(a):e.selectTask(a,!1):e.selectTask(a,!0),e.fastList.scrollTo(i.entryId),e.pointer=i,e.updateClasses(),e.renderFastList(),e.notifySelectionChanged()}))}}else"Enter"==t.key?(t.stopPropagation(),1==this.selectedTasks.length&&this.triggerEvent("openTaskWindow",this.selectedTasks[0].split("/")[2],!0)):"Escape"==t.key&&(t.stopPropagation(),this.getClipboardIsCut()&&this.updateClipboard(this.getClipboardTasks(),!1),this.updateClasses(),o.Q().then((function(){if(e.previewDirty)return e.previewExit=o.Q.defer(),e.triggerEvent("confirmPreviewExit"),e.previewExit.promise})).then((function(){e.deselectTasks(e.getSelectedTaskIds()),e.updateClasses(),e.renderFastList(),e.notifySelectionChanged()})));else t.stopPropagation(),this.pasteTasksIntoSelection();else t.stopPropagation(),this.copySelectedTasks();else t.stopPropagation(),this.cutSelectedTasks()},e.prototype.confirmPreviewExit=function(){this.previewExit&&this.previewExit.resolve()},e.prototype.onEntryMouseOver=function(t){var e=this.getEntry(t.currentTarget);if(e.data.context){var s=e.data.context.projectId+"/"+e.data.context.taskGroupId;this.hoverTaskGroup!=s&&(this.hoverTaskGroup=s,this.updateHoverTaskGroup())}},e.prototype.onEntryMouseOut=function(t){var e=this.getEntry(t.currentTarget);e.data.context&&this.hoverTaskGroup==e.data.context.projectId+"/"+e.data.context.taskGroupId&&(this.hoverTaskGroup=null,this.updateHoverTaskGroup())},e.prototype.updateHoverTaskGroup=function(){for(var t in this.visibleTaskGroupElements){this.visibleTaskGroupElements[t].classList.toggle("hover",this.hoverTaskGroup==t)}},e.prototype.getEntry=function(t){var e=Number(t.dataset.entryId);return this.fastList.entries[e]},e.prototype.onTgBadgeMouseEnter=function(t){this.model.settings["show-all-other-list-names"]||o.JQuery(t.currentTarget).closest(".task-taskgroups-badges").addClass("hover")},e.prototype.onTgBadgeMouseLeave=function(t){o.JQuery(t.currentTarget).removeClass("hover")},e.prototype.activate=function(){var t=this;this.isActive=!0,o.Q().then((function(){if(t.repaint(),!t.isContainerReady())return t.repaintWhenReady()}))},e.prototype.deactivate=function(){this.isActive=!1},e.prototype.applySearchFilter=function(t){this.currSearchFilter=t,this.isActive&&(this.updateFastListEntries(),this.renderFastList())},e.prototype.getSelectedTaskIds=function(){return this.selectedTasks},e.prototype.getFirstSelectedTaskGroupIds=function(){for(var t=null,e=0,s=this.fastList.entries.length;e<s;++e){var n=this.fastList.entries[e];if(n&&n.data.task){t||(t=[n.data.context.projectId,n.data.context.taskGroupId]);var i=n.data.context.projectId+"/"+n.data.context.taskGroupId+"/"+n.data.task.id;if(this.isTaskSelected(i)&&!this.isTaskCut(i))return[n.data.context.projectId,n.data.context.taskGroupId]}}return t},e.prototype.lockSelection=function(){this.taskSelectionLocked=!0},e.prototype.unLockSelection=function(){this.taskSelectionLocked=!1},e.prototype.selectTask=function(t,e){e&&this.deselectTasks(this.getSelectedTaskIds()),this.selectTasks([t],e)},e.prototype.selectTasks=function(t,e){e&&(this.selectedTasks=[]);for(var s=0,n=t;s<n.length;s++){var i=n[s];this.isTaskSelected(i)||this.selectedTasks.push(i)}},e.prototype.deselectTask=function(t){this.deselectTasks([t])},e.prototype.deselectTasks=function(t){for(var e=!1,s=[],n=this.model.settings[this.isKanban()?"kanban-filter":"filter"],i=0,a=this.selectedTasks;i<a.length;i++){var o=a[i];t.indexOf(o)<0?s.push(o):n==h.Filter.onlyUnread&&(e=!0)}this.selectedTasks=s,e&&this.updateFastListEntries()},e.prototype.isTaskSelected=function(t){return this.selectedTasks.indexOf(t)>=0},e.prototype.isTaskSelectedInAnyRow=function(t){for(var e="/"+t,s=0;s<this.selectedTasks.length;++s){var n=this.selectedTasks[s];if(n.lastIndexOf(e)==n.length-e.length)return!0}return!1},e.prototype.toggleTaskSelection=function(t){this.isTaskSelected(t)?this.deselectTask(t):this.selectTask(t,!1)},e.prototype.selectRange=function(t,e){if(t!=e)for(var s=Math.min(t,e),n=Math.max(t,e),i=s;i<=n;++i)this.selectTaskByEntryId(i);else this.selectTaskByEntryId(t)},e.prototype.selectTaskByEntryId=function(t){var e=this.fastList.entries[t];e&&e.data.task&&this.selectTask(e.data.context.projectId+"/"+e.data.context.taskGroupId+"/"+e.data.task.id,!1)},e.prototype.getPointerEntryId=function(){var t=this.pointer,e=this.fastList.entries[t.entryId];if(e)if(e.data.tasksByStatus)for(var s in e.data.tasksByStatus){if((r=e.data.tasksByStatus[s])&&r.context.projectId==t.projectId&&r.context.taskGroupId==t.taskGroupId&&r.task&&r.task.id==t.taskId)return t.entryId}else if(e.data.context.projectId==t.projectId&&e.data.context.taskGroupId==t.taskGroupId&&e.data.task&&e.data.task.id==t.taskId)return t.entryId;e=null;var n=0,i=-1;for(n=this.fastList.entries.length-1;n>=0;--n){var a=this.fastList.entries[n];if(a.data.task){if(i=n,a.data.task.id==t.taskId&&a.data.context.taskGroupId==t.taskGroupId&&a.data.context.projectId==t.projectId){e=a;break}}else if(a.data.tasksByStatus)for(var o in i=n,a.data.tasksByStatus){var r;if((r=a.data.tasksByStatus[o])&&r.task.id==t.taskId&&r.context.taskGroupId==t.taskGroupId&&r.context.projectId==t.projectId)return t.entryId}}return e?n:i},e.prototype.getPointerFromId=function(t){var e=this.fastList.entries[t];return e&&e.data.task?{entryId:t,projectId:e.data.context.projectId,taskGroupId:e.data.context.taskGroupId,taskId:e.data.task.id}:null},e.prototype.getClosestTaskEntryId=function(t,e){for(;;){t+=e;var s=this.fastList.entries[t];if(!s)return-1;if(s.data.task)return t}},e.prototype.getFirstSelectionEntryId=function(){for(var t=0,e=this.fastList.entries.length;t<e;++t){var s=this.fastList.entries[t];if(s.data.task){var n=s.data.context.projectId+"/"+s.data.context.taskGroupId+"/"+s.data.task.id;if(this.selectedTasks.indexOf(n)>=0)return t}}return-1},e.prototype.getLastSelectionEntryId=function(){for(var t=this.fastList.entries.length-1;t>=0;--t){var e=this.fastList.entries[t];if(e.data.task){var s=e.data.context.projectId+"/"+e.data.context.taskGroupId+"/"+e.data.task.id;if(this.selectedTasks.indexOf(s)>=0)return t}}return-1},e.prototype.buildPointer=function(t){var e=this.getEntry(t),s=null;if(e)s={entryId:Number(t.dataset.entryId),taskId:e.data.task.id,taskGroupId:e.data.context.taskGroupId,projectId:e.data.context.projectId};else if(t.classList.contains("kanban-task-box-content")){if(t.classList.contains("empty"))return null;var n=t.dataset.taskFullId.split("/"),i=n[0],a=n[1],o=n[2];s={entryId:Number(t.parentElement.parentElement.dataset.entryId),taskId:o,taskGroupId:a,projectId:i}}return s},e.prototype.notifySelectionChanged=function(){this.triggerEvent("selectionChanged",JSON.stringify(this.selectedTasks))},e.prototype.isTaskCut=function(t){return this.getClipboardIsCut()&&this.isTaskInClipboard(t)},e.prototype.cutSelectedTasks=function(){this.cutTasks(this.getSelectedTaskIds()),this.triggerEvent("notifyTasksCut",this.getClipboardTasksCount())},e.prototype.copySelectedTasks=function(){this.copyTasks(this.getSelectedTaskIds()),this.triggerEvent("notifyTasksCopied",this.getClipboardTasksCount()),this.triggerEvent("copyTasksToClipboard",JSON.stringify(this.getSelectedTaskIds()))},e.prototype.pasteTasksIntoSelection=function(){this.triggerEvent("paste")},e.prototype.doPasteTasksIntoSelection=function(){if(!this.isClipboardEmpty()){var t=this.getFirstSelectedTaskGroupIds();if(t){var e=t[0],s=t[1];this.isInRecentlyModifiedMode()&&(s="__orphans__"),this.pasteTasks(s,e)}}},e.prototype.moveTasks=function(){this.triggerEvent("moveTasks",JSON.stringify(this.getSelectedTaskIds()))},e.prototype.cutTasks=function(t){this.addToClipboard(t,!0),this.updateClasses(),this.renderFastList()},e.prototype.copyTasks=function(t){this.addToClipboard(t,!1),this.updateClasses()},e.prototype.pasteTasks=function(t,e){this.isClipboardEmpty()||(this.getClipboardIsCut()?(this.triggerEvent("changeTasksParent",JSON.stringify(this.getClipboardTasks()),t,e),this.updateClipboard(this.getClipboardTasks(),!1),this.updateClasses()):this.triggerEvent("duplicateTasks",JSON.stringify(this.getClipboardTasks()),t,e),setTimeout((function(){o.JQuery("tr.cut").removeClass("cut")}),250))},e.prototype.setTask=function(t,e){var s=JSON.parse(t);this.model.tasks[s.id]=s,null!==e&&(this.tasksLines[s.id]=e),this.lazyRenderScheduler.schedule()},e.prototype.setTaskGroup=function(t){var e=JSON.parse(t);this.model.taskGroups[e.id]=e,this.lazyRenderScheduler.schedule()},e.prototype.setProject=function(t){var e=JSON.parse(t);this.model.projects[e.id]=e,this.lazyRenderScheduler.schedule()},e.prototype.delTask=function(t){t in this.model.tasks&&(delete this.model.tasks[t],this.repaint())},e.prototype.delTaskGroup=function(t){delete this.model.taskGroups[t],this.repaint()},e.prototype.delProject=function(t){delete this.model.projects[t],this.repaint()},e.prototype.setColWidths=function(t){if(this.$container){var e="string"==typeof t?JSON.parse(t):t;for(var s in e){var n=e[s],i=this.$container.find("col[data-col='"+s+"']");i&&i.css("width",n)}}},e.prototype.updateUnread=function(t,e){var s=JSON.parse(t),n=JSON.parse(e);for(var i in s){var a=this.model.tasks[i];a&&(a.unread=s[i])}for(var o in n){var r=this.model.taskGroups[o];r&&(r.withUnread=n[o])}this.repaint()},e.prototype.getTaskTextAvailableWidth=function(){var t=this.$container.width();for(var e in t-=6,this.model.colWidths){!!this.model.settings["show-"+e+"-column"]&&("hash-id"!=e||this.model.settings["show-task-numbers"]?t-=this.model.colWidths[e]:t-=28)}return t-=10},e.prototype.updateTaskHeights=function(t,e){var s=this;if(void 0===t&&(t=null),void 0===e&&(e=!0),!this.model.settings["show-full-task-descriptions"])return o.Q();var n=this.getTaskTextAvailableWidth();if(null===t){if(n==this.prevTasksHeightRecalcAvailWidth)return o.Q();this.prevTasksHeightRecalcAvailWidth=n}else this.prevTasksHeightRecalcAvailWidth=null;return this.channelPromise("countTaskLines",t?JSON.stringify(t):null,n).then((function(n){var i=JSON.parse(n);if(t)for(var a=0,o=t;a<o.length;a++){var r=o[a];s.tasksLines[r]=i[r]}else s.tasksLines=i;e&&(s.updateFastListEntries(),s.renderFastList())}))},e.prototype.getTaskHeight=function(t){if(!this.model.settings["show-full-task-descriptions"]||!this.model.settings["show-task-column"])return this.fastListSettings.hTask;var e=this.tasksLines[t];e||(e=1);var s=this.fastListSettings.hTask;return e>1&&(s+=this.fastListSettings.hTask2ndLine,s+=this.fastListSettings.hTaskNextLines*(e-2)),s},e.prototype.onContainerWidthChanged=function(){this.model&&this.model.settings["show-full-task-descriptions"]&&this.updateTaskHeights(null,this.isActive)},e.prototype.onContainerHeightChanged=function(){this.model&&this.isActive&&this.renderFastList()},e.prototype.onContainerWidthChangedStep=function(){var t=this;if(this.model&&this.model.settings["show-full-task-descriptions"]){this._onContainerWidthChangedTO&&(clearTimeout(this._onContainerWidthChangedTO),this._onContainerWidthChangedTO=null),this._onContainerWidthChangedTO=setTimeout((function(){t.onContainerWidthChanged()}),500);var e=this.fastList.visibleRange[0],s=this.fastList.visibleRange[1],n=s-e+1;e=Math.max(0,e-n),s=Math.min(this.fastList.entries.length-1,s+n);for(var i=[],a=e;a<=s;++a){var o=this.fastList.entries[a];o.data.task&&i.push(o.data.task.id)}this.updateTaskHeights(i,this.isActive)}},e.prototype.onContainerHeightChangedStep=function(){this.model&&this.isActive&&this.renderFastList()},e.prototype.onFilterChange=function(t){t&&this.settingChanged(this.isKanban()?"kanban-filter":"filter",t)},e.prototype.meetsFilter=function(t,e){return t==h.Filter.allTasks||(t==h.Filter.onlyUnread?!(e.unread||!this.isTaskSelectedInAnyRow(e.id))||e.unread:t==h.Filter.onlyIdea?e.status==f.TaskStatus.IDEA:t==h.Filter.onlyTodo?e.status==f.TaskStatus.TODO:t==h.Filter.onlyInProgress?e.status==f.TaskStatus.INPROGRESS:t==h.Filter.onlyDone?e.status==f.TaskStatus.DONE:t!=h.Filter.onlyNotDone||e.status!=f.TaskStatus.DONE)},e.prototype.updatePersonPresence=function(t,e){this.$container.find("[data-person-hashmail='"+t+"']").toggleClass("present",e)},e.prototype.isKanban=function(){return!this.isSummaryWindow&&!!this.getSetting("kanban-mode")},e.prototype.isClipboardEmpty=function(){return!this.clipboardData||0==this.clipboardData.fullTaskIds.length},e.prototype.getClipboardTasksCount=function(){return this.clipboardData?this.clipboardData.fullTaskIds.length:0},e.prototype.getClipboardTasks=function(){return this.clipboardData?this.clipboardData.fullTaskIds:[]},e.prototype.getClipboardIsCut=function(){return!!this.clipboardData&&this.clipboardData.isCut},e.prototype.addToClipboard=function(t,e){this.clipboardElementAddedAt=new Date,this.clipboardData={type:"__privmx_tasks__",fullTaskIds:t,isCut:e},this.triggerEvent("addToClipboard",JSON.stringify(this.clipboardData),this.clipboardElementAddedAt.getTime())},e.prototype.updateClipboard=function(t,e){this.clipboardData&&(this.clipboardData.fullTaskIds=t,this.clipboardData.isCut=e,this.triggerEvent("updateClipboard",JSON.stringify(this.clipboardData),this.clipboardElementAddedAt.getTime()))},e.prototype.isTaskInClipboard=function(t){return this.getClipboardTasks().indexOf(t)>=0},e.prototype.updateFromClipboard=function(t,e,s){void 0===s&&(s=!1);var n=new Date(e),i=JSON.parse(t);this.clipboardElementAddedAt=n,this.clipboardData=i,s&&this.doPasteTasksIntoSelection()},e}(o.component.base.ComponentView);s.TaskGroupsPanelView=b,b.prototype.className="com.privmx.plugin.tasks.component.taskGroupsPanel.TaskGroupsPanelView"},{"../../main/FastList":16,"../../main/TaskGroupsSorter":20,"../../main/TasksSorter":21,"../../main/Types":22,"../../main/data/Task":24,"../../main/utils/DragDrop":25,"../../window/taskGroupForm/template/icon.html":37,"../iconPicker/IconPickerData":4,"./LazyRenderScheduler":5,"./template/entry.html":7,"./template/main.html":8,"./template/taskgroup.html":9,"./template/tg-badge.html":10,"pmc-web":1}],7:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="",i=function(t){n+=t};i('<tr class="entry">\n  <td class="for-task task-unread"></td>\n  <td class="for-task task-id"><span class="task-label"></span><button class="pin pin-task"><i class="fa fa-thumb-tack"></i></button></td>\n  <td class="for-task task-text">\n    <div class="task-main-cell">\n      <div class="task-main-cell-text" data-keep-text="1"><strong></strong> <span></span></div>\n      <ul class="task-taskgroups-badges">\n        <li class="has-comments-icon" title="'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.task.hasComments"))),i('"><span class="privmx-icon privmx-icon-chat"></span>-</li>\n        <li class="has-attachments-icon" title="'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.task.hasAttachments"))),i('"><span class="privmx-icon privmx-icon-notes2"></span></li>\n        <li class="has-calendar-icon" title="'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.task.hasCalendar"))),i('"><span class="privmx-icon privmx-icon-calendar"></span></li>\n      </ul>\n    </div>\n  </td>\n  <td class="for-task task-status"></td>\n  <td class="for-task task-assigned-to"></td>\n  <td class="for-task task-attachments"></td>\n  <td class="for-task task-created av-date-wrapper"><div data-timeago-type="calendarDate"></div></td>\n  <td class="for-task task-modified av-date-wrapper"><div data-timeago-type="calendarDate"></div></td>\n  <td class="for-taskgroup taskgroup" colspan="8">'),i(e.render(t)),i('</td>\n  <td class="for-header"></td>\n  <td class="for-header" data-col="hash-id" data-sort-by="hash-id" data-keep-text="1">'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.header.hashId"))),i('</td>\n  <td class="for-header" data-col="task" data-sort-by="task" data-keep-text="1">'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.header.task"))),i('<span class="col-resizer"></span></td>\n  <td class="for-header" data-col="status" data-sort-by="status" data-keep-text="1">'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.header.status"))),i('<span class="col-resizer"></span></td>\n  <td class="for-header" data-col="assigned-to" data-sort-by="assigned-to" data-keep-text="1">'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.header.assignedTo"))),i('<span class="col-resizer"></span></td>\n  <td class="for-header" data-col="attachments" data-sort-by="attachments" data-keep-text="1">'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.header.attachments"))),i('<span class="col-resizer"></span></td>\n  <td class="for-header" data-col="created" data-sort-by="created" data-keep-text="1">'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.header.created"))),i('<span class="col-resizer"></span></td>\n  <td class="for-header" data-col="modified" data-sort-by="modified" data-keep-text="1">'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.header.modified"))),i('<span class="col-resizer"></span></td>\n  <td class="for-empty-tg-info empty-tg-info" colspan="8" data-keep-text="1"><span>'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.empty"))),i('</span></td>\n  <td class="for-hidden-tasks-info hidden-tasks-info" colspan="8" data-keep-text="1"><span class="info"></span><span class="link" data-action="show-hidden-tasks">'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.hiddenTasks.show"))),i("</span></td>\n  ");var a=["idea","todo","inprogress","done"];i("\n  ");for(var o=0,r=a;o<r.length;o++){var l=r[o];i('\n    <td class="for-kanban-header for-kanban-header-'),i(s.escapeHtml(l)),i('" data-keep-text="1">'),i(s.escapeHtml(s.i18n("plugin.tasks.status-"+l))),i("</td>\n  ")}i("\n  ");for(var c=0,d=a;c<d.length;c++){var p=d[c];i('\n  <td class="for-kanban-tasks for-kanban-'),i(s.escapeHtml(p)),i(' kanban-dropzone" data-kanban-dropzone-status="'),i(s.escapeHtml(p)),i('">\n    <div class="kanban-task-box-content">\n      <span class="clamped">\n        <span class="task-label has-task-tooltip"></span>\n        <span class="task-title"></span>\n        <span class="task-description"></span>\n      </span>\n      <span class="lower-panel">\n        <span class="modified-by"></span>\n        <span class="modified-dt"></span>\n        <span class="assigned-to"></span>\n      </span>\n    </div>\n  </td>\n  ')}return i("\n</tr>"),n}}},{}],8:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("../../../main/Types");s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var i="",a=function(t){i+=t},o="";t.isTrash&&(o+="trash"),t.isActive&&(o+="active");var r="";a('\n<div class="panel panel-taskgroups no-task-selected no-task-in-clipboard '),a(s.escapeHtml(o)),a('" tabindex="-1">\n  <div class="notifications-container-wrapper"></div>\n  <div class="dropzone-higlights-container"></div>\n  <div class="top">\n    <div class="left">\n      '),t.isInSummaryWindow?(a('\n      <div class="wi-element active">\n        <div class="wi-element-inner">\n          <div class="wi-element-icon bckg-icon tasks-icon-as-project-icon">\n            <i class="fa fa-tasks"></i>\n          </div>\n          <div class="wi-element-name">\n            '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.summaryWindow.title"))),a("\n          </div>\n        </div>\n      </div>\n      ")):t.isConv2Section?(a("\n        "),a(e.render(t.conv2Model,{})),a("\n      ")):t.isPrivateSection||t.isTasksAssignedToMe||t.isTasksCreatedByMe?(a('\n        <li class="conversation-element contact without-description" data-conversation-id="'),a(s.escapeHtml(t.myHashmail)),a('">\n          <span>\n            <div class="image-with-data">\n              <p class="image">\n                <canvas class="not-rendered" data-tooltip-trigger="'),a(s.escapeHtml(t.myHashmail)),a('" data-hashmail-image="'),a(s.escapeHtml(t.myHashmail)),a('" data-width="30" data-height="30" data-auto-size="true" data-auto-refresh="true" width="60" height="60" style="width: 30px; height: 30px;"></canvas>\n              </p>\n              <div class="text-col">\n                <p class="name">\n                  '),t.isPrivateSection&&(a("\n                    "),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.privateTasks"))),a("\n                  ")),t.isTasksAssignedToMe&&(a("\n                    "),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.tasksAssignedToMe"))),a("\n                  ")),t.isTasksCreatedByMe&&(a("\n                    "),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.tasksCreatedByMe"))),a("\n                  ")),a("\n                </p>\n              </div>\n            </div>\n          </span>\n        </li>\n      ")):(a('\n      <div class="wi-element active">\n        <div class="wi-element-inner">\n          <div class="wi-element-icon bckg-icon '),a(s.escapeHtml(t.isPublic||!t.isRegularSection||t.isPrivateSection?"":"bckg-icon-border")),a(" "),a(s.escapeHtml(t.isPrivateSection?"":"has-section-tooltip")),a('" data-section-id="'),a(s.escapeHtml(t.projectId)),a('">\n            <img src="'),a(s.escapeHtml(s.getAssetByName("DEFAULT_PRIVMX_ICON"))),a('" class="'),a(s.escapeHtml(t.isTrash||t.isAllTasks?"hidden":"")),a('" />\n            <i class="fa fa-tasks proj-fa-icon '),a(s.escapeHtml(t.isAllTasks?"":"hidden")),a('"></i>\n            <i class="fa ico-bin proj-fa-icon '),a(s.escapeHtml(t.isTrash?"":"hidden")),a('"></i>\n          </div>\n          <div class="wi-element-name">\n            '),a(s.escapeHtml(t.projectName)),a("\n          </div>\n        </div>\n      </div>\n      ")),a('\n      <div class="buttons-go-to">\n        <span class="btn btn-sm go-to-chat" data-action="open-chat" data-window-opener="true">\n          <i class="ico-comment"></i>\n        </span>\n        <span class="btn btn-sm go-to-notes" data-action="open-notes" data-window-opener="true">\n          <i class="ico-note"></i>\n        </span>\n        <span class="btn btn-sm go-to-calendar" data-action="open-calendar" data-window-opener="true">\n          <i class="fa fa-calendar"></i>\n        </span>\n      </div>\n      <div class="filter-container"></div>\n    </div>\n    <div class="button-container">\n      <button id="toggle-all-collapsed-'),a(s.escapeHtml(t.uniqueSafeId)),a('" class="btn btn-sm btn-default small collapse-all tasks-collapse-all-button" data-action="taskgroup-toggle-collapsed-all">\n        <span class="act-text-collapse">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.toggleCollapsedAllCollapse"))),a('</span>\n        <span class="act-text-expand">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.toggleCollapsedAllExpand"))),a('</span>\n      </button>\n      <span class="hide-done">\n        <input id="tasks-settings-hide-done-'),a(s.escapeHtml(t.uniqueSafeId)),a('" type="checkbox" data-setting="hide-done" />\n        <label for="tasks-settings-hide-done-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.hideDone"))),a(' <span class="done-tasks-count"></span></label>\n      </span>\n      <button id="tasks-settings-kanban-mode-'),a(s.escapeHtml(t.uniqueSafeId)),a('" class="btn btn-xs btn-default kanban-mode" data-setting="kanban-mode" title="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.kanbanMode"))),a('">\n        K\n      </button>\n      <button id="tasks-settings-show-recently-modified-'),a(s.escapeHtml(t.uniqueSafeId)),a('" class="btn btn-xs btn-default show-recently-modified" data-setting="show-recently-modified" title="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.viewModeMultipleLists"))),a('">\n        <span class="fa fa-th-list"></span>\n      </button>\n      <button class="btn btn-xs btn-default refresh" title="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.refresh"))),a('">\n        <span class="fa fa-refresh"></span>\n      </button>\n      <button class="btn btn-xs btn-default settings" title="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.moduleMenu"))),a('">\n        <span class="ico-settings"></span>\n      </button>\n      <button class="btn btn-success btn-sm btn-default small in-summary-as-icon" data-action="task-new" title="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.taskGroup.newTaskTooltip"))),a('" data-payload="__orphans__" data-taskgroup-project-id="'),a(s.escapeHtml(t.isConv2Section?"conv2":t.projectId?t.projectId:t.privateSectionId)),a('">\n        <i class="fa fa-plus"></i>\n        <span>'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.taskGroup.newTask"))),a('</span>\n      </button>\n\t</div>\n\t<div class="context-menu-settings context-menu">\n\t  <div class="context-menu-backdrop2"></div>\n\t  <ul class="context-menu-content">\n      <li data-action="mark-all-as-read" class="with-icon">\n        <span>\n          <i class="fa fa-check"></i><span>'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.moduleMenu.markAllAsRead"))),a('</span>\n        </span>\n      </li>\n      <li data-action="taskgroup-new" data-payload="'),a(s.escapeHtml(t.projectId)),a('" class="with-icon">\n        <span>\n          <i class="fa fa-plus"></i><span>'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.taskGroup.newTaskGroup"))),a('</span>\n        </span>\n      </li>\n      <li class="context-menu-group-header">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.moduleMenu.headers.viewSettings"))),a('</li>\n      <li>\n        <span class="hide-in-summary">\n          '),r=t.settings["show-task-panel"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-show-task-panel-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="show-task-panel" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-show-task-panel-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.showTaskPanel"))),a('</label>\n        </span>\n      </li>\n      <li class="subitem">\n        <span class="hide-in-summary">\n          '),r=t.settings["horizontal-task-window-layout"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-horizontal-task-window-layout-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="horizontal-task-window-layout" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-horizontal-task-window-layout-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.horizontalTaskWindowLayout"))),a("</label>\n        </span>\n      </li>\n      <li>\n        <span>\n          "),r=t.settings["show-orphans"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-show-orphans-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="show-orphans" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-show-orphans-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.showOrphans"))),a("</label>\n        </span>\n      </li>\n      <li>\n        <span>\n          "),r=t.settings["show-header-per-list"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-show-header-per-list-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="show-header-per-list" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-show-header-per-list-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.showHeaderPerList"))),a("</label>\n        </span>\n      </li>\n      <li>\n        <span>\n          "),r=t.settings["show-list-progress"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-show-list-progress-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="show-list-progress" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-show-list-progress-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.showListProgress"))),a("</label>\n        </span>\n      </li>\n      <li>\n        <span>\n          "),r=t.settings["texts-with-status-color"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-texts-with-status-color-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="texts-with-status-color" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-texts-with-status-color-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.textsWithStatusColor"))),a("</label>\n        </span>\n      </li>\n      <li>\n        <span>\n          "),r=t.settings["narrow-issue-rows"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-narrow-issue-rows-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="narrow-issue-rows" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-narrow-issue-rows-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.narrowIssueRows"))),a('</label>\n        </span>\n      </li>\n      <li class="context-menu-group-header">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.moduleMenu.headers.columns"))),a('</li>\n      <li class="setting-show-hash-id-column">\n        <span>\n          '),r=t.settings["show-hash-id-column"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-show-hash-id-column-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="show-hash-id-column" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-show-hash-id-column-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.showHashIdColumn"))),a('</label>\n        </span>\n      </li>\n      <li class="subitem">\n        <span>\n          '),r=t.settings["show-task-numbers"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-show-task-numbers-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="show-task-numbers" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-show-task-numbers-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.showTaskNumbers"))),a('</label>\n        </span>\n      </li>\n      <li class="setting-show-task-column">\n        <span>\n          '),r=t.settings["show-task-column"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-show-task-column-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="show-task-column" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-show-task-column-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.showTaskColumn"))),a('</label>\n        </span>\n      </li>\n      <li class="subitem">\n        <span>\n          '),r=t.settings["show-all-other-list-names"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-show-all-other-list-names-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="show-all-other-list-names" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-show-all-other-list-names-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.showAllOtherListNames"))),a('</label>\n        </span>\n      </li>\n      <li class="subitem">\n        <span>\n          '),r=t.settings["show-full-task-descriptions"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-show-full-task-descriptions-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="show-full-task-descriptions" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-show-full-task-descriptions-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.showFullTaskDescriptions"))),a('</label>\n        </span>\n      </li>\n      <li class="setting-show-status-column">\n        <span>\n          '),r=t.settings["show-status-column"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-show-status-column-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="show-status-column" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-show-status-column-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.showStatusColumn"))),a('</label>\n        </span>\n      </li>\n      <li class="setting-show-assigned-to-column">\n        <span>\n          '),r=t.settings["show-assigned-to-column"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-show-assigned-to-column-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="show-assigned-to-column" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-show-assigned-to-column-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.showAssignedToColumn"))),a('</label>\n        </span>\n      </li>\n      <li class="setting-show-attachments-column">\n        <span>\n          '),r=t.settings["show-attachments-column"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-show-attachments-column-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="show-attachments-column" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-show-attachments-column-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.showAttachmentsColumn"))),a('</label>\n        </span>\n      </li>\n      <li class="setting-show-created-column">\n        <span>\n          '),r=t.settings["show-created-column"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-show-created-column-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="show-created-column" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-show-created-column-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.showCreatedColumn"))),a('</label>\n        </span>\n      </li>\n      <li class="setting-show-modified-column">\n        <span>\n          '),r=t.settings["show-modified-column"]?" checked":"",a('\n          <input type="checkbox" id="tasks-settings-show-modified-column-'),a(s.escapeHtml(t.uniqueSafeId)),a('" data-setting="show-modified-column" '),a(s.escapeHtml(r)),a(' />\n          <label for="tasks-settings-show-modified-column-'),a(s.escapeHtml(t.uniqueSafeId)),a('">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.settings.showModifiedColumn"))),a("</label>\n        </span>\n      </li>\n\t  </ul>\n\t</div>\n  </div>\n  ");for(var l=function(t){a('\n  <table class="floating-single-header sort-all for-mode-'),a(s.escapeHtml(t)),a('">\n    <colgroup>\n      <col style="width:6px;min-width:6px;max-width:6px;" />\n      <col data-col="hash-id" style="width:'),a(s.escapeHtml(n.DefaultColWidths.HASH_ID)),a('px;" data-default-width="'),a(s.escapeHtml(n.DefaultColWidths.HASH_ID)),a('" />\n      <col data-col="task" style="min-width:50%;" />\n      <col data-col="status" style="width:'),a(s.escapeHtml(n.DefaultColWidths.STATUS)),a('px;" data-default-width="'),a(s.escapeHtml(n.DefaultColWidths.STATUS)),a('" />\n      <col data-col="assigned-to" style="width:'),a(s.escapeHtml(n.DefaultColWidths.ASSIGNED_TO)),a('px;" data-default-width="'),a(s.escapeHtml(n.DefaultColWidths.ASSIGNED_TO)),a('" />\n      <col data-col="attachments" style="width:'),a(s.escapeHtml(n.DefaultColWidths.ATTACHMENTS)),a('px;" data-default-width="'),a(s.escapeHtml(n.DefaultColWidths.ATTACHMENTS)),a('" />\n      <col data-col="created" style="width:'),a(s.escapeHtml(n.DefaultColWidths.CREATED)),a('px;" data-default-width="'),a(s.escapeHtml(n.DefaultColWidths.CREATED)),a('" />\n      <col data-col="modified" style="width:'),a(s.escapeHtml(n.DefaultColWidths.MODIFIED)),a('px;" data-default-width="'),a(s.escapeHtml(n.DefaultColWidths.MODIFIED)),a('" />\n    </colgroup>\n    <thead>\n      <tr>\n        ');var e=function(e){return e==("dflt"==t?"hash-id":"modified")?'class="sorted-desc"':""};a('\n        <th></th>\n        <th data-col="hash-id" data-sort-by="hash-id" '),a(e("hash-id")),a(">"),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.header.hashId"))),a('</th>\n        <th data-col="task" data-sort-by="task" '),a(e("task")),a(">"),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.header.task"))),a('<span class="col-resizer"></span></th>\n        <th data-col="status" data-sort-by="status" '),a(e("status")),a(">"),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.header.status"))),a('<span class="col-resizer"></span></th>\n        <th data-col="assigned-to" data-sort-by="assigned-to" '),a(e("assigned-to")),a(">"),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.header.assignedTo"))),a('<span class="col-resizer"></span></th>\n        <th data-col="attachments" data-sort-by="attachments" '),a(e("attachments")),a(">"),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.header.attachments"))),a('<span class="col-resizer"></span></th>\n        <th data-col="created" data-sort-by="created" '),a(e("created")),a(">"),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.header.created"))),a('<span class="col-resizer"></span></th>\n        <th data-col="modified" data-sort-by="modified" '),a(e("modified")),a(">"),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.table.header.modified"))),a('<span class="col-resizer"></span></th>\n        <th class="for-kanban-header for-kanban-header-idea">'),a(s.escapeHtml(s.i18n("plugin.tasks.status-idea"))),a('</th>\n        <th class="for-kanban-header for-kanban-header-todo">'),a(s.escapeHtml(s.i18n("plugin.tasks.status-todo"))),a('</th>\n        <th class="for-kanban-header for-kanban-header-inprogress">'),a(s.escapeHtml(s.i18n("plugin.tasks.status-inprogress"))),a('</th>\n        <th class="for-kanban-header for-kanban-header-done">'),a(s.escapeHtml(s.i18n("plugin.tasks.status-done"))),a("</th>\n      </tr>\n    </thead>\n  </table>\n  ")},c=0,d=["dflt","rm"];c<d.length;c++){l(d[c])}return a('\n  <div class="fl-container">\n    <table class="fl-padding-container">\n      <colgroup>\n        <col style="width:6px;min-width:6px;max-width:6px;" />\n        <col data-col="hash-id" style="width:'),a(s.escapeHtml(n.DefaultColWidths.HASH_ID)),a('px;" data-default-width="'),a(s.escapeHtml(n.DefaultColWidths.HASH_ID)),a('" />\n        <col data-col="task" style="min-width:50%;" />\n        <col data-col="status" style="width:'),a(s.escapeHtml(n.DefaultColWidths.STATUS)),a('px;" data-default-width="'),a(s.escapeHtml(n.DefaultColWidths.STATUS)),a('" />\n        <col data-col="assigned-to" style="width:'),a(s.escapeHtml(n.DefaultColWidths.ASSIGNED_TO)),a('px;" data-default-width="'),a(s.escapeHtml(n.DefaultColWidths.ASSIGNED_TO)),a('" />\n        <col data-col="attachments" style="width:'),a(s.escapeHtml(n.DefaultColWidths.ATTACHMENTS)),a('px;" data-default-width="'),a(s.escapeHtml(n.DefaultColWidths.ATTACHMENTS)),a('" />\n        <col data-col="created" style="width:'),a(s.escapeHtml(n.DefaultColWidths.CREATED)),a('px;" data-default-width="'),a(s.escapeHtml(n.DefaultColWidths.CREATED)),a('" />\n        <col data-col="modified" style="width:'),a(s.escapeHtml(n.DefaultColWidths.MODIFIED)),a('px;" data-default-width="'),a(s.escapeHtml(n.DefaultColWidths.MODIFIED)),a('" />\n      </colgroup>\n      <tbody class="fl-entries-container"></tbody>\n    </table>\n  </div>\n  <div class="lower-buttons">\n    <button class="btn btn-default btn-sm small gray requires-task-selected" title="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.lowerButtons.cutTaskTooltip"))),a('" data-action="task-cut-selected">\n      <i class="fa fa-cut"></i>\n      '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.lowerButtons.cutTask"))),a('\n    </button>\n    <button class="btn btn-default btn-sm small gray requires-task-selected" title="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.lowerButtons.copyTaskTooltip"))),a('" data-action="task-copy-selected">\n      <i class="fa fa-copy"></i>\n      '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.lowerButtons.copyTask"))),a('\n    </button>\n    <button class="btn btn-default btn-sm small gray requires-task-in-clipboard" title="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.lowerButtons.pasteTaskTooltip"))),a('" data-action="task-paste-selected">\n      <i class="fa fa-paste"></i>\n      '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.lowerButtons.pasteTask"))),a('\n    </button>\n    <button class="btn btn-default btn-sm small gray requires-task-selected requires-taskgroups" title="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.lowerButtons.moveTaskTooltip"))),a('" data-action="task-move-selected">\n      <i class="fa fa-paste"></i>\n      '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.lowerButtons.moveTask"))),a('\n    </button>\n    <button class="btn btn-default btn-sm small gray requires-task-selected if-not-trash" title="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.lowerButtons.moveToTrashTooltip"))),a('" data-action="task-delete-selected" style="margin-left:auto;">\n      <i class="ico-bin"></i>\n      '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.lowerButtons.moveToTrash"))),a('\n    </button>\n    <button class="btn btn-default btn-sm small gray requires-task-selected if-trash" title="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.lowerButtons.restoreFromTrashTooltip"))),a('" data-action="task-restore-selected" style="margin-left:auto;">\n      <i class="fa fa-reply"></i>\n      '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.lowerButtons.restoreFromTrash"))),a('\n    </button>\n    <button class="btn btn-default btn-sm small gray requires-task-selected if-trash" title="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.lowerButtons.deleteTaskTooltip"))),a('" data-action="task-delete-selected" style="margin-left:2px;">\n      <i class="ico-bin"></i>\n      '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.lowerButtons.deleteTask"))),a("\n    </button>\n  </div>\n</div>"),i}}},{"../../../main/Types":22}],9:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="",i=function(t){n+=t};for(var a in i('<div class="header taskgroup-header">\n  <div class="left">\n    <button class="btn btn-sm btn-micro no-text btn-transparent" title="'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.taskGroup.toggleCollapsedTooltip"))),i('" data-action="taskgroup-toggle-collapsed" data-payload="'),i(s.escapeHtml(t.id)),i('">\n      <i class="fa fa-caret-down"></i>\n    </button>\n    <div class="name">\n      <span class="taskgroup-label" title=""><span></span><span></span></span>\n    </div>\n    <button class="pin pin-taskgroup">\n      <i class="fa fa-thumb-tack"></i>\n    </button>\n    <div class="progress progress-all">\n      '),t.taskLabelClasses){var o=t.taskLabelClasses[a];i('\n      <div style="width:0%;" class="'),i(s.escapeHtml(o)),i('-progressbar">0</div>\n      ')}for(var a in i('\n    </div>\n    <div class="progress progress-not-done">\n      '),t.taskLabelClasses){o=t.taskLabelClasses[a];i('\n      <div style="width:0%;" class="'),i(s.escapeHtml(o)),i('-progressbar">0</div>\n      ')}return i('\n    </div>\n  </div>\n  <div class="right">\n    <button class="btn btn-default btn-sm btn-micro gray in-summary-as-icon" title="'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.taskGroup.pasteIntoTaskGroupTooltip"))),i('" data-action="taskgroup-paste" data-payload="" data-taskgroup-project-id="">\n      <i class="fa fa-paste"></i>\n      <span data-keep-text="1">'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.taskGroup.pasteIntoTaskGroup"))),i('</span>\n    </button>\n    <button class="btn btn-default btn-sm btn-micro gray in-summary-as-icon" title="'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.taskGroup.editTaskGroupTooltip"))),i('" data-action="taskgroup-edit" data-payload="" data-taskgroup-project-id="">\n      <i class="fa fa-pencil"></i>\n      <span data-keep-text="1">'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.taskGroup.editTaskGroup"))),i('</span>\n    </button>\n    <button class="btn btn-success btn-sm btn-micro in-summary-as-icon" title="'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.taskGroup.newTaskTooltip"))),i('" data-action="task-new" data-payload="" data-taskgroup-project-id="">\n      <i class="fa fa-plus"></i>\n      <span data-keep-text="1">'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskGroupsPanel.taskGroup.newTask"))),i('</span>\n    </button>\n    <div class="order-buttons">\n      <button data-action="tg-move-to-top"><i class="fa fa-angle-double-up"></i></button>\n      <button data-action="tg-move-up"><i class="fa fa-angle-up"></i></button>\n      <button data-action="tg-move-down"><i class="fa fa-angle-down"></i></button>\n      <button data-action="tg-move-to-bottom"><i class="fa fa-angle-double-down"></i></button>\n    </div>\n  </div>\n</div>'),n}}},{}],10:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="";return n+='<li class="badge-default"><span class="taskgroup-label small" title=""><span class="badges-count"></span><span></span><span></span></span></li>'}}},{}],11:[function(t,e,s){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)});Object.defineProperty(s,"__esModule",{value:!0});var a=t("pmc-web"),o=t("./template/main.html"),r=t("./template/task.html"),l=t("./template/customSelectTaskStatus.html"),c=t("../../window/taskGroupForm/template/icon.html"),d=t("./Types"),p=function(t){function e(e,s){var n=t.call(this,e)||this;n.personsComponent=s,n.obtainedTaskId=null,n.initializedDeferred=a.Q.defer(),n.usersRenderedHandler=function(){},n.scrolledToComments=!1,n.hasNewComment=!1,n.dirty=!1,n.dirtyPropsStr="[]",n.editStartTarget=null,n.pasteSeemsFileSource=null,n.clearCommentOnUpdate=!1;return n.personTooltip=new a.component.persontooltip.PersonTooltipView(n.templateManager,n.personsComponent),n.notifications=n.addComponent("notifications",new a.component.notification.NotificationView(n,{xs:!0})),n.taskTooltip=n.addComponent("tasktooltip",new a.component.tasktooltip.TaskTooltipView(n)),n.taskTooltip.refreshAvatars=function(){n.personsComponent&&n.personsComponent.refreshAvatars()},n.sectionTooltip=n.addComponent("sectiontooltip",new a.component.sectiontooltip.SectionTooltipView(n)),n.encryptionEffectTaskText=n.addComponent("encryptionEffectTaskText",new a.component.encryptioneffect.EncryptionEffectView(n)),n.encryptionEffectCommentText=n.addComponent("encryptionEffectCommentText",new a.component.encryptioneffect.EncryptionEffectView(n)),n.onUsersRendered((function(){return n.personsComponent&&n.personsComponent.refreshAvatars(),null})),a.Starter.dispatchEvent({type:"request-date-time-picker-view",parent:n,name:"dateTimePicker"}),a.Starter.dispatchEvent({type:"request-date-time-picker-view",parent:n,name:"dateTimePicker2"}),n}return i(e,t),e.prototype.init=function(t){var e,s=this;this.setModel(t);var n=this.templateManager.createTemplate(o.func);(this.$main=n.renderToJQ(this.internalModel),this.updateHistoryHeight(),this.helper=n.helper,this.$container.empty().append(this.$main),this.renderOverlayButtons(),this.$taskLabel=this.$main.find(".task-label"),this.$taskName=this.$main.find(".task-name"),this.$taskListsBadges=this.$main.find(".task-lists-badges"),this.$assignedToList=this.$main.find("ul.assigned-to"),this.$taskScrollable=this.$main.find(".scrollable-content"),this.$leftScrollable=this.$main.find(".scrollable-content-left"),this.$rightScrollable=this.$main.find(".scrollable-content-right"),this.$main.on("click","button.edit-save",(function(){return s.onSaveEditClick(!0)})),this.$main.on("click","button.edit-cancel",this.onCancelEditClick.bind(this)),this.$main.on("click","button.edit,[data-action='edit']",this.onEditClick.bind(this)),this.$main.on("click","button.delete,[data-action='delete']",this.onDeleteClick.bind(this)),this.$main.on("click",".toggle-marked-as-read,[data-action='toggle-marked-as-read']",this.onToggleMarkedAsReadClick.bind(this)),this.$main.on("click","button.restore-from-trash,[data-action='restore-from-trash']",this.onRestoreFromTrashClick.bind(this)),this.$main.on("click","[data-action=task-history-revert]",this.onRevertClick.bind(this)),this.$main.on("click","[data-action=task-history-more]",this.onMoreClick.bind(this)),this.$main.on("click",'[data-trigger="add-comment"]',this.onAddCommentClick.bind(this)),this.$main.on("click",".add-attachment,[data-action='add-attachment']",this.onAddAttachmentClick.bind(this)),this.$main.on("click",".add-calendar,[data-action='add-calendar']",this.onAddCalendarClick.bind(this)),this.$main.on("click","li.calendar-start",this.onCalendar1Click.bind(this)),this.$main.on("click","li.calendar-end",this.onCalendar2Click.bind(this)),this.$main.on("click",".remove-from-calendar",this.onRemoveFromCalendarClick.bind(this)),this.$main.on("click",".calendar-enable-hours",this.onCalendarWholeDaysClick.bind(this)),this.$main.on("click","span[data-did]",this.onOpenAttachmentClick.bind(this)),this.$main.on("click","i[data-did]",this.onDeleteAttachmentClick.bind(this)),this.$main.on("input","#task-description",this.onTaskDescriptionInput.bind(this)),this.$main.on("paste","#task-description",this.onTaskDescriptionInput.bind(this)),this.$main.on("input","#new-comment-text",this.onTaskCommentInput.bind(this)),this.$main.on("keydown",this.onKeyDown.bind(this)),this.$main.on("change","#enter-saves-task",this.onEnterSavesTaskChange.bind(this)),this.$main.on("change","#enter-adds-comment",this.onEnterAddsCommentChange.bind(this)),this.$main.on("click",".component-custom-select-main.disabled",this.onDisabledCustomSelectClick.bind(this)),this.$main.on("click",".make-editable[data-editable-target]",this.onMakeEditableClick.bind(this)),this.$main.on("dblclick","#task-description-ro",this.onMakeEditableClick.bind(this)),this.$container.on("click",".message-quote-toggle",this.onMessageQuoteToggleClick.bind(this)),this.$main.on("click",".message-text-from-user .task-label",this.onTaskLabelClick.bind(this)),a.JQuery(window).on("resize",(function(){s.updateHistoryHeight()})),this.customSelectProject=this.addComponent("customSelectProject",new a.component.customselect.CustomSelectView(this,{})).onChange(this.onProjectSelectChange.bind(this)),this.customSelectTaskGroup=this.addComponent("customSelectTaskGroup",new a.component.customselect.CustomSelectView(this,{})).onChange(this.onTaskGroupSelectChange.bind(this)),this.customSelectAssignedTo=this.addComponent("customSelectAssignedTo",new a.component.customselect.CustomSelectView(this,{})).onChange(this.onAssignedToSelectChange.bind(this)),this.customSelectType=this.addComponent("customSelectType",new a.component.customselect.CustomSelectView(this,{})).onChange(this.onTypeSelectChange.bind(this)),this.customSelectStatus=this.addComponent("customSelectStatus",new a.component.customselect.CustomSelectView(this,{customItemTemplates:(e={},e[d.CUSTOM_SELECT_CUSTOM_TEMPLATE_TASK_STATUS]=this.templateManager.createTemplate(l.func),e)})).onChange(this.onStatusSelectChange.bind(this)),this.customSelectPriority=this.addComponent("customSelectPriority",new a.component.customselect.CustomSelectView(this,{})).onChange(this.onPrioritySelectChange.bind(this)),this.customSelectProject.refreshAvatars=this.refreshAvatars.bind(this),this.customSelectTaskGroup.refreshAvatars=this.refreshAvatars.bind(this),this.customSelectAssignedTo.refreshAvatars=this.refreshAvatars.bind(this),this.customSelectType.refreshAvatars=this.refreshAvatars.bind(this),this.customSelectStatus.refreshAvatars=this.refreshAvatars.bind(this),this.customSelectPriority.refreshAvatars=this.refreshAvatars.bind(this),this.personTooltip.init(this.$main),this.setHorizontalLayout(t.horizontalLayout),this.internalModel.docked&&window.ResizeObserver)&&new window.ResizeObserver((function(t){if(!s.internalModel.editable){var e=t[0];if(e){var n=e.contentRect.height;s.updateDescriptionMaxHeight(n)}}})).observe(this.$container[0]);return this.notifications.$container=this.$main.find(".notifications-container-wrapper"),this.dateTimePicker.$container=this.$main.find(".date-time-picker-container"),this.dateTimePicker2.$container=this.$main.find(".date-time-picker2-container"),a.Q.all([this.customSelectProject.triggerInit(),this.customSelectTaskGroup.triggerInit(),this.customSelectAssignedTo.triggerInit(),this.customSelectType.triggerInit(),this.customSelectStatus.triggerInit(),this.customSelectPriority.triggerInit(),this.notifications.triggerInit(),this.dateTimePicker.triggerInit(),this.dateTimePicker2.triggerInit()]).then((function(){return s.internalModel.hasTask&&s.update(),s.usersRenderedHandler(),s.$main.find("#task-description").focus(),setTimeout((function(){s.$main.find("#task-description").focus()}),15),a.Q.resolve()})).then((function(){return s.taskTooltip.$container=s.$main,s.taskTooltip.triggerInit()})).then((function(){return s.sectionTooltip.refreshAvatars=s.refreshAvatars.bind(s),s.sectionTooltip.$container=s.$main,s.sectionTooltip.triggerInit()})).then((function(){return s.setEncryptionEffectElements(),a.Q.all([s.encryptionEffectTaskText.triggerInit(),s.encryptionEffectCommentText.triggerInit()])})).then((function(){s.initialData=s.getInitialData(),s.updateDirty()}))},e.prototype.renderOverlayButtons=function(){if(this.$main&&0!=this.$main.length){var t=this.internalModel,e=this.templateManager.getHelperByClass(a.webUtils.MailClientViewHelper),s=this.templateManager.createTemplate(a.component.template.buttons).renderToJQ({enabled:t.taskExists&&!t.editable,buttons:[{action:"edit",enabled:!0,icon:null,label:e.i18n("plugin.tasks.component.taskPanel.floatingButtons.edit")},{action:"add-attachment",enabled:!1,icon:null,label:e.i18n("plugin.tasks.component.taskPanel.floatingButtons.addAttachment")},{action:"delete",enabled:!t.newTask,icon:"ico-bin",label:e.i18n("plugin.tasks.component.taskPanel.floatingButtons.delete")},{action:"toggle-marked-as-read",enabled:!t.newTask&&!t.autoMarkAsRead,icon:null,label:t.isRead?e.i18n("plugin.tasks.component.taskPanel.markAsUnread"):e.i18n("plugin.tasks.component.taskPanel.markAsRead")}]}).addClass("buttons");this.$main.find(".buttons").replaceWith(s),a.webUtils.UI.fadingDiv(this.$main,s,!1)}},e.prototype.setEncryptionEffectElements=function(t){void 0===t&&(t=null),this.encryptionEffectTaskText.$field=this.$main.find("#task-description"),this.encryptionEffectTaskText.$button=this.$main.find("button.edit-save"),this.encryptionEffectCommentText.$field=this.$main.find("#new-comment-text"),this.encryptionEffectCommentText.$button=this.$main.find("button[data-trigger=add-comment]"),t?(this.encryptionEffectTaskText.$button.prop("disabled",!0),this.encryptionEffectCommentText.$button.prop("disabled",!0)):!1===t&&(this.encryptionEffectTaskText.$button.prop("disabled",!1),this.encryptionEffectCommentText.$button.prop("disabled",!1))},e.prototype.registerDateTimePickerView=function(t,e){"dateTimePicker"==t?this.dateTimePicker=this.addComponent("dateTimePicker",e):"dateTimePicker2"==t&&(this.dateTimePicker2=this.addComponent("dateTimePicker2",e))},e.prototype.updateDescriptionMaxHeight=function(t){if(this.internalModel.docked&&!this.internalModel.editable){var e=this.$main.find(".flex-row.description"),s=e.parent().children(":not(.flex-row.description)"),n=0;s.each((function(t,e){var s=a.JQuery(e);(!s.hasClass("grid-row")||s.text().trim().length>0)&&(n+=a.JQuery(e).outerHeight(!0))}));var i=Math.max(80,t-n);e.css("max-height",i+"px");var o=s.filter(".after-description");o.css("display",0==o.text().trim().length?"none":"grid")}},e.prototype.onKeyDown=function(t){var e=this;if("Tab"==t.key){t.preventDefault(),t.stopPropagation();var s=this.$main.find(":focus"),n=this.$main.find("button.edit-save, button.edit-cancel, .component-custom-select-main, #task-description").filter((function(t,e){var s=a.JQuery(e);return!s.hasClass("component-custom-select-main")||!s.parent().hasClass("custom-select-type")&&!s.parent().hasClass("custom-select-priority")})),i=[];n.each((function(t,e){i.push(e)}));var o=i.indexOf(s[0]);o>=0&&(o=(o+(t.shiftKey?-1:1)+i.length)%i.length,i[o].focus())}else"Enter"==t.key?(t.ctrlKey||t.metaKey)&&(t.stopPropagation(),this.internalModel.editable?this.onSaveEditClick():this.onAddCommentClick()):"s"==t.key?(t.ctrlKey||t.metaKey)&&(this.$main.find(".btn.btn-success.edit-save").is("[disabled]")||(t.stopPropagation(),this.internalModel.editable?this.onSaveEditClick(!1):this.onAddCommentClick())):!a.webUtils.WebUtils.hasCtrlModifier(t)||"x"!=t.key&&"v"!=t.key||setTimeout((function(){e.updateRequiredFields(!0),e.updateDirty()}),15)},e.prototype.setModel=function(t){this.internalModel={docked:t.docked,newTask:t.newTask,isEditTaskWindow:t.isEditTaskWindow,canRemoveFromCalendar:t.canRemoveFromCalendar,hasTask:t.hasTask,taskExists:t.taskExists,taskId:t.taskId,taskDone:t.taskDone,taskName:t.taskName,taskLabelClass:t.taskLabelClass,taskDescription:t.taskDescription,taskType:t.taskType,taskStatus:t.taskStatus,taskPriority:t.taskPriority,taskAttachments:JSON.parse(t.taskAttachmentsStr),taskAssignedTo:JSON.parse(t.taskAssignedToStr),taskAssignedToArray:JSON.parse(t.taskAssignedToArrayStr),taskHistory:JSON.parse(t.taskHistoryStr),taskGroupIds:JSON.parse(t.taskGroupIdsStr),taskGroupNames:JSON.parse(t.taskGroupNamesStr),taskGroupsPinned:JSON.parse(t.taskGroupsPinnedStr),taskGroupsIcons:JSON.parse(t.taskGroupsIconsStr),taskComments:JSON.parse(t.taskCommentsStr),taskIsTrashed:t.taskIsTrashed,taskStartTimestamp:t.taskStartTimestamp,taskEndTimestamp:t.taskEndTimestamp,taskWholeDays:t.taskWholeDays,projectId:t.projectId,projectName:t.projectName,projectPrefix:t.projectPrefix,projectPublic:t.projectPublic,editable:t.editable,scrollToComments:t.scrollToComments,myAvatar:t.myAvatar,enterSavesTask:t.enterSavesTask,enterAddsComment:t.enterAddsComment,horizontalLayout:t.horizontalLayout,resolvedTaskHistory:JSON.parse(t.resolvedTaskHistoryStr),taskStatuses:JSON.parse(t.taskStatusesStr),isRead:t.isRead,autoMarkAsRead:t.autoMarkAsRead,hostHash:t.hostHash},this.updateAddAttachmentButton(),this.renderOverlayButtons()},e.prototype.setObtainedTaskId=function(t){this.obtainedTaskId=t,this.update(null,!0)},e.prototype.setAttachments=function(t){this.internalModel.taskAttachments=t,this.update(null,!0),this.updateDirty()},e.prototype.updateDynamicHeader=function(){},e.prototype.onTaskDescriptionInput=function(){this.updateDynamicHeader(),this.updateDirty()},e.prototype.onTaskCommentInput=function(){this.updateDirty()},e.prototype.onUsersRendered=function(t){this.usersRenderedHandler=t},e.prototype.refreshAvatars=function(){this.personsComponent&&this.personsComponent.refreshAvatars()},e.prototype.onProjectSelectChange=function(t){this.triggerEvent("dataChanged","projectId",t),this.customSelectProject.$btn.find("canvas").addClass("not-rendered"),this.personsComponent&&this.personsComponent.refreshAvatars(),this.updateRequiredFields(!0),this.updateDirty(),this.updateRelatedSection(t),this.flashElement(this.customSelectTaskGroup.$main),this.flashElement(this.customSelectAssignedTo.$main)},e.prototype.onTaskGroupSelectChange=function(t){this.triggerEvent("dataChanged","taskGroupIds",JSON.stringify(t.split(","))),this.updateDirty()},e.prototype.onAssignedToSelectChange=function(t){this.triggerEvent("dataChanged","assignedTo",t),this.customSelectAssignedTo.$btn.find("canvas").addClass("not-rendered"),this.usersRenderedHandler(),this.updateDirty()},e.prototype.onTypeSelectChange=function(t){this.triggerEvent("dataChanged","type",t),this.updateDirty()},e.prototype.onStatusSelectChange=function(t){this.updateDynamicHeader(),this.triggerEvent("dataChanged","status",t),this.updateDirty()},e.prototype.onPrioritySelectChange=function(t){this.triggerEvent("dataChanged","priority",t),this.updateDirty()},e.prototype.setStartDateTime=function(t){this.internalModel.taskStartTimestamp=t,this.update(null,!0),this.updateDirty()},e.prototype.setEndDateTime=function(t){this.internalModel.taskEndTimestamp=t,this.update(null,!0),this.updateDirty()},e.prototype.setWholeDays=function(t){this.internalModel.taskWholeDays=t,this.update(null,!0),this.updateDirty()},e.prototype.update=function(t,e,s,n){var i=this;void 0===t&&(t=null),void 0===e&&(e=!1),void 0===s&&(s=null),void 0===n&&(n=!1);var o=this.commentEditor&&n?this.commentEditor.getValue():null;this.clearCommentOnUpdate&&(this.clearCommentOnUpdate=!1,o=null);var l=!1,d=!1;if(null!==t){var p=JSON.parse(t);p&&this.internalModel&&this.internalModel.hasTask&&this.internalModel.taskExists&&this.internalModel.taskId==p.taskId&&(l=JSON.parse(p.taskCommentsStr).length>this.internalModel.taskComments.length)&&(this.hasNewComment=!0),p&&this.internalModel&&(p.taskId!=this.internalModel.taskId||!this.internalModel.editable&&p.editable)&&(d=!0),this.setModel(p)}this.$main.toggleClass("no-task",!this.internalModel.taskExists),this.$main.toggleClass("trashed",this.internalModel.taskIsTrashed),this.internalModel.hasTask?(this.$main.addClass("has-task"),this.$main.removeClass("has-multiple-tasks")):(this.$main.removeClass("has-task"),!1===this.internalModel.taskId?this.$main.addClass("has-multiple-tasks"):this.$main.removeClass("has-multiple-tasks")),this.clearStatusClasses(this.$taskLabel),this.$taskLabel.addClass(this.internalModel.taskLabelClass+"-color"),"string"==typeof this.internalModel.taskId&&this.$taskLabel.text("#"+this.internalModel.taskId.substr(0,5)),this.internalModel.taskDone?this.$taskLabel.addClass("done"):this.$taskLabel.removeClass("done"),this.$taskName.text(this.internalModel.editable?this.internalModel.taskName:this.internalModel.taskStatus),this.clearStatusClasses(this.$taskName),this.internalModel.editable||this.$taskName.addClass(this.internalModel.taskLabelClass+"-color");var h="",u=this.templateManager.createTemplate(c.func);for(var m in this.internalModel.taskGroupNames){var f=this.internalModel.taskGroupNames[m],g=this.internalModel.taskGroupsPinned.indexOf(this.internalModel.taskGroupIds[m])>=0,k=this.internalModel.taskGroupsIcons[m],v=k?u.render(k):"";h+='<li><span class="taskgroup-label '+(g?"pinned":"")+'" data-taskgroup-id="'+this.internalModel.taskGroupIds[m]+'" title="'+f+'"><span>'+v+"</span><span>"+f+"</span></span></li>"}this.$taskListsBadges.html(h);var y=this.templateManager.createTemplate(r.func).renderToJQ(this.internalModel);if(e){var b=this.getEditorValue(this.commentEditor);this.$taskScrollable.find("div.history.comments").html(y.find("div.history.comments>.history-grid>.pf-content").html()),this.$taskScrollable.find(".flex-row.attachments").html(y.find(".flex-row.attachments").html()),this.$taskScrollable.find(".flex-row.calendar").html(y.find(".flex-row.calendar").html()),this.commentEditor=new a.webUtils.ContentEditableEditor(this.$main.find("#new-comment-text"),{disallowTab:!0,onRequestTaskPicker:function(){for(var t,e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];return i.parent.onTaskPickerResult(i.commentEditor.onTaskPickerResult.bind(i.commentEditor)),(t=i.parent).onRequestTaskPicker.apply(t,e)},onRequestFilePicker:function(){for(var t,e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];return i.parent.onFilePickerResult(i.commentEditor.onFilePickerResult.bind(i.commentEditor)),(t=i.parent).onRequestFilePicker.apply(t,e)},relatedHostHash:this.getCurrentHostHash(),relatedSectionId:this.getCurrentSectionId()}),null!=b&&this.commentEditor.setValue(b)}else{if(!this.$taskScrollable.is(".pf-content")){var T=this.$taskScrollable.children(".pf-content");T.length>0&&(this.$taskScrollable=T)}this.$taskScrollable.empty().append(y),this.$leftScrollable=this.$main.find(".scrollable-content-left"),this.$rightScrollable=this.$main.find(".scrollable-content-right"),this.setHorizontalLayout(this.internalModel.horizontalLayout),this.customSelectProject.setContainer(this.$main.find(".custom-select-project")),this.customSelectTaskGroup.setContainer(this.$main.find(".custom-select-taskgroup")),this.customSelectAssignedTo.setContainer(this.$main.find(".custom-select-assignedto")),this.customSelectType.setContainer(this.$main.find(".custom-select-type")),this.customSelectStatus.setContainer(this.$main.find(".custom-select-status")),this.customSelectPriority.setContainer(this.$main.find(".custom-select-priority")),this.descriptionEditor=new a.webUtils.ContentEditableEditor(this.$main.find("#task-description"),{disallowTab:!0,onInput:function(){i.updateRequiredFields(!0),i.updateDirty()},onChange:function(){i.updateRequiredFields(!0),i.updateDirty()},onRequestTaskPicker:function(){for(var t,e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];return i.parent.onTaskPickerResult(i.descriptionEditor.onTaskPickerResult.bind(i.descriptionEditor)),(t=i.parent).onRequestTaskPicker.apply(t,e)},onRequestFilePicker:function(){for(var t,e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];return i.parent.onFilePickerResult(i.descriptionEditor.onFilePickerResult.bind(i.descriptionEditor)),(t=i.parent).onRequestFilePicker.apply(t,e)},relatedHostHash:this.getCurrentHostHash(),relatedSectionId:this.getCurrentSectionId()}),this.commentEditor=new a.webUtils.ContentEditableEditor(this.$main.find("#new-comment-text"),{disallowTab:!0,onInput:function(){i.updateDirty()},onChange:function(){i.updateDirty()},onRequestTaskPicker:function(){for(var t,e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];return i.parent.onTaskPickerResult(i.commentEditor.onTaskPickerResult.bind(i.commentEditor)),(t=i.parent).onRequestTaskPicker.apply(t,e)},onRequestFilePicker:function(){for(var t,e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];return i.parent.onFilePickerResult(i.commentEditor.onFilePickerResult.bind(i.commentEditor)),(t=i.parent).onRequestFilePicker.apply(t,e)},relatedHostHash:this.getCurrentHostHash(),relatedSectionId:this.getCurrentSectionId()}),this.descriptionEditor.setValue(a.webUtils.ContentEditableEditor.safeHtml2(this.internalModel.taskDescription,!0)),!this.internalModel.editable&&o&&this.commentEditor.setValue(o)}this.internalModel.taskId!=this.taskId&&(this.taskId=this.internalModel.taskId,this.$taskScrollable.scrollTop(0));var w=this.internalModel.taskComments&&this.internalModel.taskComments.length>0,C=this.internalModel.taskAttachments&&this.internalModel.taskAttachments.length>0,S=!!this.internalModel.taskStartTimestamp,I=this.internalModel.taskAssignedToArray.length>0;this.$main.toggleClass("has-comments",w),this.$main.toggleClass("no-comments",!w),this.$main.toggleClass("has-attachments",C),this.$main.toggleClass("no-attachments",!C),this.$main.toggleClass("has-calendar",S),this.$main.toggleClass("no-calendar",!S),this.$main.toggleClass("has-assigned-to",I),this.$main.toggleClass("no-assigned-to",!I),h="";for(var D=0,E=this.internalModel.taskAssignedToArray;D<E.length;D++){var P=E[D];h+='<li class="person"><canvas class="not-rendered icon" data-auto-refresh="true" data-auto-size="true" data-hashmail-image="'+P.avatar+'" data-tooltip-trigger="'+P.id+'"></canvas><span>'+P.name+"</span></li>"}if(this.$assignedToList.html(h),this.$assignedToList.toggleClass("multi",this.internalModel.taskAssignedToArray.length>1),this.updateEditableState(d),this.usersRenderedHandler(),this.updateDynamicHeader(),(this.hasNewComment||l||(this.internalModel.scrollToComments||this.internalModel.horizontalLayout)&&(!this.scrolledToComments||this.internalModel.docked))&&(this.scrollToComments(),this.scrolledToComments=!0,l||(this.hasNewComment=!1)),this.updateAddAttachmentButton(),this.updateHistoryHeight(),this.updateDescriptionMaxHeight(this.$container.height()),this.personsComponent&&this.personsComponent.refreshAvatars(),d&&this.internalModel.editable&&(this.initialData=this.getInitialData()),this.editStartTarget){var x=this.editStartTarget;if(this.editStartTarget=null,"status"==x)this.openCustomSelect(this.customSelectStatus);else if("project"==x)this.openCustomSelect(this.customSelectProject);else if("taskGroups"==x)this.openCustomSelect(this.customSelectTaskGroup);else if("assignedTo"==x)this.openCustomSelect(this.customSelectAssignedTo);else if("attachments"==x);else if("startTimestamp"==x)this.dateTimePicker.show(this.$container.find(".calendar-start"),this.$main,this.internalModel.taskStartTimestamp,this.internalModel.taskWholeDays);else if("endTimestamp"==x)this.dateTimePicker2.show(this.$container.find(".calendar-end"),this.$main,this.internalModel.taskEndTimestamp,this.internalModel.taskWholeDays);else if("description"==x){var H=this.$container.find("#task-description");H.focus();var $=window.document.getSelection();$.removeAllRanges();var A=window.document.createRange();A.selectNodeContents(H[0]),A.collapse(!1),$.addRange(A)}}s&&(this.commentEditor.setValue(s),this.setEncryptionEffectElements(!1)),this.updateRelatedSection(this.internalModel.projectId)},e.prototype.openCustomSelect=function(t){t.toggleOpen(),this.personTooltip.$avatarPlaceholder&&this.personTooltip.$avatarPlaceholder.detach()},e.prototype.clearStatusClasses=function(t){if(t[0]&&t[0].classList){for(var e=t[0].classList,s=[],n=e.length-1;n>=0;--n){0==(o=e[n]).indexOf("task-status-")&&s.push(o)}for(var i=0,a=s;i<a.length;i++){var o=a[i];t.removeClass(o)}}},e.prototype.updateEditableState=function(t){void 0===t&&(t=!0),this.internalModel.editable?(this.$main.addClass("editable"),this.$main.removeClass("readonly"),this.$main.find("#task-description").prop("contenteditable",!0),!t&&this.initialData||(this.initialData=this.getInitialData())):(this.$main.removeClass("editable"),this.$main.addClass("readonly"),this.$main.find("#task-description").prop("contenteditable",!1))},e.prototype.onEditClick=function(){this.triggerEvent("editClick",this.getEditorValue(this.commentEditor))},e.prototype.onCancelEditClick=function(){this.triggerEvent("cancelEditClick")},e.prototype.onSaveEditClick=function(t){void 0===t&&(t=!0),this.updateRequiredFields();var e;e=this.getEditorValue(this.commentEditor),this.setEncryptionEffectElements(!0),this.clearCommentOnUpdate=!0,this.triggerEvent("saveEditClick",this.getEditorValue(this.descriptionEditor),e,t),this.dirty=!1},e.prototype.onDeleteClick=function(){this.triggerEvent("deleteClick")},e.prototype.onToggleMarkedAsReadClick=function(){this.triggerEvent("toggleMarkedAsRead")},e.prototype.onRestoreFromTrashClick=function(){this.triggerEvent("restoreFromTrash")},e.prototype.onRevertClick=function(t){var e=a.JQuery(t.currentTarget).parent();this.triggerEvent("revertClick",e.data("history-id"))},e.prototype.onMoreClick=function(t){a.JQuery(t.currentTarget).parent().find("div.more").toggleClass("hidden")},e.prototype.onAddCommentClick=function(){var t=this.getEditorValue(this.commentEditor);t&&0!=t.trim().length&&(this.setEncryptionEffectElements(!0),this.triggerEvent("addComment",t),this.clearCommentOnUpdate=!0,this.commentEditor.setValue(""))},e.prototype.onAddAttachmentClick=function(){this.triggerEvent("addAttachment")},e.prototype.onAddCalendarClick=function(t){var e=a.JQuery(t.currentTarget).data("mode")||"timeframe";this.internalModel.editable&&this.triggerEvent("addCalendar",e)},e.prototype.onCalendar1Click=function(t){this.internalModel.editable&&this.dateTimePicker.show(a.JQuery(t.currentTarget),this.$main,this.internalModel.taskStartTimestamp,this.internalModel.taskWholeDays)},e.prototype.onCalendar2Click=function(t){this.internalModel.editable&&this.dateTimePicker2.show(this.$container.find(".calendar-end"),this.$main,this.internalModel.taskEndTimestamp,this.internalModel.taskWholeDays)},e.prototype.onRemoveFromCalendarClick=function(t){t.stopImmediatePropagation(),this.triggerEvent("removeFromCalendar")},e.prototype.onCalendarWholeDaysClick=function(t){var e=!t.currentTarget.classList.contains("off");this.triggerEvent("toggleWholeDays",e),this.setWholeDays(e)},e.prototype.onOpenAttachmentClick=function(t){var e=a.JQuery(t.currentTarget).closest(".history.comments").length>0;t.currentTarget.classList.contains("trashed")||t.currentTarget.parentElement.classList.contains("trashed")||this.triggerEvent("openAttachment",a.JQuery(t.currentTarget).data("did"),!e)},e.prototype.onDeleteAttachmentClick=function(t){var e=a.JQuery(t.currentTarget).data("did");this.triggerEvent("delAttachment",e),this.internalModel.taskAttachments=this.internalModel.taskAttachments.filter((function(t){return JSON.parse(t).did!=e}))},e.prototype.removeAttachment=function(t){this.$container.find("i.fa-trash[data-did="+t+"]").parents("li").first().remove(),this.updateDirty()},e.prototype.scrollToComments=function(){var t,e=this,s=20,n=function(){s--<0&&clearInterval(t);var n=e.$container.find(".scrollable-content-right .history-grid").children(".pf-content"),i=e.internalModel.horizontalLayout?n.length>0?n:e.$container.find(".scrollable-content-right").children(".pf-content"):e.internalModel.docked?e.$main.children(".scrollable-content.pf-scrollable").children(".pf-content"):e.$taskScrollable.children(".pf-content");if(e.internalModel.horizontalLayout&&e.internalModel.docked){var a=e.$container.find(".scrollable-content-right").children(".pf-content");a.length>0&&a.scrollTop(a[0].scrollHeight)}i.length>0&&(i.scrollTop(i[0].scrollHeight),clearInterval(t))};t=setInterval(n,25),n()},e.prototype.updatePinnedBadges=function(t,e){this.$container.find(".taskgroup-label[data-taskgroup-id='"+t+"']").toggleClass("pinned",e)},e.prototype.updateAttIsTrashed=function(t){var e=JSON.parse(t);for(var s in e)this.$container.find(".history.comments .link[data-did='"+s+"']").toggleClass("trashed",e),this.$container.find(".flex-row.attachments .link[data-did='"+s+"']").parent().toggleClass("trashed",e)},e.prototype.onEnterSavesTaskChange=function(){this.setEnterSavesTask(this.$container.find("#enter-saves-task").prop("checked"))},e.prototype.onEnterAddsCommentChange=function(){this.setEnterAddsComment(this.$container.find("#enter-adds-comment").prop("checked"))},e.prototype.onDisabledCustomSelectClick=function(t){a.JQuery(t.currentTarget).parent().is(".custom-select-taskgroup")&&this.$main.find(".custom-select-project").addClass("invalid")},e.prototype.onMakeEditableClick=function(t){if(!this.internalModel.editable){var e=a.JQuery(t.currentTarget),s=e.is("#task-description-ro")?"description":e.data("editable-target");s&&(this.editStartTarget=s,this.triggerEvent("editClick",this.getEditorValue(this.commentEditor)))}},e.prototype.setEnterSavesTask=function(t){if(this.internalModel.enterSavesTask!=t){this.internalModel.enterSavesTask=t;var e=this.$container.find("#enter-saves-task");e.prop("checked")!=t&&e.prop("checked",t),this.triggerEvent("setEnterSavesTask",t)}},e.prototype.setEnterAddsComment=function(t){if(this.internalModel.enterAddsComment!=t){this.internalModel.enterAddsComment=t;var e=this.$container.find("#enter-adds-comment");e.prop("checked")!=t&&e.prop("checked",t),this.triggerEvent("setEnterAddsComment",t)}},e.prototype.updateRequiredFields=function(t){if(void 0===t&&(t=!1),this.descriptionEditor){var e=0==this.getEditorValueLength(this.descriptionEditor);t&&e||this.$main.find("#task-description").toggleClass("invalid",e)}if(this.customSelectProject){e=0==this.customSelectProject.$dropDown.find(".selected").length;t&&e||this.$main.find(".custom-select-project").toggleClass("invalid",e)}},e.prototype.getEditorValue=function(t){var e=t&&t.$elem?t.getValue():"";return e=e.replace(/^(<br\s*\/?>|\s)*/g,"").replace(/(<br\s*\/?>|\s)*$/g,"").trim()},e.prototype.getEditorValueLength=function(t){return this.getEditorValue(t).replace(/&nbsp;/g,"").replace(/\<br\>/g,"").trim().length},e.prototype.setHorizontalLayout=function(t){if(this.internalModel.horizontalLayout=t,this.$main.find(".layout-container").toggleClass("flex-row",t),this.$main.toggleClass("horizontal-layout",t),t)if(this.$container.find(".scrollable-content").pfScroll().turnOff(),this.$container.find(".scrollable-content-left").pfScroll().turnOn(),this.internalModel.isEditTaskWindow&&this.internalModel.editable&&!this.internalModel.docked)this.$container.find(".scrollable-content-right").pfScroll().turnOff(),this.$container.find(".scrollable-content-right").find(".history-grid").pfScroll().turnOn();else if(this.internalModel.docked){var e=this.$container.find(".scrollable-content-right").find(".history-grid");e.hasClass("pf-scroll")||e.data("pfScroll",null),this.$container.find(".scrollable-content-right").pfScroll().turnOn(),this.$container.find(".scrollable-content-right").find(".history-grid").pfScroll().turnOn()}else{this.$container.find(".scrollable-content-right").pfScroll().turnOn(),this.$container.find(".scrollable-content-right").find(".history-grid").pfScroll().turnOff();this.$container.find(".scrollable-content-right").find(".history-grid");this.breakOutInnerPfScroll()}else this.$container.find(".scrollable-content").pfScroll().turnOn(),this.$container.find(".scrollable-content-left").pfScroll().turnOff(),this.$container.find(".scrollable-content-right").pfScroll().turnOff(),this.$container.find(".scrollable-content-right").find(".history-grid").pfScroll().turnOff(),this.breakOutInnerPfScroll()},e.prototype.breakOutInnerPfScroll=function(){var t=this.$container.find(".scrollable-content-right").find(".history-grid");if(t.children(".pf-content").length>0){var e=t.children(".pf-content").children();t.empty(),t.append(e),t.removeClass("pf-scrollable")}},e.prototype.setIsEditTaskWindow=function(t){this.internalModel.isEditTaskWindow=t,this.$container.toggleClass("edit-task-window",t)},e.prototype.updateAddAttachmentButton=function(){this.customSelectProject&&this.$container.find("button.add-attachment").prop("disabled",0==this.customSelectProject.items.filter((function(t){return"item"==t.type&&t.selected})).length)},e.prototype.visualAddAttachment=function(t){this.internalModel.taskAttachments.push(JSON.parse(t)),this.update(null,!0),this.updateDirty()},e.prototype.onMessageQuoteToggleClick=function(t){var e=a.JQuery(t.target).closest(".message-quote-toggle"),s=e.next().is(":visible");e.find("span").html(this.helper.i18n("plugin.tasks.component.taskPanel.quote."+(s?"show":"hide"))),e.find("i").attr("class",s?"fa fa-caret-right":"fa fa-caret-down"),e.next().toggle()},e.prototype.onTaskLabelClick=function(t){var e=a.JQuery(t.currentTarget).data("task-id")+"";e&&this.triggerEvent("openTask",e)},e.prototype.getInitialData=function(){return this.customSelectStatus.$container&&null!=this.customSelectStatus.$container.find(".item.selected").toArray().map((function(t){return a.JQuery(t).data("val")}))[0]?{status:this.customSelectStatus.$container.find(".item.selected").toArray().map((function(t){return a.JQuery(t).data("val")}))[0],project:this.customSelectProject.$container.find(".item.selected").toArray().map((function(t){return a.JQuery(t).data("val")}))[0],taskGroups:JSON.stringify(this.customSelectTaskGroup.$container.find(".item.selected").toArray().map((function(t){return a.JQuery(t).data("val")})).sort()),assignedTo:JSON.stringify(this.customSelectAssignedTo.$container.find(".item.selected").toArray().map((function(t){return a.JQuery(t).data("val")})).sort()),description:this.getEditorValue(this.descriptionEditor),comment:this.getEditorValue(this.commentEditor),attachments:JSON.stringify(this.$container.find("div.attachments li.attachment>span.link").toArray().map((function(t){return a.JQuery(t).data("did")})).sort()),startDateStr:this.$container.find(".calendar-start").text().trim(),endDateStr:this.$container.find(".calendar-end").text().trim()}:null},e.prototype.setDirty=function(t){this.dirty=t,this.initialData=null},e.prototype.updateDirty=function(){if(!this.initialData)return this.initialData=this.getInitialData(),void this.$container.find("button.edit-save").prop("disabled",!this.dirty);var t=this.dirty;this.dirtyPropsStr;this.dirty=!1;var e=this.getInitialData(),s=[];for(var n in e)e[n]!=this.initialData[n]&&(this.dirty=!0,s.push(n));this.$container.find("button.edit-save").prop("disabled",!this.dirty),this.dirty!=t?this.triggerEvent("dirtyChanged",this.dirty,JSON.stringify(s)):this.dirtyPropsStr!=JSON.stringify(s)&&this.triggerEvent("dirtyPropsChanged",this.dirty,JSON.stringify(s))},e.prototype.updateHistoryHeight=function(){if(!this.internalModel.docked){var t=this.$main.find(".history.history-grid"),e=this.$main.find(".comment-form").outerHeight(!0),s=t.children();if(0!=s.length){s.css("max-height",1);var n=s[0].scrollHeight;s.css("max-height","");var i=t.parent().height(),a=Math.max(e,i-5-n);t.css("height","calc(100% - "+a+"px)")}}},e.prototype.setOutOfSync=function(t,e){var s=JSON.parse(e);this.$main.toggleClass("trashed",s.isTrashed),this.$main.toggleClass("out-of-sync",t)},e.prototype.restoreTexts=function(t,e){this.setEncryptionEffectElements(!1),this.encryptionEffectTaskText.$field.text(t),this.encryptionEffectCommentText.$field.text(e),this.encryptionEffectTaskText.$button.prop("disabled",!(t&&t.trim().length>0)),this.encryptionEffectCommentText.$button.prop("disabled",!(e&&e.trim().length>0))},e.prototype.updateTaskGroupBadge=function(t,e,s,n){var i=this;this.$main.find(".taskgroup-label[data-taskgroup-id="+t+"]").each((function(t,o){var r=i.templateManager.createTemplate(c.func),l=s?r.render(s):"",d=a.JQuery(o);d.toggleClass("pinned",n),d.children().eq(0).html(l),d.children().eq(1).text(e),d.attr("title",e)}))},e.prototype.updateTaskBadge=function(t,e){this.$main.find(".task-label[data-task-id="+t+"]").each((function(t,s){for(var n=a.JQuery(s),i=[],o=0;o<s.classList.length;++o)0==s.classList[o].indexOf("task-status-")&&i.push(s.classList[o]);for(var r=0,l=i;r<l.length;r++){var c=l[r];n.hasClass(c)&&n.removeClass(c)}n.addClass(e)}))},e.prototype.onPasteSeemsEmpty=function(){this.pasteSeemsFileSource=null,this.triggerEvent("paste",null)},e.prototype.onPasteSeemsFile=function(t,e){this.triggerEvent("paste",e)},e.prototype.pastePlainText=function(t){var e="comment"==this.pasteSeemsFileSource?this.commentEditor:"description"==this.pasteSeemsFileSource?this.descriptionEditor:null;this.pasteSeemsFileSource=null,e&&e.pastePlainText(t)},e.prototype.updateAttachmentNames=function(t){var e=JSON.parse(t);this.$main.find("li.attachment span.link[data-did]").each((function(t,s){var n=a.JQuery(s),i=n.data("did");e[i]&&n.text(e[i])}))},e.prototype.setAutoMarkAsRead=function(t){this.internalModel&&(this.internalModel.autoMarkAsRead=t,this.updateAutoMarkAsRead(),this.renderOverlayButtons())},e.prototype.updateAutoMarkAsRead=function(){this.$main&&this.internalModel&&this.$main.toggleClass("auto-mark-as-read",this.internalModel.autoMarkAsRead)},e.prototype.setIsRead=function(t){if(this.internalModel&&this.internalModel.isRead!=t){var e=this.templateManager.getHelperByClass(a.webUtils.MailClientViewHelper),s=this.internalModel;s.isRead=t,this.$main.find(".link.toggle-marked-as-read").find(".text-content").text(s.isRead?e.i18n("plugin.tasks.component.taskPanel.markAsUnread"):e.i18n("plugin.tasks.component.taskPanel.markAsRead")),this.renderOverlayButtons()}},e.prototype.getCurrentSectionId=function(){var t=this.customSelectProject.items.filter((function(t){return"item"==t.type&&t.selected}))[0];return t?t.value:null},e.prototype.getCurrentHostHash=function(){return this.internalModel?this.internalModel.hostHash:null},e.prototype.updateRelatedSection=function(t){this.commentEditor&&(this.commentEditor.options.relatedSectionId=this.getCurrentHostHash(),this.commentEditor.options.relatedSectionId=t),this.descriptionEditor&&(this.descriptionEditor.options.relatedSectionId=this.getCurrentHostHash(),this.descriptionEditor.options.relatedSectionId=t)},e.prototype.flashElement=function(t){t&&t.fadeOut(150).fadeIn(300)},e.prototype.setHostHash=function(t){this.internalModel&&(this.internalModel.hostHash=t)},e}(a.component.base.ComponentView);s.TaskPanelView=p,p.prototype.className="com.privmx.plugin.tasks.component.taskPanel.TaskPanelView"},{"../../window/taskGroupForm/template/icon.html":37,"./Types":12,"./template/customSelectTaskStatus.html":13,"./template/main.html":14,"./template/task.html":15,"pmc-web":1}],12:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.CREATE_NEW_TASKGROUP_ACTION="createNewTaskGroup",s.CUSTOM_SELECT_CUSTOM_TEMPLATE_TASK_STATUS="taskLabelTemplate"},{}],13:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="",i=function(t){n+=t};return i('<span class="custom-select-task-status-item">\n  <span class="task-label '),i(s.escapeHtml(t.extraArg.labelClass)),i('">#'),i(s.escapeHtml(t.extraArg.taskId)),i('</span><span class="'),i(s.escapeHtml(t.extraArg.labelClass)),i('-color" style="font-weight:600;margin-left:5px;">'),i(s.escapeHtml(t.text)),i("</span>\n</span>"),n}}},{}],14:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="",i=function(t){n+=t},a=t.hasTask?"has-task":"";return a+=t.docked?" docked":" standalone",a+=t.editable?" editable":" readonly",a+=t.newTask?" new-task":"",a+=t.taskExists?"":" no-task",a+=t.isEditTaskWindow?" edit-task-window":"",a+=t.taskIsTrashed?" trashed":"",a+=t.autoMarkAsRead?" auto-mark-as-read":"",i('\n<div class="component-task-panel-main '),i(s.escapeHtml(a)),i('">\n  <div class="notifications-container-wrapper"></div>\n  <div class="date-time-picker-container"></div>\n  <div class="date-time-picker2-container"></div>\n  <div class="buttons"></div>\n  '),t.docked&&(i('\n  <div class="no-task-info">'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.noTaskSelected"))),i('</div>\n  <div class="multiple-tasks-info">'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.multipleTasksSelected"))),i("</div>\n  ")),i('\n  <div class="no-task-msg">'),i(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.taskDoesntExist"))),i('</div>\n  <div class="scrollable-content"></div>\n</div>\n'),n}}},{}],15:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("../../../window/taskGroupForm/template/icon.html");s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var i="",a=function(t){i+=t},o=s.createTemplate(n.func);if(a('\n<div class="layout-container '),a(s.escapeHtml(t.horizontalLayout?"flex-row":"")),a('">\n  '),t.taskExists){if(a('\n  <div class="scrollable-content-left">\n    '),t.editable)a('\n      <div class="flex-row">\n        <div class="flex-3">\n          <div class="custom-select-status"></div>\n          <div class="custom-select-type"></div>\n          <div class="custom-select-priority"></div>\n        </div>\n        <div class="flex-2">\n          <div class="custom-select-project"></div>\n        </div>\n      </div>\n      <div class="flex-row description">\n        <div class="textarea-wrapper">\n          <div class="textarea-like if-editable" id="task-description" placeholder="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.task.description.placeholder"))),a('"></div>\n        </div>\n      </div>\n      <div class="flex-row">\n        <div class="custom-select-taskgroup flex-3"></div>\n        <div class="custom-select-assignedto flex-2"></div>\n      </div>\n    ');else{a('\n      <div class="grid-row">\n        <div class="task-status-info '),a(s.escapeHtml(t.taskLabelClass)),a('-color">\n          <div class="make-editable" data-editable-target="status">\n            <span class="task-label '),a(s.escapeHtml(t.taskLabelClass)),a('">#'),a(s.escapeHtml((t.taskId?t.taskId:"").substr(0,5))),a('</span>\n            <span class="status-text">'),a(s.escapeHtml(t.taskStatus)),a("</span>\n          </div>\n        </div>\n        <div>\n          "),"private:"==t.projectId.substr(0,8)?(a('\n            <span class="person inline lg make-editable" data-editable-target="project"><canvas class="not-rendered icon" data-auto-refresh="true" data-auto-size="true" data-hashmail-image="'),a(s.escapeHtml(t.myAvatar)),a('" data-tooltip-trigger="'),a(s.escapeHtml(t.myAvatar)),a('"></canvas><span>'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.privateTasks"))),a("</span></span>\n          ")):(a('\n            <div class="section-element wi-element make-editable" data-editable-target="project">\n              <div class="wi-element-inner">\n                <div class="wi-element-icon bckg-icon '),a(s.escapeHtml(t.projectPublic?"":"bckg-icon-border")),a(' has-section-tooltip" data-section-id="'),a(s.escapeHtml(t.projectId)),a('"><img src="'),a(s.escapeHtml(s.getAssetByName("DEFAULT_PRIVMX_ICON"))),a('"></div>\n                <div class="wi-element-name">\n                  '),t.projectPrefix?(a('\n                    <span class="project-full-name">\n                      <span class="project-prefix">'),a(s.escapeHtml(t.projectPrefix)),a('</span>\n                      <span class="project-name">'),a(s.escapeHtml(t.projectName)),a("</span>\n                    </span>\n                  ")):(a("\n                    "),a(s.escapeHtml(t.projectName)),a("\n                  ")),a("\n                </div>\n              </div>\n            </div>\n          ")),a('\n        </div>\n      </div>\n      <div class="flex-row description">\n        ');var r=(R=s.formatRichMessage(t.taskDescription,"html",t.taskStatuses)).split("<br>"),l=r[0].indexOf(">")+1,c=r[0].substr(0,l),d=r[0].substr(l);for(var p in r[0]=c+'<span class="task-description-first-line">'+d+"</span>",R=r.join("<br>"),a('\n        <div class="textarea-like" id="task-description-ro">'),a(R),a('</div>\n      </div>\n      <div class="grid-row '),a(s.escapeHtml(t.taskAssignedToArray.length>1?"preserve-right":"")),a(' after-description">\n        <div>\n          <ul class="task-lists-badges make-editable" data-editable-target="taskGroups">\n            '),t.taskGroupNames){var h=t.taskGroupNames[p],u=t.taskGroupsPinned.indexOf(t.taskGroupIds[p])>=0,m=t.taskGroupIds[p],f=t.taskGroupsIcons[p],g=f?o.render(f):"";a('\n              <li><span class="taskgroup-label '),a(s.escapeHtml(u?"pinned":"")),a('" data-taskgroup-id="'),a(s.escapeHtml(m)),a('" title="'),a(s.escapeHtml(h)),a('"><span>'),a(g),a("</span><span>"),a(s.escapeHtml(h)),a("</span></span></li>\n            ")}a('\n          </ul>\n        </div>\n        <div>\n          <ul class="assigned-to make-editable '),a(s.escapeHtml(t.taskAssignedToArray.length>1?"multi":"")),a('" data-editable-target="assignedTo">\n            ');for(var k=0,v=t.taskAssignedToArray;k<v.length;k++){var y=v[k];a('\n              <li class="person"><canvas class="not-rendered icon" data-auto-refresh="true" data-auto-size="true" data-hashmail-image="'),a(s.escapeHtml(y.avatar)),a('" data-tooltip-trigger="'),a(s.escapeHtml(y.id)),a('"></canvas><span>'),a(s.escapeHtml(y.name)),a("</span></li>\n            ")}a("\n          </ul>\n        </div>\n      </div>\n    ")}a('\n    <div class="flex-row attachments">\n      <div class="attachments">\n        <ul>\n          <li>\n            <h4 class="attachments-header make-editable" style="margin-top:5px;" data-editable-target="attachments">\n              '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.task.attachments.header"))),a("\n            </h4>\n          </li>\n          ");for(var b=0,T=t.taskAttachments;b<T.length;b++){var w=T[b];a("\n            ");var C=JSON.parse(w);a('\n            <li class="attachment'),a(s.escapeHtml(C.trashed?" trashed":"")),a('">\n              <span class="link" data-did="'),a(s.escapeHtml(C.did)),a('">'),a(s.escapeHtml(C.name)),a('</span>\n              <i class="fa fa-trash del-attachment" data-did="'),a(s.escapeHtml(C.did)),a('"></i>\n            </li>\n          ')}a('\n          <li>\n            <button class="btn btn-default btn-sm small btn-success add-attachment">\n              <i class="fa fa-plus"></i>\n              '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.task.attachments.add"))),a('\n            </button>\n          </li>\n        </ul>\n      </div>\n    </div>\n    <div class="flex-row calendar">\n      <div class="calendar">\n        <ul>\n          <li>\n            <h4 class="calendar-header" style="margin-top:5px;">\n              '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.task.calendar.header"))),a('\n            </h4>\n          </li>\n          <li class="calendar-enable-hours '),a(s.escapeHtml(t.taskWholeDays?"off":"on")),a('">\n            <input type="checkbox" id="checkbox-whole-day" '),a(s.escapeHtml(t.taskWholeDays?"checked":"")),a(' />\n            <label for="checkbox-whole-day">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.task.wholeDay"))),a('</label>\n          </li>\n          <li class="calendar-start make-editable" data-editable-target="startTimestamp">\n            <i class="privmx-icon privmx-icon-calendar"></i>\n            ');var S=t.taskStartTimestamp?t.taskStartTimestamp:0,I=s.dateWithHourLocal(S,!1),D="";if(t.taskWholeDays?(I=I.substr(0,I.length-6),D=s.i18n("plugin.tasks.component.taskPanel.task.wholeDay")):D=s.calendarDate(S),a('\n            <span title="'),a(s.escapeHtml(D)),a('">'),a(s.escapeHtml(I)),a('</span>\n          </li>\n          <li class="calendar-end make-editable" data-editable-target="endTimestamp">\n            <i class="privmx-icon privmx-icon-calendar"></i>\n            '),S=t.taskEndTimestamp?t.taskEndTimestamp:0,I=s.dateWithHourLocal(S,!1),t.taskWholeDays&&(I=I.substr(0,I.length-6),D=s.i18n("plugin.tasks.component.taskPanel.task.wholeDay")),a('\n            <span title="'),a(s.escapeHtml(s.calendarDate(S))),a('">'),a(s.escapeHtml(I)),a("</span>\n          </li>\n          "),t.canRemoveFromCalendar&&(a('\n          <li class="rm-from-calendar">\n            <span class="remove-from-calendar link">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.task.calendar.removeFromCalendar"))),a("</span>\n          </li>\n          ")),a('\n          <li class="add-calendar-container">\n            <button class="btn btn-default btn-sm small btn-success add-calendar" data-mode="timeframe">\n              <i class="fa fa-plus"></i>\n              '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.task.calendar.add.timeframe"))),a('\n            </button>\n            <button class="btn btn-default btn-sm small btn-success add-calendar" data-mode="wholeDay">\n              <i class="fa fa-plus"></i>\n              '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.task.calendar.add.wholeDay"))),a('\n            </button>\n          </li>\n        </ul>\n      </div>\n    </div>\n    <div class="flex-row with-ok-cancel-buttons">\n      <div class="ok-cancel-buttons">\n        <div class="ok">\n          <button class="btn btn-success edit-save" disabled>'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.save"))),a('</button>\n          <span class="enter-saves">\n            <input id="enter-saves-task" class="enter-saves-task" type="checkbox"  '),a(s.escapeHtml(t.enterSavesTask?"checked":"")),a(' />\n            <label for="enter-saves-task">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.enterSavesTask"))),a('</label>\n          </span>\n        </div>\n        <div class="cancel">\n          <button class="btn btn-default gray edit-cancel">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.cancel"))),a("</button>\n        </div>\n        "),t.newTask||(a('\n          <button class="btn btn-warning btn-sm small delete">\n            <span>\n              '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.delete"))),a('\n            </span>\n          </button>\n          <button class="btn btn-warning btn-sm small restore-from-trash">\n            <span>\n              <span class="fa fa-reply"></span>\n              '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.restoreFromTrash"))),a('\n            </span>\n          </button>\n          <button class="btn btn-warning btn-sm small delete move-to-trash">\n            <span>\n              <span class="fa fa-trash"></span>\n              '),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.moveToTrash"))),a('\n            </span>\n          </button>\n          <span class="link toggle-marked-as-read">\n            <span>\n              <span class="fa fa-check"></span>\n              <span class="text-content">'),a(s.escapeHtml(t.isRead?s.i18n("plugin.tasks.component.taskPanel.markAsUnread"):s.i18n("plugin.tasks.component.taskPanel.markAsRead"))),a("</span>\n            </span>\n          </span>\n        ")),a('\n      </div>\n    </div>\n  </div>\n  <div class="scrollable-content-right">\n    <h4 style="margin-top:15px;margin-bottom:5px;" class="if-task-exists">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.task.history.header"))),a('</h4>\n    <div class="flex-row if-task-exists">\n      <div class="history comments">\n          '),t.taskHistory.length>0){a('\n          <div class="history history-grid">\n            ');for(var E=[],P=0,x=0,H=t.resolvedTaskHistory;x<H.length;x++){var $=H[x];E.push({datetime:$.when,type:"history",payload:$,entryId:P}),++P}for(var A=0,M=t.taskComments;A<M.length;A++){$=M[A];E.push({datetime:$.dateTime,type:"comment",payload:$})}E.sort((function(t,e){return t.datetime-e.datetime}));for(var _=null,G=0;G<E.length;++G){$=E[G];if(a("\n                "),"history"==$.type){a("\n                  ");var L=$.entryId,O=$.payload;if(_=null,"modified"==O.what&&"name"==O.arg)continue;a('\n                  <div data-history-id="'),a(s.escapeHtml(L)),a('" class="history-entry">\n                    '),"created"!=O.what&&"projectId"!=O.arg&&(a('\n                    <button class="btn btn-default btn-sm btn-micro no-text revert gray" title="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.task.history.revert"))),a('" data-action="task-history-revert">\n                      <i class="fa fa-undo"></i>\n                    </button>\n                    ')),a("\n                    "),"modified"==O.what&&"description"==O.arg&&(a('\n                    <button class="btn btn-default btn-sm btn-micro no-text more gray" title="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.task.history.more"))),a('" data-action="task-history-more">\n                      <i class="fa fa-ellipsis-h"></i>\n                    </button>\n                    ')),a("\n                    ");var N=O.isAttachmentTrashed?" trashed":"",R=s.escapeHtml(O.message).replace(/{!{BEGIN_TG_LABEL}!}(.*?)\|\|\|(.*?)\|\|\|(.*?)\|\|\|(.*?){!{END_TG_LABEL}!}/g,(function(t,e,s,n,i){return'<span class="taskgroup-label small'+("1"==n?" pinned":"")+'" data-taskgroup-id="'+e+'" title="'+s+'"><span>'+(i?o.render(i.replace(/&quot;/g,'"')):"")+"</span><span>"+s+"</span></span>"})).replace(/{!{BEGIN_STATUS}!}(.*?)\|\|\|(.*?){!{END_STATUS}!}/g,'<span style="font-weight:bold;" class="$2-color" title="$1">$1</span>').replace(/{!{BEGIN_SECTION}!}(.*?)\|\|\|(.*?)\|\|\|(.*?){!{END_SECTION}!}/g,'<span class="section $2"><span class="section-img-wrapper has-section-tooltip" data-section-id="$3"><img src="'+s.getAssetByName("DEFAULT_PRIVMX_ICON")+'" /></span><span style="font-weight:bold;" title="$1">$1</span></span>').replace(/{!{BEGIN_ATTACHMENT}!}(.*?)\|\|\|(.*?){!{END_ATTACHMENT}!}/g,'<span class="link'+N+'" data-did="$1">$2</span>').replace(/{!{BEGIN_PERSON}!}(.*?)\|\|\|(.*?)\|\|\|(.*?){!{END_PERSON}!}/g,'<span class="person inline"><span class="av-cnv"><canvas class="not-rendered icon" data-auto-refresh="true" data-auto-size="true" data-hashmail-image="$1" data-tooltip-trigger="$3"></canvas></span><span class="av-txt">$2</span></span>').replace(/{!{BEGIN_STARTTS}!}(.*?){!{END_STARTTS}!}/g,(function(t,e){return s.escapeHtml(s.dateWithHourLocal(e,!1))})).replace(/{!{BEGIN_DURATION}!}(.*?){!{END_DURATION}!}/g,(function(t,e){return s.escapeHtml(s.lastTime(e))}));a('\n                    <span class="message">'),a(R),a("</span>\n                    "),"modified"==O.what&&"description"==O.arg&&(a('\n                    <div class="more hidden">\n                      <span class="more-title">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.task.history.oldDescription"))),a(':</span>\n                      <span class="more-content">'),a(s.formatRichMessage(O.oldString,"html")),a('</span>\n                      <span class="more-title">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.task.history.newDescription"))),a(':</span>\n                      <span class="more-content">'),a(s.formatRichMessage(O.newString,"html")),a("</span>\n                    </div>\n                    ")),a('\n                  </div>\n                  <div data-history-id="'),a(s.escapeHtml(L)),a('">\n                    <span class="when" title="'),a(s.escapeHtml(s.dateWithHourLocal(O.when))),a('" data-timeago-type="calendarDate" data-timeago="'),a(s.escapeHtml(O.when)),a('">\n                      '),a(s.escapeHtml(s.calendarDate(O.when))),a("\n                    </span>\n                  </div>\n                ")}else{a("\n                  ");var F=$.payload,j=_==$.payload.userAvatar,V=!1,W=E[G+1];W&&"comment"==W.type&&W.payload.userAvatar==$.payload.userAvatar&&(V=!0),a('\n                  <div class="comment-left comment-first-row '),a(s.escapeHtml(j?" repeated":"")),a(" "),a(s.escapeHtml(V?" next-repeated":"")),a('">\n                    <span class="message">\n                      <span class="person inline'),a(s.escapeHtml(j?" repeated":"")),a('"><span class="av-cnv"><canvas class="not-rendered icon" data-auto-refresh="true" data-auto-size="true" data-hashmail-image="'),a(s.escapeHtml(F.userAvatar)),a('" data-tooltip-trigger="'),a(s.escapeHtml(F.userHashmail)),a('"></canvas></span><span class="av-txt">'),a(s.escapeHtml(F.userName)),a(':</span></span>\n                    </span>\n                  </div>\n                  <div class="comment-right comment-first-row '),a(s.escapeHtml(j?" repeated":"")),a(" "),a(s.escapeHtml(V?" next-repeated":"")),a('">\n                    <span class="when comment'),a(s.escapeHtml(_==$.payload.userAvatar?"":" first")),a('" title="'),a(s.escapeHtml(s.dateWithHourLocal(F.dateTime))),a('" data-timeago-type="calendarDate" data-timeago="'),a(s.escapeHtml(F.dateTime)),a('">\n                      '),a(s.escapeHtml(s.calendarDate(F.dateTime))),a('\n                    </span>\n                  </div>\n                  <div class="comment-left comment-second-row">\n                    <div class="box">\n                      <div class="message">'),a(s.formatRichMessage(F.message,"html",t.taskStatuses)),a("</div>\n                    </div>\n                  </div>\n                  "),_=$.payload.userAvatar,a("\n                ")}a("\n              ")}a('\n                </div>\n            <div class="comment-form">\n              <div class="textarea-like box" id="new-comment-text" placeholder="'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.task.comments.addPlaceholder"))),a('"></div>\n              <button class="btn btn-success" data-trigger="add-comment">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.task.comments.addButton"))),a('</button>\n              <span class="enter-saves">\n                <input id="enter-adds-comment" class="enter-adds-comment" type="checkbox" '),a(s.escapeHtml(t.enterAddsComment?"checked":"")),a(' />\n                <label for="enter-adds-comment">'),a(s.escapeHtml(s.i18n("plugin.tasks.component.taskPanel.enterAddsComment"))),a("</label>\n              </span>\n            </div>\n        ")}a("\n      </div>\n    </div>\n  </div>\n  ")}return a("\n</div>"),i}}},{"../../../window/taskGroupForm/template/icon.html":37}],16:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("./FastListRenderScheduler"),i=function(){};s.FastListEntry=i;var a=function(){function t(t,e,s){this.container=null,this.paddingContainer=null,this.entriesContainer=null,this.entries=[],this.fixedEntryHeight=0,this.totalHeight=0,this.visibleRange=[-1,-1],this.nVisible=0,this.fillElement=null,this.createEmptyElement=null,this.beforeRender=null,this.afterRender=null,this.beforeDelElement=null,this.afterContainerResize=null,this.prevContainerInfo=null,this.debug=function(){},this.container=t,this.paddingContainer=e,this.entriesContainer=s,this.renderScheduler=new n.FastListRenderScheduler(this)}return t.prototype.init=function(t){void 0===t&&(t=!0),t&&(this.debug("FastList.render() from FastList.init()"),this.render()),this.container.addEventListener("scroll",this.onContainerScroll.bind(this))},t.prototype.onContainerScroll=function(){this.debug("FastList.render() from FastList.onContainerScroll()"),this.render(!0)},t.prototype.onWindowResize=function(){this.debug("FastList.render() from FastList.onWindowResize()"),this.render(!0)},t.prototype.render=function(t){void 0===t&&(t=!1),this.renderScheduler.scheduleRender(1,t)},t.prototype._render=function(t,e){this.debug("starting FastList.render(); attemptId="+t);var s=this.calcVisibleRange();if(null!=s){var n=s[1]-s[0]+1;-1==s[1]&&-1==s[0]&&(n=0);var i=n-this.nVisible;i>0?this.addElements(i):i<0&&this.delElements(-i),this.beforeRender&&this.beforeRender(s),this.debug("FastList.render() nVisible="+n),this.debug("FastList.render() nToAdd="+i),this.debug("FastList.render() visibleRange="+JSON.stringify(s));for(var a=0,o=n;a<o;++a){var r=this.entriesContainer.childNodes[a];this.fillElement(r,this.entries[s[0]+a],s[0]+a),r.setAttribute("data-entry-id",""+(s[0]+a))}this.visibleRange=s,this.nVisible=n;var l=this.calcUpperMargin(),c=this.calcLowerMargin();this.paddingContainer.style.marginTop=l+"px",this.paddingContainer.style.marginBottom=c+"px",this.debug("FastList.render() upperMargin="+l),this.debug("FastList.render() lowerMargin="+c),this.afterRender&&this.afterRender(s,e)}else this.renderScheduler.scheduleRender(t+1,e)},t.prototype.addElements=function(t){for(var e=0;e<t;++e){var s=this.createEmptyElement();this.entriesContainer.append(s)}},t.prototype.delElements=function(t){for(var e=this.entriesContainer.childNodes.length-1,s=0;s<t;++s){var n=this.entriesContainer.childNodes[e-s];this.beforeDelElement&&this.beforeDelElement(n),n.remove()}},t.prototype.setEmptyElementCreator=function(t){this.createEmptyElement=t},t.prototype.setElementFiller=function(t){this.fillElement=t},t.prototype.setBeforeRender=function(t){this.beforeRender=t},t.prototype.setAfterRender=function(t){this.afterRender=t},t.prototype.setBeforeDelElement=function(t){this.beforeDelElement=t},t.prototype.setAfterContainerResize=function(t,e,s){var n=this;void 0===e&&(e=!1),void 0===s&&(s=null),this.afterContainerResize=t;var i=!1;this.afterContainerResize&&(window.ResizeObserver&&new window.ResizeObserver((function(t){var s=t[0];if(s&&n.afterContainerResize){if(e&&!i)return void(i=!0);i=!0,n.afterContainerResize(s.contentRect.width,s.contentRect.height)}})).observe(s||this.container))},t.prototype.setEntries=function(t){this.entries=t,this.calcEntryStartPoints()},t.prototype.calcEntryStartPoints=function(){if(0!=this.entries.length){this.totalHeight=this.entries[0].height,this.entries[0].startsAt=0;for(var t=this.entries[0],e=t.height,s=!0,n=1,i=this.entries.length;n<i;++n){var a=this.entries[n];a.startsAt=t.startsAt+t.height,t=a,a.height!=e&&(s=!1),this.totalHeight+=a.height}this.fixedEntryHeight=s?e:0}},t.prototype.calcVisibleRange=function(){this.debug("starting FastList.calcVisibleRange()");var t=this.container.scrollTop,e=this.container.clientHeight;if(0==e)return null;this.debug("FastList.calcVisibleRange() scrollTop="+t),this.debug("FastList.calcVisibleRange() height="+e),this.debug("FastList.calcVisibleRange() prevContainerInfo="+JSON.stringify(this.prevContainerInfo)),0==t&&0==e&&null!=this.prevContainerInfo&&(t=this.prevContainerInfo[0],e=this.prevContainerInfo[1]),this.prevContainerInfo=[t,e];var s=0,n=0;this.fixedEntryHeight?n=(s=Math.floor(t/this.fixedEntryHeight))+Math.ceil(e/this.fixedEntryHeight):(s=this.getEntryIdStartingAtOrBeforePoint(t),n=this.getEntryIdEndingAtOrAfterPoint(t+e));var i=this.entries.length;return s=Math.min(s,i-1),n=Math.min(n,i-1),this.debug("FastList.calcVisibleRange() nEntries="+i),this.debug("FastList.calcVisibleRange() first="+s),this.debug("FastList.calcVisibleRange() last="+n),[s,n]},t.prototype.calcUpperMargin=function(){var t=this.entries[this.visibleRange[0]];return t?t.startsAt:0},t.prototype.calcLowerMargin=function(){var t=this.entries[this.entries.length-1],e=this.entries[this.visibleRange[1]];return(t?t.startsAt+t.height:0)-(e?e.startsAt+e.height:0)},t.prototype.getEntryIdStartingAtOrBeforePoint=function(t){return this.binFindPt(t)},t.prototype.getEntryIdEndingAtOrAfterPoint=function(t){var e=this.binFindPt(t);return e<0?-1:(this.entries[e].startsAt==t&&--e,e)},t.prototype.binFindPt=function(t){for(var e=0,s=this.entries.length-1;e+1<s;){var n=Math.floor((e+s)/2);if((a=this.entries[n]).startsAt==t)return n;if(a.startsAt<t){if(a.startsAt+a.height>t)return n;e=n}else s=n}for(var i=e;i<=s;++i){var a;if((a=this.entries[i]).startsAt<=t&&a.startsAt+a.height>t)return i}return this.entries.length-1},t.prototype.scrollTo=function(t){var e=this.container.scrollTop,s=this.container.clientHeight,n=this.entries[t],i=n.startsAt,a=n.startsAt+n.height;i-50<e?this.container.scrollTo(0,i-50):a+50>e+s&&this.container.scrollTo(0,a+50-s)},t.prototype.center=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null);var s=this.container.clientHeight,n=this.totalHeight;if(0==s||n<=s)return!1;if(e||(e=0),null===t)this.container.scrollTo(0,(n-s)/2+e);else{var i=this.entries[t],a=i.startsAt+i.height/2;this.container.scrollTo(0,a-s/2+e)}return!0},t.prototype.getScrollTop=function(){return this.prevContainerInfo?this.prevContainerInfo[0]:this.container.scrollTop},t.prototype.getClientHeight=function(){return this.prevContainerInfo?this.prevContainerInfo[1]:this.container.clientHeight},t}();s.FastList=a,i.prototype.className="com.privmx.plugin.tasks.main.FastListEntry",a.prototype.className="com.privmx.plugin.tasks.main.FastList"},{"./FastListRenderScheduler":18}],17:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("./FastList"),i=function(){function t(){}return t.prototype.create=function(t,e,s){return new n.FastList(t,e,s)},t}();s.FastListCreator=i,i.prototype.className="com.privmx.plugin.tasks.main.FastListCreator"},{"./FastList":16}],18:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=function(){function t(t){this.timeout=null,this.fastList=t}return t.prototype.scheduleRender=function(e,s){var n=this;void 0===e&&(e=1),void 0===s&&(s=!1),null==this.timeout&&(1==e?this.fire(e,s):e<=t.MAX_ATTEMPTS&&(this.timeout=setTimeout((function(){n.fire(e,s)}),t.ATTEMPT_DELAY)))},t.prototype.fire=function(t,e){this.timeout=null,this.fastList._render(t,e)},t.MAX_ATTEMPTS=5,t.ATTEMPT_DELAY=25,t}();s.FastListRenderScheduler=n,n.prototype.className="com.privmx.plugin.tasks.main.FastListRenderScheduler"},{}],19:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=function(){function t(){}return t.prepareString=function(t){return t.toLocaleLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(//g,"l")},t.prepareHaystack=function(t){return this.prepareString(t)},t.prepareNeedle=function(t){return this.prepareString(t)},t.matches=function(t,e){return this.prepareString(e).indexOf(t)>=0},t}();s.SearchFilter=n,n.prototype.className="com.privmx.plugin.tasks.main.SearchFilter"},{}],20:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=function(){function t(){}return t.sort=function(t,e){for(var s=[],n={},i=0,a=t;i<a.length;i++){var o=a[i],r=e[o.tg.projectId],l=parseInt(o.tg.id),c=o.tg.projectId+"/"+o.tg.id;s.push({origId:c,id:isNaN(l)?999999999:l,pinned:r&&r.pinnedTaskGroupIds.indexOf(o.tg.id)>=0?1:0,detached:o.tg.isDetached?1:0,order:r?r.taskGroupsOrder.indexOf(o.tg.id):0}),n[c]=o}s.sort((function(t,e){if(t.detached!=e.detached)return(t.detached?1:0)-(e.detached?1:0);if(t.pinned!=e.pinned){var s=t.pinned?1:0;return(e.pinned?1:0)-s}return t.order!=e.order?t.order-e.order:e.id-t.id}));for(var d=[],p=0,h=s;p<h.length;p++){var u=h[p];d.push(n[u.origId])}return d},t}();s.TaskGroupsSorter=n,n.prototype.className="com.privmx.plugin.tasks.main.TaskGroupsSorter"},{}],21:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("./data/Task"),i=function(){function t(){}return t.sort=function(e,s,i,a){if(null==t.statuses){t.statuses={};for(var o=0,r=0,l=n.Task.getStatuses();r<l.length;r++){var c=l[r];t.statuses[c]=o++}}var d=null,p=null;"hash-id"==s?(d=this.collectId,p=i?this.compareByIdAsc:this.compareByIdDesc):"task"==s?(d=this.collectId,d=this.collectTask,p=i?this.compareByTaskAsc:this.compareByTaskDesc):"status"==s?(d=this.collectStatus,p=i?this.compareByStatusAsc:this.compareByStatusDesc):"assigned-to"==s?(d=this.collectAssignedTo,p=i?this.compareByAssignedToAsc:this.compareByAssignedToDesc):"attachments"==s?(d=this.collectAttachments,p=i?this.compareByAttachmentsAsc:this.compareByAttachmentsDesc):"created"==s?(d=this.collectCreated,p=i?this.compareByCreatedAsc:this.compareByCreatedDesc):"modified"==s&&(d=this.collectModified,p=i?this.compareByModifiedAsc:this.compareByModifiedDesc);for(var h=[],u={},m=0,f=e;m<f.length;m++){var g=f[m];h.push({origId:g.id,comparable:d(g),pinned:g.pinnedInTaskGroupIds.indexOf(a)>=0,tId:parseInt(g.id)}),u[g.id]=g}h.sort((function(t,e){if(t.pinned!=e.pinned){var s=t.pinned?1:0;return(e.pinned?1:0)-s}var n=p(t,e);return 0!=n?n:i?t.tId-e.tId:e.tId-t.tId}));for(var k=[],v=0,y=h;v<y.length;v++){var b=y[v];k.push(u[b.origId])}return k},t.collectId=function(t){return parseInt(t.id)},t.collectTask=function(t){return t.title+" "+t.description},t.collectStatus=function(e){return t.statuses[e.status]},t.collectAssignedTo=function(t){return{size:t.assignedTo.length,str:t.assignedTo.sort().join(", ")}},t.collectAttachments=function(t){return{size:t.attachments.length,str:t.attachments.map((function(t){return JSON.parse(t).name})).sort().join(", ")}},t.collectCreated=function(t){return t.createdAt},t.collectModified=function(t){return t.modifiedAt},t.compareByIdAsc=function(t,e){return t.comparable-e.comparable},t.compareByIdDesc=function(t,e){return e.comparable-t.comparable},t.compareByTaskAsc=function(t,e){return t.comparable.localeCompare(e.comparable)},t.compareByTaskDesc=function(t,e){return e.comparable.localeCompare(t.comparable)},t.compareByStatusAsc=function(t,e){return t.comparable-e.comparable},t.compareByStatusDesc=function(t,e){return e.comparable-t.comparable},t.compareByAssignedToAsc=function(t,e){return t.comparable.size!=e.comparable.size?t.comparable.size-e.comparable.size:t.comparable.str.localeCompare(e.comparable.str)},t.compareByAssignedToDesc=function(t,e){return t.comparable.size!=e.comparable.size?e.comparable.size-t.comparable.size:e.comparable.str.localeCompare(t.comparable.str)},t.compareByAttachmentsAsc=function(t,e){return t.comparable.size!=e.comparable.size?t.comparable.size-e.comparable.size:t.comparable.str.localeCompare(e.comparable.str)},t.compareByAttachmentsDesc=function(t,e){return t.comparable.size!=e.comparable.size?e.comparable.size-t.comparable.size:e.comparable.str.localeCompare(t.comparable.str)},t.compareByCreatedAsc=function(t,e){return t.comparable-e.comparable},t.compareByCreatedDesc=function(t,e){return e.comparable-t.comparable},t.compareByModifiedAsc=function(t,e){return t.comparable-e.comparable},t.compareByModifiedDesc=function(t,e){return e.comparable-t.comparable},t.statuses=null,t}();s.TasksSorter=i,i.prototype.className="com.privmx.plugin.tasks.main.TasksSorter"},{"./data/Task":24}],22:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),function(t){t.tasksSection="tasks-section",t.tasksList="tasks-list",t.tasksTask="tasks-task"}(s.StoredObjectTypes||(s.StoredObjectTypes={})),function(t){t.Global="global",t.TasksWindow="tasks",t.SummaryWindow="summary"}(s.ViewContext||(s.ViewContext={}));var n=function(){function t(){}return t.ALL_TASKS_ID="all-tasks",t.TASKS_ASSIGNED_TO_ME_ID="tasks-assigned-to-me",t.TASKS_CREATED_BY_ME_ID="tasks-created-by-me",t.TRASH_ID="trash",t.ALL_TASKS_INC_TRASHED_ID="all-tasks-inc-trashed",t}();s.CustomTasksElements=n;var i=function(){function t(){}return t.PRIVATE_SECTION_NAME="<my>",t}();s.FixedNames=i;var a=function(){function t(){}return t.HASH_ID=58,t.STATUS=70,t.ASSIGNED_TO=65,t.ATTACHMENTS=100,t.CREATED=110,t.MODIFIED=110,t}();s.DefaultColWidths=a,function(t){t.allTasks="all-tasks",t.onlyUnread="only-unread",t.onlyIdea="only-idea",t.onlyTodo="only-todo",t.onlyInProgress="only-in-progress",t.onlyDone="only-done",t.onlyNotDone="only-not-done"}(s.Filter||(s.Filter={})),n.prototype.className="com.privmx.plugin.tasks.main.CustomTasksElements",i.prototype.className="com.privmx.plugin.tasks.main.FixedNames",a.prototype.className="com.privmx.plugin.tasks.main.DefaultColWidths"},{}],23:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=function(){function t(t){if(void 0===t&&(t=null),"object"==typeof t)for(var e in t)"function"!=typeof t[e]&&(this[e]=t[e])}return t.prototype.ensureFieldIsArray=function(t){Array.isArray(this[t])||(this[t]=[])},t.prototype.ensureFieldsAreArrays=function(t){for(var e=0,s=t;e<s.length;e++){var n=s[e];this.ensureFieldIsArray(n)}},t.prototype.addToProperty=function(t,e,s,n){return void 0===n&&(n=!1),(!s||-1==t.indexOf(e))&&(n?t.splice(0,0,e):t.push(e),!0)},t.prototype.removeFromProperty=function(t,e){var s=t.indexOf(e);return s>=0&&(t.splice(s,1),!0)},t.prototype.isFieldSerializable=function(t){return"__version__"==t||"__data_version__"==t||0==t.length||"_"!=t[0]},t.prototype.toJSON=function(){var t={};for(var e in this)this.isFieldSerializable(e)&&(t[e]=this[e]);return t},t.prototype.updateObjectProperties=function(t,e){if(void 0===e&&(e={}),this!=t)for(var s=0,n=Object.getOwnPropertyNames(t);s<n.length;s++){var i=n[s];this[i]!=t[i]&&(this[i]=t[i],i in e&&e[i](this[i]))}},t}();s.DataObject=n,n.prototype.className="com.privmx.plugin.tasks.main.data.DataObject"},{}],24:[function(t,e,s){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)});Object.defineProperty(s,"__esModule",{value:!0});var a,o=t("./DataObject"),r=t("../utils/Utils"),l=t("../SearchFilter");!function(t){t.UNKNOWN="unknown",t.TODO="todo",t.INPROGRESS="inprogress",t.DONE="done",t.IDEA="idea"}(a=s.TaskStatus||(s.TaskStatus={}));var c=function(t){function e(e){void 0===e&&(e=null);var s=t.call(this,e)||this;return s._cachedSearchString=null,s.ensureFieldsAreArrays(["attachments","assignedTo","history","taskGroupIds","commentTags","pinnedInTaskGroupIds"]),s.duration?(s.startTimestamp&&!s.endTimestamp&&(s.endTimestamp=s.startTimestamp+s.duration),delete s.duration):s.startTimestamp&&!s.endTimestamp&&(s.endTimestamp=s.startTimestamp+36e5,s.wholeDays=!0),s}return i(e,t),e.prototype.getId=function(){return this.id},e.prototype.setId=function(t){this.id=t},e.prototype.getName=function(){return this.name},e.prototype.setName=function(t){this.name=t},e.prototype.getDescription=function(){return this.description},e.prototype.setDescription=function(t){t=t.replace(/\n/g," "),this.setName(t.split("<br>")[0].trim()),this.description=t,this._cachedSearchString=null},e.prototype.getType=function(){return this.type},e.prototype.setType=function(t){this.type=t},e.prototype.getStatus=function(){if(!this.status2){var t=this.__data_version__>1;this.status2=e.convertStatus(this.status,t)}return this.status2},e.prototype.setStatus=function(t){this.status=0,this.status2=t},e.prototype.getPriority=function(){return this.priority},e.prototype.setPriority=function(t){this.priority=t},e.prototype.getAssignedTo=function(t){return void 0===t&&(t=!1),t?this.assignedTo.slice():this.assignedTo},e.prototype.setAssignedTo=function(t){this.assignedTo=t},e.prototype.addAssignedTo=function(t,e){return void 0===e&&(e=!1),this.addToProperty(this.assignedTo,t,e)},e.prototype.removeAssignedTo=function(t){return this.removeFromProperty(this.assignedTo,t)},e.prototype.isAssignedTo=function(t){return this.assignedTo.indexOf(t)>=0},e.prototype.getAttachments=function(t){return void 0===t&&(t=!1),t?this.attachments.slice():this.attachments},e.prototype.setAttachments=function(t){this.attachments=t},e.prototype.addAttachment=function(t,e){return void 0===e&&(e=!1),this.addToProperty(this.attachments,t,e)},e.prototype.removeAttachment=function(t){return this.removeFromProperty(this.attachments,t)},e.prototype.getHistory=function(t){return void 0===t&&(t=!1),t?this.history.slice():this.history},e.prototype.setHistory=function(t){this.history=t},e.prototype.addHistory=function(t,e){return void 0===e&&(e=!1),this.addToProperty(this.history,t,e)},e.prototype.getTaskGroupIds=function(t){return void 0===t&&(t=!1),t?this.taskGroupIds.slice():this.taskGroupIds},e.prototype.setTaskGroupIds=function(t){this.taskGroupIds=t},e.prototype.addTaskGroupId=function(t,e){return void 0===e&&(e=!1),this.addToProperty(this.taskGroupIds,t,e)},e.prototype.removeTaskGroupId=function(t){return this.removeFromProperty(this.taskGroupIds,t)},e.prototype.getProjectId=function(){return this.projectId},e.prototype.setProjectId=function(t){this.projectId=t},e.prototype.getCreatedBy=function(){return this.createdBy},e.prototype.setCreatedBy=function(t){this.createdBy=t},e.prototype.getCreatedDateTime=function(){return this.createdDateTime},e.prototype.setCreatedDateTime=function(t){this.createdDateTime=t},e.prototype.getModifiedBy=function(){return this.modifiedBy},e.prototype.setModifiedBy=function(t){this.modifiedBy=t},e.prototype.getModifiedDateTime=function(){return this.modifiedDateTime},e.prototype.setModifiedDateTime=function(t){this.modifiedDateTime=t},e.prototype.getCommentTags=function(t){return void 0===t&&(t=!1),t?this.commentTags.slice():this.commentTags},e.prototype.setCommentTags=function(t){this.commentTags=t},e.prototype.getComments=function(){var t=[];try{t=JSON.parse(this.comments)}catch(t){}return t},e.prototype.setComments=function(t){this.comments=JSON.stringify(t)},e.prototype.addCommentTag=function(t,e){return void 0===e&&(e=!1),this.addToProperty(this.commentTags,t,e)},e.prototype.removeCommentTag=function(t){return this.removeFromProperty(this.commentTags,t)},e.prototype.getPinnedInTaskGroupIds=function(t){return void 0===t&&(t=!1),t?this.pinnedInTaskGroupIds.slice():this.pinnedInTaskGroupIds},e.prototype.setPinnedInTaskGroupIds=function(t){this.pinnedInTaskGroupIds=t},e.prototype.addPinnedInTaskGroupId=function(t,e){return void 0===e&&(e=!1),this.addToProperty(this.pinnedInTaskGroupIds,t,e,!0)},e.prototype.removePinnedInTaskGroupId=function(t){return this.removeFromProperty(this.pinnedInTaskGroupIds,t)},e.prototype.getCachedSearchString=function(){if(null===this._cachedSearchString){var t=this.description,e=l.SearchFilter.prepareHaystack(t);this._cachedSearchString=e.replace(/<(?:.|\n)*?>/gm,"")}return this._cachedSearchString},e.prototype.getPreDetachTaskGroupIds=function(t){return void 0===t&&(t=!1),t?this.preDetachTaskGroupIds.slice():this.preDetachTaskGroupIds},e.prototype.setPreDetachTaskGroupIds=function(t){this.preDetachTaskGroupIds=t},e.prototype.getIsTrashed=function(){return void 0!==this.isTrashed&&this.isTrashed},e.prototype.setIsTrashed=function(t){this.isTrashed=t},e.prototype.getMetaDataStr=function(){return void 0===this.metaDataStr?null:this.metaDataStr},e.prototype.setMetaDataStr=function(t){this.metaDataStr=t},e.prototype.getLabelClass=function(){return e.getLabelClass(this.getStatus())},e.getLabelClass=function(t){return"task-status-"+t},e.getDefaultStatus=function(){return a.TODO},e.getStatusText=function(t){return t==a.UNKNOWN?"unknown":t==a.TODO?"Todo":t==a.INPROGRESS?"In progress":t==a.DONE?"Done":t==a.IDEA?"Idea":void 0},e.convertStatus=function(t,e){if(e){if(0==t||1==t)return a.TODO;if(2==t)return a.INPROGRESS;if(3==t)return a.DONE}else{if(0==t)return a.TODO;if(1==t)return a.INPROGRESS;if(2==t)return a.DONE}return a.UNKNOWN},e.getStatuses=function(){return[a.IDEA,a.TODO,a.INPROGRESS,a.DONE]},e.prepareHaystack=function(t){return l.SearchFilter.prepareHaystack(t)},e.prototype.wasUnread=function(t,e,s){var n=!1,i=e[t]?e[t][this.getId()]:null,a=this.getHistory(),o=a[a.length-1];return(o.when>this.getModifiedDateTime()?o.who:this.getModifiedBy())!=s&&(!i||i.lastWatched<this.getModifiedDateTime())&&(n=t&&t==this.getProjectId()||null==t),n},e.prototype.getStartTimestamp=function(){return this.startTimestamp},e.prototype.setStartTimestamp=function(t){this.startTimestamp=t},e.prototype.getEndTimestamp=function(){return this.endTimestamp},e.prototype.setEndTimestamp=function(t){this.endTimestamp=t},e.prototype.getWholeDays=function(){return this.wholeDays},e.prototype.setWholeDays=function(t){this.wholeDays=t},e.prototype.matchesSearchString=function(t){return e.matchesSearchString(this.id,this.getCachedSearchString(),t)},e.matchesSearchString=function(t,e,s){return s.length>0&&"#"==s[0]?0==t.indexOf(s.substr(1)):e.indexOf(s)>=0},e.prototype.updateModifiedServerDateTime=function(t){var e=this;this.modifiedDateTime&&this.history.filter((function(t){return t.when==e.modifiedDateTime})).forEach((function(e){return e.when=t})),this.setModifiedDateTime(t)},e.prototype.diff=function(t){var e=[];return this.getId()!=t.getId()&&e.push("id"),this.getName()!=t.getName()&&e.push("name"),this.getDescription()!=t.getDescription()&&e.push("description"),this.getType()!=t.getType()&&e.push("type"),this.getStatus()!=t.getStatus()&&e.push("status"),this.getPriority()!=t.getPriority()&&e.push("priority"),r.Utils.arraysEqual(this.getAttachments(),t.getAttachments())||e.push("attachments"),r.Utils.arraysEqual(this.getAssignedTo(),t.getAssignedTo())||e.push("assignedTo"),r.Utils.arraysEqual(this.getHistory(),t.getHistory(),(function(t,e){return t.when==e.when&&t.who==e.who}))||e.push("history"),r.Utils.arraysEqual(this.getTaskGroupIds(),t.getTaskGroupIds())||e.push("taskGroupIds"),this.getProjectId()!=t.getProjectId()&&e.push("projectId"),this.getCreatedBy()!=t.getCreatedBy()&&e.push("createdBy"),this.getCreatedDateTime()!=t.getCreatedDateTime()&&e.push("createdDateTime"),this.getModifiedBy()!=t.getModifiedBy()&&e.push("modifiedBy"),this.getModifiedDateTime()!=t.getModifiedDateTime()&&e.push("modifiedDateTime"),r.Utils.arraysEqual(this.getCommentTags(),t.getCommentTags())||e.push("commentTags"),this.getIsTrashed()!=t.getIsTrashed()&&e.push("isTrashed"),this.getStartTimestamp()!=t.getStartTimestamp()&&e.push("startTimestamp"),this.getEndTimestamp()!=t.getEndTimestamp()&&e.push("endTimestamp"),this.getWholeDays()!=t.getWholeDays()&&e.push("wholeDays"),this.getComments()!=t.getComments()&&e.push("comments"),e},e}(o.DataObject);s.Task=c,c.prototype.className="com.privmx.plugin.tasks.main.data.Task"},{"../SearchFilter":19,"../utils/Utils":26,"./DataObject":23}],25:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("pmc-web"),i=function(){function t(t,e,s){this.$container=t,this.mouseX=null,this.mouseY=null,this.containerOffsetLeft=0,this.containerOffsetTop=0,this.containerWidth=0,this.containerHeight=0,this.bringToTop=!1,this.dragStartHandler=null,this.dragCancelHandler=null,this.dragDropHandler=null,this.dragEnterZoneHandler=null,this.dragLeaveZoneHandler=null,this.mouseMoveHandler=null,this.$currDraggable=null,this.$currDropZone=null,this.currDropZonesData=[],this.$container.on("dragstart",e,this.onDragStart.bind(this)),n.JQuery(document).on("dragend",this.onDragEnd.bind(this)),this.$container.on("dragover",s,this.onDragOver.bind(this)),this.$container.on("dragenter",s,this.onDragEnter.bind(this)),this.$container.on("dragleave",s,this.onDragLeave.bind(this)),this.$container.on("drop",s,this.onDrop.bind(this))}return t.prototype.setOnDragStart=function(t){this.dragStartHandler=t},t.prototype.setOnDragCancel=function(t){this.dragCancelHandler=t},t.prototype.setOnDragDrop=function(t){this.dragDropHandler=t},t.prototype.setOnDragEnterZone=function(t){this.dragEnterZoneHandler=t},t.prototype.setOnDragLeaveZone=function(t){this.dragLeaveZoneHandler=t},t.prototype.setOnMouseMove=function(t){this.mouseMoveHandler=t},t.prototype.onDragStart=function(t){var e=this,s=this.$container.offset();this.containerOffsetLeft=s.left,this.containerOffsetTop=s.top,this.containerWidth=this.$container.width(),this.containerHeight=this.$container.height(),this.mouseX=null,this.mouseY=null,t.stopPropagation(),this.updateMousePos(t),this.currDropZonesData=[],this.$currDraggable=n.JQuery(t.currentTarget),this.$currDropZone=null,t.dataTransfer=t.originalEvent.dataTransfer,this.triggerDragStart(this.$currDraggable,t),this.bringToTop&&(this.$currDraggable.css({position:"absolute",width:this.$currDraggable.width(),height:this.$currDraggable.height(),zIndex:99999999}),n.Q().then((function(){e.$currDraggable.css({position:"relative",width:"auto",height:"auto",zIndex:"auto"})})))},t.prototype.onDragEnd=function(t){this.$currDraggable&&(t.preventDefault(),t.stopPropagation(),this.updateMousePos(t),this.triggerDragCancel(this.$currDraggable),this.$currDraggable=null)},t.prototype.onDragOver=function(t){t.preventDefault(),t.stopPropagation(),this.updateMousePos(t)},t.prototype.onDragEnter=function(t){if(this.$currDraggable){t.preventDefault(),t.stopPropagation(),this.updateMousePos(t),this.$currDropZone=n.JQuery(t.currentTarget);var e=this.getDropZoneData(t.currentTarget);e.hitCount<=0&&this.triggerDragEnterZone(this.$currDraggable,this.$currDropZone),e.hitCount++,this.setDropZoneData(e)}},t.prototype.onDragLeave=function(t){if(this.$currDraggable){t.preventDefault(),t.stopPropagation(),this.updateMousePos(t);var e=this.getDropZoneData(t.currentTarget);e.hitCount<=0||(1==e.hitCount&&this.triggerDragLeaveZone(this.$currDraggable,n.JQuery(t.currentTarget)),e.hitCount--,this.setDropZoneData(e))}},t.prototype.onDrop=function(t){this.$currDraggable&&(t.preventDefault(),t.stopPropagation(),this.updateMousePos(t),this.$currDropZone=n.JQuery(t.currentTarget),this.triggerDragDrop(this.$currDraggable,this.$currDropZone),this.$currDraggable=null,this.$currDropZone=null)},t.prototype.triggerDragStart=function(t,e){this.dragStartHandler&&this.dragStartHandler(t,e)},t.prototype.triggerDragCancel=function(t){this.dragCancelHandler&&this.dragCancelHandler(t)},t.prototype.triggerDragDrop=function(t,e){this.dragDropHandler&&this.dragDropHandler(t,e)},t.prototype.triggerDragEnterZone=function(t,e){this.dragEnterZoneHandler&&this.dragEnterZoneHandler(t,e)},t.prototype.triggerDragLeaveZone=function(t,e){this.dragLeaveZoneHandler&&this.dragLeaveZoneHandler(t,e)},t.prototype.triggerMouseMove=function(t){this.mouseMoveHandler&&this.mouseMoveHandler(t)},t.prototype.getDropZoneData=function(t){for(var e=0,s=this.currDropZonesData;e<s.length;e++){var n=s[e];if(n.dropZone==t)return n}return{dropZone:t,hitCount:0}},t.prototype.setDropZoneData=function(t){for(var e in this.currDropZonesData){var s=this.currDropZonesData[e];if(s.dropZone==t.dropZone)return void(t.hitCount<=0?this.currDropZonesData.splice(Number(e),1):s.hitCount=t.hitCount)}this.currDropZonesData.push(t)},t.prototype.updateMousePos=function(t){var e=this.mouseX,s=this.mouseY;this.mouseX=t.pageX-this.containerOffsetLeft,this.mouseY=t.pageY-this.containerOffsetTop,null!==e&&null!==s&&this.triggerMouseMove({prevX:e,prevY:s,currX:this.mouseX,currY:this.mouseY})},t}();s.DragDrop=i,i.prototype.className="com.privmx.plugin.tasks.main.utils.DragDrop"},{"pmc-web":1}],26:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=function(){function t(){}return t.arraysEqual=function(t,e,s){return t.length==e.length&&this.orderedArraysEqual(t.slice().sort(),e.slice().sort(),s)},t.orderedArraysEqual=function(t,e,s){if(t.length!=e.length)return!1;s||(s=function(t,e){return t==e});for(var n=0;n<t.length;++n)if(!s(t[n],e[n]))return!1;return!0},t.indexOfBy=function(t,e){for(var s=0;s<t.length;++s)if(e(t[s]))return s;return-1},t.uniqueArrayMerge=function(t,e,s){void 0===s&&(s=function(t,e){return t==e});for(var n=0,i=e;n<i.length;n++){for(var a=i[n],o=!1,r=0,l=t;r<l.length;r++){if(s(a,l[r])){o=!0;break}}o||t.push(a)}},t.arrayDiff=function(t,e){for(var s={added:[],removed:[]},n=0,i=t;n<i.length;n++){var a=i[n];e.indexOf(a)<0&&s.removed.push(a)}for(var o=0,r=e;o<r.length;o++){a=r[o];t.indexOf(a)<0&&s.added.push(a)}return s},t}();s.Utils=n,n.prototype.className="com.privmx.plugin.tasks.main.utils.Utils"},{}],27:[function(t,e,s){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)});Object.defineProperty(s,"__esModule",{value:!0});var a=t("pmc-web"),o=t("./template/main.html"),r=a.Q,l=function(t){function e(e){var s=t.call(this,e,o.func)||this;return s.notifications=s.addComponent("notifications",new a.component.notification.NotificationView(s,{xs:!0})),s}return i(e,t),e.prototype.initWindow=function(t){var e=this;return this.setModel(t),this.$main.on("click","[data-action=yes]",this.onDetachClick.bind(this)),this.$main.on("click","[data-action=no]",this.onCancelClick.bind(this)),r().then((function(){return e.notifications.$container=e.$main.find(".notifications-container-wrapper"),e.notifications.triggerInit()}))},e.prototype.setModel=function(t){},e.prototype.onLinkClick=function(t){t.preventDefault(),this.triggerEventInTheSameTick("openUrl",t.currentTarget.href)},e.prototype.onCloseClick=function(){this.toggleButtonsEnabled(!1),this.triggerEvent("close")},e.prototype.onDetachClick=function(){this.toggleButtonsEnabled(!1),this.triggerEvent("detach")},e.prototype.onCancelClick=function(){this.toggleButtonsEnabled(!1),this.triggerEvent("cancel")},e.prototype.toggleButtonsEnabled=function(t){this.$main.find("[data-action=yes]").prop("disabled",!t),this.$main.find("[data-action=no]").prop("disabled",!t)},e}(a.window.base.BaseWindowView);s.DetachTaskGroupWindowView=l,l.prototype.className="com.privmx.plugin.tasks.window.detachTaskGroup.DetachTaskGroupWindowView"},{"./template/main.html":28,"pmc-web":1}],28:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="",i=function(t){n+=t};return i('<div class="window-detach-taskgroup tasks-plugin-window">\n  <div class="detach">\n    <h4>'),i(s.escapeHtml(s.i18n("plugin.tasks.window.detachTaskGroup.detachTitle"))),i("</h4>\n    <p>"),i(s.i18n("plugin.tasks.window.detachTaskGroup.detachInfo")),i('</p>\n  </div>\n  <div class="buttons-container">\n    <button class="btn btn-success" data-action="yes">'),i(s.escapeHtml(s.i18n("plugin.tasks.window.detachTaskGroup.yes"))),i('</button>\n    <button class="btn btn-default edit-cancel" data-action="no">'),i(s.escapeHtml(s.i18n("plugin.tasks.window.detachTaskGroup.no"))),i("</button>\n  </div>\n</div>"),n}}},{}],29:[function(t,e,s){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)});Object.defineProperty(s,"__esModule",{value:!0});var a=t("pmc-web"),o=t("./template/main.html"),r=t("./template/icon.html"),l=a.JQuery,c=a.Q,d=function(t){function e(e){return t.call(this,e,o.func)||this}return i(e,t),e.prototype.initWindow=function(t){var e=this;return this.setModel(t),this.$main.on("click","[data-action=save]",this.onSaveClick.bind(this)),this.$main.on("click","[data-action=cancel]",this.onCancelClick.bind(this)),this.$main.on("click",".taskgroup-icon",this.onIconClick.bind(this)),this.iconsExtList=this.addComponent("iconsExtList",new a.component.extlist.ExtListView(this,{template:r.func})),this.colorsExtList=this.addComponent("colorsExtList",new a.component.extlist.ExtListView(this,{template:r.func})),this.iconsExtList.$container=this.$main.find(".icons-extlist-container"),this.colorsExtList.$container=this.$main.find(".colors-extlist-container"),c().then((function(){return e.iconsExtList.triggerInit()})).then((function(){return e.colorsExtList.triggerInit()})).then((function(){e.$main.find(".scrollable-content").pfScroll()}))},e.prototype.setModel=function(t){},e.prototype.onLinkClick=function(t){t.preventDefault(),this.triggerEventInTheSameTick("openUrl",t.currentTarget.href)},e.prototype.onCloseClick=function(){this.toggleButtonsEnabled(!1),this.triggerEvent("close")},e.prototype.onSaveClick=function(){this.toggleButtonsEnabled(!1),this.triggerEvent("save")},e.prototype.onCancelClick=function(){this.toggleButtonsEnabled(!1),this.triggerEvent("cancel")},e.prototype.toggleButtonsEnabled=function(t){this.$main.find("[data-action=save]").prop("disabled",!t),this.$main.find("[data-action=cancel]").prop("disabled",!t)},e.prototype.onIconClick=function(t){var e=l(t.currentTarget),s=e.parent(),n=s.children().index(e);s.hasClass("icons-extlist-container")?this.triggerEvent("changeIcon",n):s.hasClass("colors-extlist-container")&&this.triggerEvent("changeColor",n)},e}(a.window.base.BaseWindowView);s.IconPickerWindowView=d,d.prototype.className="com.privmx.plugin.tasks.window.iconPicker.IconPickerWindowView"},{"./template/icon.html":30,"./template/main.html":31,"pmc-web":1}],30:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="",i=function(t){n+=t},a=t&&"{"==t[0]?JSON.parse(t):null;return i('\n<span class="taskgroup-icon'),i(s.escapeHtml(e.isActive?" active":"")),i('">\n  '),a?(i("\n    "),"shape"==a.type?(i('\n      <span class="taskgroup-icon--shape shape-'),i(s.escapeHtml(a.shape)),i('" style="color:'),i(s.escapeHtml(a.color)),i('"></span>\n    ')):"fa"==a.type&&(i('\n      <span class="taskgroup-icon--fa fa fa-'),i(s.escapeHtml(a.fa)),i('" style="color:'),i(s.escapeHtml(a.color)),i('"></span>\n    ')),i("\n  ")):(i('\n    <span class="taskgroup-icon--none">'),i(s.escapeHtml(s.i18n("plugin.tasks.window.taskGroupForm.taskGroupIcon.none"))),i("</span>\n  ")),i("\n</span>"),n}}},{}],31:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="",i=function(t){n+=t};return i('<div class="window-icon-picker tasks-plugin-window">\n  <div class="scrollable-content">\n    <h4>'),i(s.escapeHtml(s.i18n("plugin.tasks.window.iconPicker.iconHeader"))),i('</h4>\n    <div class="icons-container">\n      <div class="icons-extlist-container"></div>\n    </div>\n    <h4>'),i(s.escapeHtml(s.i18n("plugin.tasks.window.iconPicker.colorHeader"))),i('</h4>\n    <div class="colors-container">\n      <div class="colors-extlist-container"></div>\n    </div>\n  </div>\n  <div class="buttons-container">\n    <button class="btn btn-success" data-action="save">'),i(s.escapeHtml(s.i18n("plugin.tasks.window.iconPicker.save"))),i('</button>\n    <button class="btn btn-default edit-cancel" data-action="cancel">'),i(s.escapeHtml(s.i18n("plugin.tasks.window.iconPicker.cancel"))),i("</button>\n  </div>\n</div>"),n}}},{}],32:[function(t,e,s){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)});Object.defineProperty(s,"__esModule",{value:!0});var a=t("pmc-web"),o=t("./template/main.html"),r=function(t){function e(e){return t.call(this,e,o.func)||this}return i(e,t),e.prototype.openIframe=function(t,e){a.Starter.registerDockedWindow(t,e,this.$mainContainer[0]).setAttribute("id","iframe-"+t)},e}(a.window.base.BaseAppWindowView);s.MainWindowView=r,r.prototype.className="com.privmx.plugin.tasks.window.main.MainWindowView"},{"./template/main.html":33,"pmc-web":1}],33:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="";return n+='<div class="window-main">\n  <div class="app-nav-bar"></div>\n  <div class="app-main-container">\n  </div>\n</div>\n  '}}},{}],34:[function(t,e,s){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)});Object.defineProperty(s,"__esModule",{value:!0});var a=t("pmc-web"),o=t("./template/main.html"),r=t("../../component/taskPanel/TaskPanelView"),l=a.Q,c=function(t){function e(e){var s=t.call(this,e,o.func)||this;return s.personsComponent=s.addComponent("personsComponent",new a.component.persons.PersonsView(s,s.helper)),s.taskPanel=s.addComponent("taskPanel",new r.TaskPanelView(s,s.personsComponent)),s}return i(e,t),e.prototype.initWindow=function(t){var e=this;return l().then((function(){return e.personsComponent.$main=e.$main,e.personsComponent.triggerInit()})).then((function(){e.taskPanel.$container=e.$main.find(".task-container"),e.taskPanel.triggerInit(),e.$main.on("keydown",e.onKeyDown.bind(e)),e.$main.attr("tabindex",-1),e.$main.focus()}))},e.prototype.onKeyDown=function(t){if("Escape"==t.key){if(document._preventClose)return;this.triggerEvent("close")}},e.prototype.onLinkClick=function(t){t.preventDefault(),this.triggerEventInTheSameTick("openUrl",t.currentTarget.href)},e.prototype.onCloseClick=function(){this.triggerEvent("close")},e}(a.window.base.BaseWindowView);s.TaskWindowView=c,c.prototype.className="com.privmx.plugin.tasks.window.task.TaskWindowView"},{"../../component/taskPanel/TaskPanelView":11,"./template/main.html":35,"pmc-web":1}],35:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="";return n+='<div class="window-task tasks-plugin-window">\n  <div class="task-container">\n  </div>\n</div>'}}},{}],36:[function(t,e,s){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)});Object.defineProperty(s,"__esModule",{value:!0});var a=t("pmc-web"),o=t("./template/main.html"),r=t("./template/icon.html"),l=a.JQuery,c=a.Q,d=function(t){function e(e){var s=t.call(this,e,o.func)||this;return s.dirty=!1,s.notifications=s.addComponent("notifications",new a.component.notification.NotificationView(s,{xs:!0})),s}return i(e,t),e.prototype.initWindow=function(t){return this.iconTemplate=this.templateManager.createTemplate(r.func),this.initialData={name:t.name,icon:t.icon},this.renderedIcon=t.icon,this.$main.on("click","a",this.onLinkClick.bind(this)),this.$main.on("click","[data-action=close]",this.onCloseClick.bind(this)),this.$main.on("click",".ok",this.onOkClick.bind(this)),this.$main.on("click",".cancel",this.onCancelClick.bind(this)),this.$main.on("input","input[type=text]",this.onInput.bind(this)),this.$main.on("blur","input[type=text]",this.onBlur.bind(this)),this.$main.on("click",".btn-delete",this.onDeleteClick.bind(this)),this.$main.on("click",".btn-detach",this.onDetachClick.bind(this)),this.$main.on("click","[data-action=change-icon]",this.onChangeIconClick.bind(this)),l(document).on("keyup",this.onKeyUp.bind(this)),this.$name=this.$main.find("#taskgroup-name"),this.$name.val(t.name),this.$changeIconLink=this.$main.find("[data-action=change-icon]"),this.$name.select(),this.$name.focus(),t.id,this.$main.find(".due-date-field").css("display","none"),this.notifications.$container=this.$main.find(".notifications-container-wrapper"),this.updateDirty(),c.all([this.notifications.triggerInit()])},e.prototype.setProjectName=function(t){this.$main.find(".project-name").text(t)},e.prototype.onDeleteClick=function(){this.triggerEvent("deleteTaskGroup")},e.prototype.ok=function(){var t=this.validateInput(this.$name);if(!1!==t){var e={name:t};this.triggerEvent("ok",JSON.stringify(e))}},e.prototype.cancel=function(){this.triggerEvent("close")},e.prototype.onLinkClick=function(t){t.preventDefault(),this.triggerEventInTheSameTick("openUrl",t.currentTarget.href)},e.prototype.onCloseClick=function(){this.triggerEvent("close")},e.prototype.onOkClick=function(){this.ok()},e.prototype.onCancelClick=function(){this.cancel()},e.prototype.onInput=function(t){var e=l(t.currentTarget);this.validateInput(e),this.updateDirty()},e.prototype.onBlur=function(t){var e=l(t.currentTarget);this.validateInput(e)},e.prototype.validateInput=function(t){var e=t.val().trim();return(0!=e.length||!t.data("v-not-empty"))&&e},e.prototype.onKeyUp=function(t){"Enter"==t.key?l(t.target).is("textarea")||this.ok():"Escape"==t.key&&this.cancel()},e.prototype.onDetachClick=function(){this.triggerEvent("detach")},e.prototype.onChangeIconClick=function(){this.triggerEvent("changeIcon")},e.prototype.onAfterDetached=function(){this.$main.find("[data-action=detach]").prop("disabled",!0)},e.prototype.updateDirty=function(){var t=this.dirty;this.dirty=!1,this.$name.val()!=this.initialData.name&&(this.dirty=!0),this.renderedIcon!=this.initialData.icon&&(this.dirty=!0),this.dirty!=t&&this.triggerEvent("dirtyChanged",this.dirty)},e.prototype.renderIcon=function(t){var e=this.iconTemplate.renderToJQ(t);this.$main.find(".flex-row.icon").children(".taskgroup-icon").replaceWith(e),this.renderedIcon=t,this.updateDirty()},e.prototype.onAfterCloseList=function(){this.$main.find(".btn-detach").remove()},e}(a.window.base.BaseWindowView);s.TaskGroupFormWindowView=d,d.prototype.className="com.privmx.plugin.tasks.window.taskGroupForm.TaskGroupFormWindowView"},{"./template/icon.html":37,"./template/main.html":38,"pmc-web":1}],37:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="",i=function(t){n+=t},a=t&&"{"==t[0]?JSON.parse(t):null;return i('\n<span class="taskgroup-icon">\n  '),a?(i("\n    "),"shape"==a.type?(i('\n      <span class="taskgroup-icon--shape shape-'),i(s.escapeHtml(a.shape)),i('" style="color:'),i(s.escapeHtml(a.color)),i('"></span>\n    ')):"fa"==a.type&&(i('\n      <span class="taskgroup-icon--fa fa fa-'),i(s.escapeHtml(a.fa)),i('" style="color:'),i(s.escapeHtml(a.color)),i('"></span>\n    ')),i("\n  ")):(i('\n    <span class="taskgroup-icon--none">'),i(s.escapeHtml(s.i18n("plugin.tasks.window.taskGroupForm.taskGroupIcon.none"))),i("</span>\n  ")),i("\n</span>"),n}}},{}],38:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("./icon.html");s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var i="",a=function(t){i+=t};return a('<div class="window-taskgroup-form tasks-plugin-window">\n  <div class="flex-row">\n    <div class="custom-select-project"></div>\n  </div>\n  <div class="flex-row title">\n    <input type="text" id="taskgroup-name" class="taskgroup-name form-control" value="'),a(s.escapeHtml(t.name)),a('" data-v-not-empty="1" />\n  </div>\n  <div class="flex-row icon">\n    <span class="inline-header">'),a(s.escapeHtml(s.i18n("plugin.tasks.window.taskGroupForm.taskGroupIcon"))),a(": </span>\n    "),a(s.createTemplate(n.func).render(t.icon)),a('\n    <span class="link" data-action="change-icon">Change</span>\n    <div class="iconpicker-container'),a(s.escapeHtml(!t.id||t.detached?" fullscreen":"")),a('"><i class="fa fa-times" data-action="close-iconpicker"></i></div>\n  </div>\n  <div class="flex-row due-date due-date-field">\n    <input type="date" id="taskgroup-duedate" class="taskgroup-duedate form-control" value="'),a(s.escapeHtml(t.dueDate)),a('" />\n  </div>\n  <div class="flex-row">\n    <div class="ok-cancel-buttons">\n      <button class="btn btn-success ok edit-save">'),a(s.escapeHtml(s.i18n("plugin.tasks.window.taskGroupForm.save"))),a('</button>\n      <button class="btn btn-default cancel gray edit-cancel">'),a(s.escapeHtml(s.i18n("plugin.tasks.window.taskGroupForm.cancel"))),a("</button>\n      "),t.id&&(a('\n        <button class="btn btn-delete btn-sm small">\n          <span>\n            <i class="fa fa-trash"></i>\n            <span>'),a(s.escapeHtml(s.i18n("plugin.tasks.window.taskGroupForm.delete"))),a("</span>\n          </span>\n        </button>\n        "),t.detached||(a('\n          <button class="btn btn-detach btn-sm small">\n            <span>\n              <i class="fa fa-check-circle-o"></i>\n              <span>'),a(s.escapeHtml(s.i18n("plugin.tasks.window.taskGroupForm.detach"))),a("</span>\n            </span>\n          </button>\n        ")),a("\n      ")),a('\n    </div>\n  </div>\n  <div class="notifications-container-wrapper"></div>\n</div>'),i}}},{"./icon.html":37}],39:[function(t,e,s){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)});Object.defineProperty(s,"__esModule",{value:!0});var a=t("pmc-web"),o=t("./template/main.html"),r=t("./template/taskgroup.html"),l=t("./template/taskgroup-empty.html"),c=a.JQuery,d=function(t){function e(e){var s=t.call(this,e,o.func)||this;return s.taskGroupsExtList=s.addComponent("taskGroupsExtList",new a.component.extlist.ExtListView(s,{template:r.func,emptyTemplate:l.func})),s}return i(e,t),e.prototype.initWindow=function(t){return this.setModel(t),this.$main.on("click",".taskgroup",this.onTaskGroupClick.bind(this)),this.$main.on("click","[data-action=save]",this.onSaveClick.bind(this)),this.$main.on("click","[data-action=cancel]",this.onCancelClick.bind(this)),this.$main.find(".scrollable-content").pfScroll(),this.taskGroupsExtList.$container=this.$main.find(".extlist-container"),this.taskGroupsExtList.triggerInit()},e.prototype.setModel=function(t){},e.prototype.save=function(){this.triggerEvent("save")},e.prototype.cancel=function(){this.triggerEvent("close")},e.prototype.onLinkClick=function(t){t.preventDefault(),this.triggerEventInTheSameTick("openUrl",t.currentTarget.href)},e.prototype.onCloseClick=function(){this.triggerEvent("close")},e.prototype.onSaveClick=function(){this.save()},e.prototype.onCancelClick=function(){this.cancel()},e.prototype.onTaskGroupClick=function(t){var e=c(t.currentTarget).data("taskgroup-id");this.triggerEvent("toggleSelected",e)},e}(a.window.base.BaseWindowView);s.TaskGroupSelectorWindowView=d,d.prototype.className="com.privmx.plugin.tasks.window.taskGroupSelector.TaskGroupSelectorWindowView"},{"./template/main.html":40,"./template/taskgroup-empty.html":41,"./template/taskgroup.html":42,"pmc-web":1}],40:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="",i=function(t){n+=t};return i('<div class="window-taskgroup-selector tasks-plugin-window">\n  <div class="scrollable-content">\n    <div class="extlist-container"></div>\n  </div>\n  <div class="buttons-container">\n    <button class="btn btn-success" data-action="save">'),i(s.escapeHtml(s.i18n("plugin.tasks.window.taskGroupSelector.save"))),i('</button>\n    <button class="btn btn-default edit-cancel" data-action="cancel">'),i(s.escapeHtml(s.i18n("plugin.tasks.window.taskGroupSelector.cancel"))),i("</button>\n  </div>\n</div>"),n}}},{}],41:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="";return n+='<div class="taskgroup taskgroup-empty"></div>'}}},{}],42:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("../../../window/taskGroupForm/template/icon.html");s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var i="",a=function(t){i+=t};return a('<div class="taskgroup '),a(s.escapeHtml(t.isSelected?"selected":"")),a('" data-taskgroup-id="'),a(s.escapeHtml(t.id)),a('">\n  <span class="taskgroup-label" title="'),a(s.escapeHtml(t.name)),a('"><span>'),a(s.createTemplate(n.func).render(t.iconStr)),a("</span><span></span>"),a(s.escapeHtml(t.name)),a("</span></span>\n</div>"),i}}},{"../../../window/taskGroupForm/template/icon.html":37}],43:[function(t,e,s){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)});Object.defineProperty(s,"__esModule",{value:!0});var a,o,r=t("pmc-web"),l=t("./template/main.html"),c=t("./template/panel-taskgroups.html"),d=t("./template/panel-task.html"),p=r.Q,h=r.JQuery,u=t("../../component/taskPanel/TaskPanelView"),m=t("../../component/taskGroupsPanel/TaskGroupsPanelView"),f=t("resize-observer-polyfill");!function(t){t[t.projects=0]="projects",t[t.taskGroups=1]="taskGroups",t[t.task=2]="task"}(a||(a={})),function(t){t[t.top=-999999]="top",t[t.up=-1]="up",t[t.down=1]="down",t[t.bottom=999999]="bottom"}(o||(o={}));var g=function(t){function e(s){var n=t.call(this,s,l.func)||this;return n.$taskGroups=null,n.$task=null,n.taskGroupsPanels={},n.remoteServers={},n.initializedDeferred=p.defer(),n.needsCustomSelectsFlashing=!1,n.activePanelId=0,window.ResizeObserver||(window.ResizeObserver=f),n.verticalSplitter=n.addComponent("verticalSplitter",new r.component.splitter.SplitterView(n,{type:"vertical",handlePlacement:"right",handleDot:!0,firstPanelMinSize:e.SIDEBAR_MIN_WIDTH,secondPanelMinSize:function(){return n.verticalSplitter2&&n.verticalSplitter2.$right&&0!=n.verticalSplitter2.$right.children().length&&n._showTaskPanel?e.TGP_MIN_WIDTH+n.verticalSplitter2.$right.outerWidth():e.TGP_MIN_WIDTH}})),n.verticalSplitter2=n.addComponent("verticalSplitter2",new r.component.splitter.SplitterView(n,{type:"vertical",handlePlacement:"right",flip:!0,handleDot:!0,firstPanelMinSize:e.TGP_MIN_WIDTH,secondPanelMinSize:e.PREVIEW_MIN_WIDTH})),n.horizontalSplitter=n.addComponent("horizontalSplitter",new r.component.splitter.SplitterView(n,{type:"horizontal",handlePlacement:"bottom",flip:!0,handleDot:!0,firstPanelMinSize:e.TGP_MIN_HEIGHT,secondPanelMinSize:e.PREVIEW_MIN_HEIGHT})),n.bindEvent(n.verticalSplitter,"handleUp",(function(t){for(var e in n.taskGroupsPanels)n.taskGroupsPanels[e].onContainerWidthChanged()})),n.bindEvent(n.verticalSplitter2,"handleUp",(function(t){for(var e in n.taskGroupsPanels)n.taskGroupsPanels[e].onContainerWidthChanged()})),n.bindEvent(n.horizontalSplitter,"handleUp",(function(t){for(var e in n.taskGroupsPanels)n.taskGroupsPanels[e].onContainerHeightChanged()})),n.bindEvent(n.verticalSplitter,"handleMove",(function(t){for(var e in n.taskGroupsPanels)n.taskGroupsPanels[e].onContainerWidthChangedStep()})),n.bindEvent(n.verticalSplitter2,"handleMove",(function(t){for(var e in n.taskGroupsPanels)n.taskGroupsPanels[e].onContainerWidthChangedStep()})),n.bindEvent(n.horizontalSplitter,"handleMove",(function(t){for(var e in n.taskGroupsPanels)n.taskGroupsPanels[e].onContainerHeightChangedStep()})),window.addEventListener("resize",n.onWindowResize.bind(n)),n.personsComponent=n.addComponent("personsComponent",new r.component.persons.PersonsView(n,n.helper)),n.taskPanel=n.addComponent("taskPanel",new u.TaskPanelView(n,n.personsComponent)),n.personTooltip=new r.component.persontooltip.PersonTooltipView(n.templateManager,n.personsComponent),n.sectionTooltip=n.addComponent("sectiontooltip",new r.component.sectiontooltip.SectionTooltipView(n)),n.notifications=n.addComponent("notifications",new r.component.notification.NotificationView(n,{xs:!0})),n.disabledSection=n.addComponent("disabled-section",new r.component.disabledsection.DisabledSectionView(n)),n.sidebar=n.addComponent("sidebar",new r.component.sidebar.SidebarView(n,{conv2List:{personsView:n.personsComponent,extList:{template:null}},conv2Splitter:null,customElementList:{extList:{template:null,onAfterListRender:n.onAfterRenderCustomList.bind(n)}},sectionList:{extList:{template:null}},customSectionList:{extList:{template:null}}})),n.bindEvent(n.sidebar.customElementList.customElements,"ext-list-change",n.refreshAvatars.bind(n)),n.bindEvent(n.sidebar.customElementList.customElementsA,"ext-list-change",n.refreshAvatars.bind(n)),n.turnTimeAgoRefresher(3e5),n}return i(e,t),e.prototype.onAfterRenderCustomList=function(){this.personsComponent.refreshAvatars()},e.prototype.initWindow=function(t){var e=this;return this.personsComponent.$main=this.$main,this.personTooltip.init(this.$main),this.setModel(t),this.$settingsMenu=this.$main.find(".context-menu-settings"),this.renderAll(),this.taskPanel.$container=this.$task.children().eq(0),this.taskPanel.triggerInit(),this.$taskGroups.on("click",this.onTaskGroupsPanelClick.bind(this)),this.$task.on("click",this.onTaskPanelClick.bind(this)),this.bindKeyboardEvents(),this.getShowTaskPanel()?this.$main.children(".right-buttons").children().addClass("gray"):this.$main.children(".right-buttons").children().removeClass("gray"),this.notifications.$container=this.$taskGroups.find(".notifications-container-wrapper"),p().then((function(){return e.verticalSplitter.$container=e.$main.find(".panels"),e.verticalSplitter.triggerInit()})).then((function(){return e.$tabbedTasks=h("<div class='section-tasks'></div>"),e.verticalSplitter.$right.append(e.$tabbedTasks),e.verticalSplitter2.$container=e.$tabbedTasks,e.verticalSplitter2.triggerInit()})).then((function(){e.$disabledSectionContainer=h("<div class='disabled-section hidden'></div>"),e.verticalSplitter.$right.append(e.$disabledSectionContainer),e.disabledSection.$container=e.$disabledSectionContainer,e.disabledSection.triggerInit()})).then((function(){return e.horizontalSplitter.$container=e.verticalSplitter2.$left,e.horizontalSplitter.triggerInit()})).then((function(){return e.horizontalSplitter.$top.append(e.$taskGroups),e.getShowTaskPanel()||e.hideTaskPanel(),e.updatePreviewLocation(t.horizontalTaskLayout),e.sidebar.$container=e.verticalSplitter.$left,e.sidebar.$container.addClass("sidebar-container"),e.personsComponent.$main=e.$main,p.all([e.personsComponent.triggerInit(),e.notifications.triggerInit()])})).then((function(){return e.sidebar.$container.on("click",e.onProjectsPanelClick.bind(e)),e.sidebar.triggerInit()})).then((function(){e.$main.focus(),e.grabFocus(),e.personTooltip.init(e.sidebar.$container),e.personsComponent.refreshAvatars(),e.makeCustomScroll(e.verticalSplitter.$left.find(".sidebar")),e.initializedDeferred.resolve()})).then((function(){return e.sectionTooltip.refreshAvatars=e.refreshAvatars.bind(e),e.sidebar.usersListTooltip.refreshAvatars=e.refreshAvatars.bind(e),e.sectionTooltip.$container=e.$main,e.sectionTooltip.triggerInit()}))},e.prototype.checkInit=function(){return this.initializedDeferred.promise},e.prototype.setModel=function(t){this._myId=t.myId,this._privateSectionId=t.privateSectionId,this._members=JSON.parse(t.membersStr)},e.prototype.getShowTaskPanel=function(){return this._showTaskPanel},e.prototype.setShowTaskPanel=function(t){this._showTaskPanel=t},e.prototype.getShowOrphans=function(){return this._showOrphans},e.prototype.setShowOrphans=function(t){this._showOrphans=t},e.prototype.getMyId=function(){return this._myId},e.prototype.getPrivateSectionId=function(){return this._privateSectionId},e.prototype.getMembers=function(){return this._members},e.prototype.toggleDisabledSection=function(t){this.$tabbedTasks.toggleClass("hidden",t),this.$disabledSectionContainer.toggleClass("hidden",!t)},e.prototype.hideContainer=function(t){this.$main.find(".taskgroupspanel-container[data-id='"+t+"']").removeClass("active"),this.$main.find(".section-tasks").toggleClass("hidden",0==this.$main.find(".taskgroupspanel-container.active").length)},e.prototype.renderAll=function(){this.renderTaskGroupsPanel(),this.renderTaskPanel()},e.prototype.renderTaskGroupsPanel=function(){null==this.$taskGroups&&(this.$taskGroups=this.templateManager.createTemplate(c.func).renderToJQ(this.getTaskGroupsModel()))},e.prototype.getUserAvatar=function(t){void 0===t&&(t=null),null===t&&(t=this.getMyId());var e=this.helper.escapeHtml(this.getMembers()[t].avatar);return'<canvas class="not-rendered icon" data-auto-refresh="true" data-auto-size="true" data-hashmail-image="'+e+'" data-tooltip-trigger="'+e+'"></canvas>'},e.prototype.renderTaskPanel=function(){null==this.$task&&(this.$task=h('<div class="task-scrollable" data-cs-container="1"></div>').append(this.templateManager.createTemplate(d.func).renderToJQ()),this.$task.find(".panel-task").append(this.taskPanel.$main))},e.prototype.getProjectsModel=function(){return{}},e.prototype.getTaskGroupsModel=function(){return{}},e.prototype.showTaskPanel=function(){this.$taskGroups.parent().addClass("show-task-panel"),this.$taskGroups.parent().removeClass("hide-task-panel"),this.$taskGroups.parent().closest(".component-splitter-panel-left").addClass("show-task-panel"),this.$taskGroups.parent().closest(".component-splitter-panel-left").removeClass("hide-task-panel"),this.fixPanelsArrangement()},e.prototype.hideTaskPanel=function(){this.$taskGroups.parent().removeClass("show-task-panel"),this.$taskGroups.parent().addClass("hide-task-panel"),this.$taskGroups.parent().closest(".component-splitter-panel-left").removeClass("show-task-panel"),this.$taskGroups.parent().closest(".component-splitter-panel-left").addClass("hide-task-panel")},e.prototype.changeTaskPanelVisibility=function(t){this.getShowTaskPanel()!=t&&(this.setShowTaskPanel(t),t?this.showTaskPanel():this.hideTaskPanel())},e.prototype.onProjectClick=function(t){var e=h(t.currentTarget);e.hasClass("active")||this.triggerEvent("selectProject",e.data("project-id"))},e.prototype.onSectionClick=function(t){var e=h(t.currentTarget);e.hasClass("active")||this.triggerEvent("selectProject",e.data("section-id"))},e.prototype.fixPanelsArrangement=function(){},e.prototype.bindKeyboardEvents=function(){h(document).on("keydown",this.keyboardHandler.bind(this))},e.prototype.keyboardHandler=function(t){if("ArrowLeft"!=t.key&&"ArrowRight"!=t.key||!t.altKey||!t.ctrlKey&&!t.metaKey||(t.preventDefault(),t.stopImmediatePropagation(),this.triggerEvent("history"+t.key)),"Tab"==t.key)if(t.ctrlKey||t.metaKey){t.preventDefault(),t.stopImmediatePropagation();var e=new KeyboardEvent("keydown",{key:"Tab",keyCode:9,ctrlKey:!0,shiftKey:t.shiftKey,bubbles:!0});parent.frameElement.contentDocument.dispatchEvent(e)}else t.preventDefault(),t.shiftKey?this.focusPrevPanel():this.focusNextPanel();else("r"==t.key&&t.ctrlKey||"F5"==t.key)&&(t.preventDefault(),this.triggerEvent("refresh"))},e.prototype.scrollViewIfNeeded=function(t,e){var s=t.offsetParent().height(),n=t[0].getBoundingClientRect().top,i=t.position().top,a=t.outerHeight()+Math.max(parseFloat(t.css("margin-bottom")),parseFloat(t.css("margin-top")));!1===e&&n>=s?t.offsetParent().scrollTop(t.offsetParent().scrollTop()+a):!0===e&&i-a<=0&&t.offsetParent().scrollTop(t.offsetParent().scrollTop()-a)},e.prototype.focusNextPanel=function(){this.switchToPanel(this.activePanelId+1,!0)},e.prototype.focusPrevPanel=function(){this.switchToPanel(this.activePanelId-1,!0)},e.prototype.switchToPanel=function(t,e){var s=this.getShowTaskPanel()?3:2,n=(t+s)%s;this.$main.find(".focus-highlight").remove();var i=h('<div class="focus-highlight"></div>'),a=this.activePanelId;if(this.activePanelId=n<0?n+s:n,e&&a!=this.activePanelId){var o=h(),r=h();0==this.activePanelId?o=(r=this.$main.find(".sidebar-container")).children(".sidebar").first():1==this.activePanelId?r=(o=this.$taskGroups.children(".taskgroupspanel-container.active")).children(".panel"):2==this.activePanelId&&(r=o=this.$task.children(".panel")),i.insertAfter(o),r.focus()}this.triggerEvent("switchToPanel",this.activePanelId),setTimeout((function(){i.remove()}),500)},e.prototype.grabFocus=function(t){void 0===t&&(t=!0);var e=this.activePanelId;this.activePanelId=0==e?e+1:e-1,this.switchToPanel(e,t)},e.prototype.onProjectsPanelClick=function(){this.switchToPanel(0,!1)},e.prototype.onTaskGroupsPanelClick=function(){this.switchToPanel(1,!1)},e.prototype.onTaskPanelClick=function(){this.switchToPanel(2,!1)},e.prototype.createTaskGroupsPanel=function(t,e){var s=this.getTaskGroupsPanelKey(t,e);if(s in this.taskGroupsPanels)return this.taskGroupsPanels[s];var n=this.addComponent("taskGroupsPanel-"+s,new m.TaskGroupsPanelView(this,this.personsComponent,!0)),i=h("<div class='taskgroupspanel-container' data-id='"+e+"' data-host-hash='"+t+"'></div>");this.$taskGroups.append(i),n.$container=i,n.triggerInit(),this.taskGroupsPanels[s]=n},e.prototype.openTaskGroupsPanel=function(t,e){var s=this.$taskGroups.find(".taskgroupspanel-container"),n=s.filter("[data-id='"+e+"'][data-host-hash='"+t+"']");s.removeClass("active"),n.addClass("active"),this.$main.find(".section-tasks").toggleClass("hidden",0==this.$main.find(".taskgroupspanel-container.active").length),this.needsCustomSelectsFlashing&&(this.needsCustomSelectsFlashing=!1,this.flashCustomSelects(t,e)),this.triggerEvent("openedTaskGroupsPanel",t,e)},e.prototype.getTaskGroupsPanelKey=function(t,e){return t+"--"+e},e.prototype.onSearchChanged=function(t,e){e&&this.personsComponent.refreshAvatars(),this.$main.toggleClass("search-on",t),this.sidebar.refreshInfoTooltips()},e.prototype.refreshAvatars=function(){this.personsComponent.refreshAvatars()},e.prototype.updatePreviewLocation=function(t){var e=this.$taskGroups.parent(),s=e.closest(".component-splitter-panel-left");for(var n in e.toggleClass("show-preview",t),e.toggleClass("hide-preview",!t),s.toggleClass("show-preview",!t),s.toggleClass("hide-preview",t),t?this.horizontalSplitter.$bottom.append(this.$task):this.verticalSplitter2.$right.append(this.$task),this.taskGroupsPanels)this.taskGroupsPanels[n].onContainerWidthChanged(),this.taskGroupsPanels[n].onContainerHeightChanged();this.fixPanelsArrangement()},e.prototype.onWindowResize=function(){for(var t in this.taskGroupsPanels)this.taskGroupsPanels[t].onContainerWidthChangedStep(),this.taskGroupsPanels[t].onContainerHeightChangedStep()},e.prototype.flashCustomSelects=function(t,e){var s=this.getTaskGroupsPanelKey(t,e),n=this.taskGroupsPanels[s];n&&n.$container.find(".top .component-custom-select-main").fadeOut(150).fadeIn(300)},e.prototype.expandRemoteSectionsList=function(t,e){var s,n=this;this.isRemoteHostVisible(e)?this.toggleRemoteHost(e,!1):(this.sidebar.showHostLoading(e,!1),p().then((function(){if(n.remoteServers||(n.remoteServers={}),!(e in n.remoteServers))return s=n.$main.find(".host-element[data-host-id='"+e+"']"),n.remoteListsExists(e)?void 0:p().then((function(){s.parent().append(h("<div class='remote-sections' data-host-id='"+e+"'></div>")),s.parent().append(h("<div class='remote-conversations' data-host-id='"+e+"'></div>"));var i={host:t,sectionsList:n.addComponent("remoteSectionsList-"+e,new r.component.remotesectionlist.RemoteSectionListView(n,{extList:{template:null}})),conv2List:n.addComponent("remoteConv2List-"+e,new r.component.remoteconv2list.RemoteConv2ListView(n,{personsView:n.personsComponent,extList:{template:null}}))};return i.sectionsList.sections.$container=s.parent().find(".remote-sections[data-host-id='"+e+"']"),i.conv2List.conversations.$container=s.parent().find(".remote-conversations[data-host-id='"+e+"']"),n.sidebar.remoteSectionLists[e]=i.sectionsList,n.sidebar.remoteConv2Lists[e]=i.conv2List,i.conv2List.conversations.$container.addClass("with-assigned-to-prefixes"),n.remoteServers[e]=i,p.all([i.sectionsList.triggerInit(),i.conv2List.triggerInit()])}))})).then((function(){n.toggleRemoteHost(e,!0)})))},e.prototype.toggleRemoteHost=function(t,e){var s=this.$main.find(".host-element[data-host-id='"+t+"']");s.parent().find(".remote-sections[data-host-id='"+t+"']").toggleClass("hide",!e),s.parent().find(".remote-conversations[data-host-id='"+t+"']").toggleClass("hide",!e),this.sidebar.hostList.toggleHostElementIsExpanded(t,e)},e.prototype.isRemoteHostVisible=function(t){return!this.$main.find(".host-element[data-host-id='"+t+"']").find(".fa.expanded").hasClass("hide")},e.prototype.remoteListsExists=function(t){return this.$main.find(".host-element[data-host-id='"+t+"']").parent().find(".remote-sections[data-host-id='"+t+"']").length>0},e.SIDEBAR_MIN_WIDTH=100,e.TGP_MIN_WIDTH=300,e.TGP_MIN_HEIGHT=100,e.PREVIEW_MIN_WIDTH=100,e.PREVIEW_MIN_HEIGHT=50,e}(r.window.base.BaseWindowView);s.TasksWindowView=g,g.prototype.className="com.privmx.plugin.tasks.window.tasks.TasksWindowView"},{"../../component/taskGroupsPanel/TaskGroupsPanelView":6,"../../component/taskPanel/TaskPanelView":11,"./template/main.html":44,"./template/panel-task.html":45,"./template/panel-taskgroups.html":46,"pmc-web":1,"resize-observer-polyfill":2}],44:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="";return n+='<div class="window-tasks" tabindex="-1">\n  <div class="panels"></div>\n</div>'}}},{}],45:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="";return n+='<div class="panel panel-task" tabindex="-1">\n</div>'}}},{}],46:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(t,e,s){var n="";return n+='<div class="taskgroupspanels-container">\n\t\n</div>'}}},{}]},{},[3]);
//# sourceMappingURL=view.js.map
