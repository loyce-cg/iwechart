{"version":3,"sources":["window/taskGroupForm/TaskGroupFormWindowView.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,6BAA+B;AAC/B,kDAA6D;AAC7D,kDAA6D;AAE7D,IAAO,CAAC,GAAG,GAAG,CAAC,MAAM,CAAC;AAGtB,IAAO,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;AAOjB;IAA6C,2CAAqC;IAW9E,iCAAY,MAAgC;QAA5C,YACI,kBAAM,MAAM,EAAE,gBAAY,CAAC,SAE9B;QATD,WAAK,GAAY,KAAK,CAAC;QAQnB,KAAI,CAAC,aAAa,GAAG,KAAI,CAAC,YAAY,CAAC,eAAe,EAAE,IAAI,GAAG,CAAC,SAAS,CAAC,YAAY,CAAC,gBAAgB,CAAC,KAAI,EAAE,EAAC,EAAE,EAAE,IAAI,EAAC,CAAC,CAAC,CAAC;;IAC/H,CAAC;IAED,4CAAU,GAAV,UAAW,KAAY;QACnB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,gBAAY,CAAC,CAAC;QAEtE,IAAI,CAAC,WAAW,GAAG;YACf,IAAI,EAAE,KAAK,CAAC,IAAI;YAChB,IAAI,EAAE,KAAK,CAAC,IAAI;SACnB,CAAC;QACF,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC,IAAI,CAAC;QAE/B,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE,GAAG,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACzD,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE,qBAAqB,EAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAC5E,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACzD,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACjE,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE,kBAAkB,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACpE,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,MAAM,EAAE,kBAAkB,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAClE,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE,aAAa,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACrE,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE,aAAa,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACrE,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE,2BAA2B,EAAE,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACvF,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAEjD,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAChD,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QAE3B,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,2BAA2B,CAAC,CAAC;QAEpE,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;QACpB,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;QAEnB,IAAI,CAAC,KAAK,CAAC,EAAE,IAAI,IAAI,EAAE;YACnB,IAAI,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAC7C,GAAG,CAAC,GAAG,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;SAC9B;QAED,IAAI,CAAC,aAAa,CAAC,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,kCAAkC,CAAC,CAAC;QAEpF,IAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,OAAO,CAAC,CAAC,GAAG,CAAC;YACT,IAAI,CAAC,aAAa,CAAC,WAAW,EAAE;SACnC,CAAC,CAAC;IACP,CAAC;IAED,gDAAc,GAAd,UAAe,IAAY;QACvB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAChD,CAAC;IAED,+CAAa,GAAb;QACI,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAC,CAAC;IACzC,CAAC;IAED,oCAAE,GAAF;QACI,IAAI,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC1C,IAAI,IAAI,KAAK,KAAK,EAAE;YAChB,IAAI,GAAG,GAAG;gBACN,IAAI,EAAE,IAAI;aACb,CAAC;YACF,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;SAChD;IACL,CAAC;IAED,wCAAM,GAAN;QACI,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;IAC/B,CAAC;IAED,6CAAW,GAAX,UAAY,KAAiB;QACzB,KAAK,CAAC,cAAc,EAAE,CAAC;QACvB,IAAI,CAAC,yBAAyB,CAAC,SAAS,EAAsB,KAAK,CAAC,aAAc,CAAC,IAAI,CAAC,CAAC;IAC7F,CAAC;IAED,8CAAY,GAAZ;QACI,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;IAC/B,CAAC;IAED,2CAAS,GAAT;QACI,IAAI,CAAC,EAAE,EAAE,CAAC;IACd,CAAC;IAED,+CAAa,GAAb;QACI,IAAI,CAAC,MAAM,EAAE,CAAC;IAClB,CAAC;IAED,yCAAO,GAAP,UAAQ,CAAM;QACV,IAAI,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC;QAChC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAC3B,IAAI,CAAC,WAAW,EAAE,CAAC;IACvB,CAAC;IAED,wCAAM,GAAN,UAAO,CAAM;QACT,IAAI,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC;QAChC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;IAC/B,CAAC;IAED,+CAAa,GAAb,UAAc,MAAc;QACxB,IAAI,GAAG,GAAY,MAAM,CAAC,GAAG,EAAG,CAAC,IAAI,EAAE,CAAC;QACxC,IAAI,GAAG,CAAC,MAAM,IAAI,CAAC,IAAI,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE;YAE/C,OAAO,KAAK,CAAC;SAChB;aACI;YAED,OAAO,GAAG,CAAC;SACd;IACL,CAAC;IAED,yCAAO,GAAP,UAAQ,CAAgB;QACpB,IAAI,CAAC,CAAC,GAAG,IAAI,OAAO,EAAE;YAClB,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,EAAE;gBAC7B,IAAI,CAAC,EAAE,EAAE,CAAC;aACb;SACJ;aACI,IAAI,CAAC,CAAC,GAAG,IAAI,QAAQ,EAAE;YACxB,IAAI,CAAC,MAAM,EAAE,CAAC;SACjB;IACL,CAAC;IAED,+CAAa,GAAb;QACI,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;IAChC,CAAC;IAED,mDAAiB,GAAjB;QACI,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;IACpC,CAAC;IAED,iDAAe,GAAf;QACI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;IACnE,CAAC;IAED,6CAAW,GAAX;QACI,IAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC;QAC3B,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,IAAI,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE;YAC3C,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;SACrB;QACD,IAAI,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE;YAC5C,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;SACrB;QACD,IAAI,IAAI,CAAC,KAAK,IAAI,SAAS,EAAE;YACzB,IAAI,CAAC,YAAY,CAAC,cAAc,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;SACjD;IACL,CAAC;IAED,4CAAU,GAAV,UAAW,IAAY;QACnB,IAAI,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QAC/C,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QACjF,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QACzB,IAAI,CAAC,WAAW,EAAE,CAAC;IACvB,CAAC;IAED,kDAAgB,GAAhB;QACI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,MAAM,EAAE,CAAC;IAC5C,CAAC;IAEL,8BAAC;AAAD,CAxKA,AAwKC,CAxK4C,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,cAAc,GAwK1E;AAxKY,0DAAuB;AAyK9B,uBAAuB,CAAC,SAAU,CAAC,SAAS,GAAG,sEAAsE,CAAC","file":"TaskGroupFormWindowView.js","sourcesContent":["import * as web from \"pmc-web\";\nimport { func as mainTemplate }  from \"./template/main.html\";\nimport { func as iconTemplate }  from \"./template/icon.html\";\nimport { Model } from \"./TaskGroupFormWindowController\";\nimport $ = web.JQuery;\nimport MailClientViewHelper = web.webUtils.MailClientViewHelper;\nimport Template = web.webUtils.template.Template;\nimport Q = web.Q;\n\ninterface InitialData {\n    name: string;\n    icon: string;\n}\n\nexport class TaskGroupFormWindowView extends web.window.base.BaseWindowView<Model> {\n    \n    $name: JQuery;\n    $changeIconLink: JQuery;\n    notifications: web.component.notification.NotificationView;\n    dirty: boolean = false;\n    initialData: InitialData;\n    onDocumentClickBound: any;\n    iconTemplate: Template<string, void, MailClientViewHelper>;\n    renderedIcon: string;\n    \n    constructor(parent: web.Types.app.ViewParent) {\n        super(parent, mainTemplate);\n        this.notifications = this.addComponent(\"notifications\", new web.component.notification.NotificationView(this, {xs: true}));\n    }\n    \n    initWindow(model: Model): any {\n        this.iconTemplate = this.templateManager.createTemplate(iconTemplate);\n        \n        this.initialData = {\n            name: model.name,\n            icon: model.icon,\n        };\n        this.renderedIcon = model.icon;\n        \n        this.$main.on(\"click\", \"a\", this.onLinkClick.bind(this));\n        this.$main.on(\"click\", \"[data-action=close]\", this.onCloseClick.bind(this));\n        this.$main.on(\"click\", \".ok\", this.onOkClick.bind(this));\n        this.$main.on(\"click\", \".cancel\", this.onCancelClick.bind(this));\n        this.$main.on(\"input\", \"input[type=text]\", this.onInput.bind(this));\n        this.$main.on(\"blur\", \"input[type=text]\", this.onBlur.bind(this));\n        this.$main.on(\"click\", \".btn-delete\", this.onDeleteClick.bind(this));\n        this.$main.on(\"click\", \".btn-detach\", this.onDetachClick.bind(this));\n        this.$main.on(\"click\", \"[data-action=change-icon]\", this.onChangeIconClick.bind(this));\n        $(document).on(\"keyup\", this.onKeyUp.bind(this));\n        \n        this.$name = this.$main.find(\"#taskgroup-name\");\n        this.$name.val(model.name);\n        \n        this.$changeIconLink = this.$main.find(\"[data-action=change-icon]\");\n        \n        this.$name.select();\n        this.$name.focus();\n        \n        if (!model.id || true) {\n            let $dd = this.$main.find(\".due-date-field\");\n            $dd.css(\"display\", \"none\");\n        }\n        \n        this.notifications.$container = this.$main.find(\".notifications-container-wrapper\");\n        \n        this.updateDirty();\n        \n        return Q.all([\n            this.notifications.triggerInit(),\n        ]);\n    }\n    \n    setProjectName(name: string) {\n        this.$main.find(\".project-name\").text(name);\n    }\n    \n    onDeleteClick(): void {\n        this.triggerEvent(\"deleteTaskGroup\");\n    }\n    \n    ok(): void {\n        let name = this.validateInput(this.$name);\n        if (name !== false) {\n            let res = {\n                name: name,\n            };\n            this.triggerEvent(\"ok\", JSON.stringify(res));\n        }\n    }\n    \n    cancel(): void {\n        this.triggerEvent(\"close\");\n    }\n    \n    onLinkClick(event: MouseEvent): void {\n        event.preventDefault();\n        this.triggerEventInTheSameTick(\"openUrl\", (<HTMLAnchorElement>event.currentTarget).href);\n    }\n    \n    onCloseClick(): void {\n        this.triggerEvent(\"close\");\n    }\n    \n    onOkClick(): void {\n        this.ok();\n    }\n        \n    onCancelClick(): void {\n        this.cancel();\n    }\n    \n    onInput(e: any): void {\n        let $input = $(e.currentTarget);\n        this.validateInput($input);\n        this.updateDirty();\n    }\n    \n    onBlur(e: any): void {\n        let $input = $(e.currentTarget);\n        this.validateInput($input);\n    }\n    \n    validateInput($input: JQuery): string|boolean {\n        let val = (<string>$input.val()).trim();\n        if (val.length == 0 && $input.data(\"v-not-empty\")) {\n            //$input.addClass(\"error\");\n            return false;\n        }\n        else {\n            //$input.removeClass(\"error\");\n            return val;\n        }\n    }\n    \n    onKeyUp(e: KeyboardEvent): void {\n        if (e.key == \"Enter\") {\n            if (!$(e.target).is(\"textarea\")) {\n                this.ok();\n            }\n        }\n        else if (e.key == \"Escape\") {\n            this.cancel();\n        }\n    }\n    \n    onDetachClick(): void {\n        this.triggerEvent(\"detach\");\n    }\n    \n    onChangeIconClick(): void {\n        this.triggerEvent(\"changeIcon\");\n    }\n    \n    onAfterDetached(): void {\n        this.$main.find(\"[data-action=detach]\").prop(\"disabled\", true);\n    }\n    \n    updateDirty(): void {\n        let prevDirty = this.dirty;\n        this.dirty = false;\n        if (this.$name.val() != this.initialData.name) {\n            this.dirty = true;\n        }\n        if (this.renderedIcon != this.initialData.icon) {\n            this.dirty = true;\n        }\n        if (this.dirty != prevDirty) {\n            this.triggerEvent(\"dirtyChanged\", this.dirty);\n        }\n    }\n    \n    renderIcon(icon: string): void {\n        let $icon = this.iconTemplate.renderToJQ(icon);\n        this.$main.find(\".flex-row.icon\").children(\".taskgroup-icon\").replaceWith($icon);\n        this.renderedIcon = icon;\n        this.updateDirty();\n    }\n    \n    onAfterCloseList(): void {\n        this.$main.find(\".btn-detach\").remove();\n    }\n    \n}\n(<any>TaskGroupFormWindowView.prototype).className = \"com.privmx.plugin.tasks.window.taskGroupForm.TaskGroupFormWindowView\";"],"sourceRoot":"../../../src"}