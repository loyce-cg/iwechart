!function e(t,n,i){function o(a,l){if(!n[a]){if(!t[a]){var r="function"==typeof require&&require;if(!l&&r)return r(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[a]={exports:{}};t[a][0].call(d.exports,(function(e){return o(t[a][1][e]||e)}),d,d.exports,e,t,n,i)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){var i=privmxViewRequire("privmx-view");t.exports=i},{}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../window/notes2/Notes2WindowView"),o=e("../window/newnote/NewNoteWindowView"),s=e("../window/recentfiles/RecentFilesWindowView"),a=e("../window/history/HistoryWindowView"),l=e("../window/filesimporter/FilesImporterWindowView"),r=e("../window/fileconflictresolver/FileConflictResolverWindowView"),c=e("../window/fileerror/FileErrorWindowView"),d=e("../component/fileslist/FilesListView"),p=e("../window/filechooser/FileChooserWindowView"),f=e("pmc-web");f.Starter.objectFactory.register(i.Notes2WindowView),f.Starter.objectFactory.register(o.NewNoteWindowView),f.Starter.objectFactory.register(s.RecentFilesWindowView),f.Starter.objectFactory.register(a.HistoryWindowView),f.Starter.objectFactory.register(r.FileConflictResolverWindowView),f.Starter.objectFactory.register(c.FileErrorWindowView),f.Starter.objectFactory.register(p.FileChooserWindowView),f.Starter.objectFactory.register(l.FilesImporterWindowView),f.Starter.addEventListener("instanceregistered",(function(e){if(e.instance&&"com.privmx.core.window.sectionsummary.SectionSummaryWindowView"==e.instance.className){var t=new d.FilesListView(e.instance,e.instance.personsComponent);t.$container=f.JQuery('<div class="notes2-fileslist-component"></div>'),e.instance.registerModule("notes2",t)}}),"notes2","ethernal")},{"../component/fileslist/FilesListView":3,"../window/filechooser/FileChooserWindowView":11,"../window/fileconflictresolver/FileConflictResolverWindowView":13,"../window/fileerror/FileErrorWindowView":15,"../window/filesimporter/FilesImporterWindowView":17,"../window/history/HistoryWindowView":30,"../window/newnote/NewNoteWindowView":33,"../window/notes2/Notes2WindowView":36,"../window/recentfiles/RecentFilesWindowView":41,"pmc-web":1}],3:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s=e("pmc-web"),a=e("./template/file-entry.html"),l=e("./template/files-list.html"),r=e("./template/files-actions.html"),c=e("./template/files-list-empty.html"),d=e("./template/actions-menu.html"),p=e("../../main/Common"),f=function(e){function t(t,n){var i=e.call(this,t)||this;return i.personsComponent=n,i.viewMode="tiles",i.userCanWrite=!0,i.selectedFileIds=[],i.asFileChooser=!1,i.order=20,i.notifications=i.addComponent("notifications",new s.component.notification.NotificationView(i,{xs:!0})),i.taskTooltip=i.addComponent("tasktooltip",new s.component.tasktooltip.TaskTooltipView(i)),i.taskTooltip.refreshAvatars=function(){i.personsComponent.refreshAvatars()},i.basicTooltip=i.addComponent("basicTooltip",new s.component.tooltip.TooltipView(i)),i.locksTooltip=i.addComponent("locksTooltip",new s.component.userslisttooltip.UsersListTooltipView(i)),i.locksTooltip.refreshAvatars=function(){i.personsComponent.refreshAvatars()},i.files=i.addComponent("files",new s.component.extlist.ExtListView(i,{template:a.func,emptyTemplate:c.func,onAfterListRender:function(){i.personsComponent.refreshAvatars(),i.updateSplitFileNames(),i.addSelectedItemClasses(),i.updateSettingsMenu()}})),i.files.addEventListener("ext-list-change",i.onAfterListRender.bind(i)),i}return o(t,e),t.prototype.initViewAfterSessionSet=function(e){var t=this;s.Q().then((function(){return t.taskChooser=t.addComponent("taskchooser-"+e,new s.component.taskchooser.TaskChooserView(t)),t.taskChooser.$container=t.$container,t.taskChooser.triggerInit()})).then((function(){}))},t.prototype.init=function(e){var t=this;return this.model=e,this.selectedFileIds=JSON.parse(e.selectedIdsStr),s.Q().then((function(){t.id=e.id,t.isAll=e.isAll,t.isLocal=e.isLocal,t.isTrash=e.isTrash,t.editable=e.editable,t.isDeletedUserSection=e.isDeletedUserSection,t.viewMode=e.viewMode,t.asFileChooser=e.asFileChooser,t.systemLabel=e.systemLabel,t.$container.attr("tabindex","-1"),t.$container.on("keydown",t.onKeydown.bind(t)),t.$container.on("click",".file-entry[data-id]",t.onFileEntryClick.bind(t)),t.$container.on("click","[data-action=new-note]",t.onNewNoteClick.bind(t)),t.$container.on("click","[data-action=refresh]",t.onFileActionClick.bind(t)),t.$container.on("click","[data-action=toggle-view-mode]",t.onToggleViewModeClick.bind(t)),t.$container.on("click","[data-action=mark-all-as-read]",t.onMarkAllAsReadClick.bind(t)),t.$container.on("click","[data-action=empty-trash]",t.onEmptyTrashClick.bind(t)),t.$container.on("click","[data-action=export-files]",t.onExportAllFilesClick.bind(t)),e.isElectron&&t.$container.on("click","[data-action=import-files]",t.onImportFilesClick.bind(t)),t.$container.on("click","[data-action=add-dir-to-playlist]",t.onAddDirToPlaylistClick.bind(t)),t.$container.on("click",".actions-menu [data-action-id]",t.onActionsMenuClick.bind(t)),t.$container.on("click","[data-task-id]",t.onTaskClick.bind(t)),t.$container.on("click","[data-action=open-settings]",t.onOpenSettingsClick.bind(t)),t.$container.on("click","[data-setting]",t.onSettingClick.bind(t)),t.$container.on("click",".context-menu-backdrop2",t.onCloseSettingsClick.bind(t)),t.$container.on("click","[data-action=add-person]",t.onAddPersonClick.bind(t)),t.$container.on("click","[data-action=remove-person]",t.onRemovePersonClick.bind(t))})).then((function(){return t.notifications.$container=t.$container,t.notifications.triggerInit()})).then((function(){return t.taskTooltip.$container=t.$container,t.taskTooltip.triggerInit()})).then((function(){var n=t.templateManager.createTemplate(s.component.template.conversation);return t.$container.append(t.templateManager.createTemplate(l.func).renderToJQ(e,n)),t.files.$container=t.$container.find(".files-container tbody"),t.$filesList=t.$container.find(".files-list"),t.parent.makeCustomScroll(t.$filesList.find(".files-container")),t.$filesHeader=t.$container.find(".files-header"),t.$filesActions=t.$container.find(".files-actions-container"),t.$filesActions.on("click",".action-item[action-id]",t.onFileActionClick.bind(t)),e.asFileChooser||t.$filesActions.append(t.templateManager.createTemplate(r.func).renderToJQ(e)),t.onClipboardChange(e.clipboard),t.refreshPath(e.currentPath),t.updateViewMode(t.viewMode),t.$settingsMenu=t.$container.find(".context-menu-settings"),t.parent.elementEllipsis(t.$container.find(".current-path"),e.currentPath,!0),t.files.triggerInit()})).then((function(){return t.basicTooltip.$container=t.$container,t.basicTooltip.isEnabled=function(e){return!t.$filesActions.find("[action-id=delete]").hasClass("selection-fully-deletable")},t.basicTooltip.triggerInit()})).then((function(){return t.locksTooltip.$container=t.$container,t.locksTooltip.triggerInit()})).then((function(){window.ResizeObserver&&new window.ResizeObserver((function(e){t.$settingsMenu&&t.$settingsMenu.hasClass("visible")&&t.$settingsMenu.removeClass("visible")})).observe(t.$filesList[0])})).then((function(){t.personsComponent.refreshAvatars()}))},t.prototype.updatePersonPresence=function(e,t){if(this.model){var n=this.model.persons.filter((function(t){return t.hashmail==e}))[0];n&&(n.present=t,this.refreshConvHeader())}},t.prototype.onActivate=function(){this.onResize()},t.prototype.onDeactivate=function(){},t.prototype.onAfterListRender=function(){this.updateButtonsState(),this.triggerEvent("updateCanWrite")},t.prototype.updateCanWrite=function(e){this.userCanWrite=e,this.updateButtonsState()},t.prototype.updateButtonsState=function(){var e=this.userCanWrite,t=this.files.$container.find(".file-entry.selected"),n=0==this.files.$container.children(".file-entry").length,i=t.length>1,o=t.data("type"),s=t.data("id"),a=!i,l=this.areAllElements("deletable",t),r=!i&&t.data("renamable"),c=!i&&t.data("hashistory"),d=!i&&t.data("printable"),p=!i&&t.data("cansaveaspdf"),f=(i||a)&&!t.data("isparentdir"),u=l,m=!i&&"file"==o,h=window.electronRequire,v=!this.isLocal&&(h?i||"parent"!=s:!i&&"file"==o),w=!i&&"file"==o;this.$filesActions.find("[action-id=open]").prop("disabled",!e||!a||n||this.isDeletedUserSection),this.$filesActions.find("[action-id=delete]").prop("disabled",!e||!l||n||this.isDeletedUserSection),this.$filesActions.find("[action-id=rename]").prop("disabled",!e||!r||"trash"==this.id||n||this.isDeletedUserSection),this.$filesActions.find("[action-id=copy]").prop("disabled",!e||!f||n),this.$filesActions.find("[action-id=cut]").prop("disabled",!e||!u||n||this.isDeletedUserSection),this.$filesActions.find("[action-id=history]").prop("disabled",!e||!c||n),this.$filesActions.find("[action-id=print]").prop("disabled",!e||!d||n),this.$filesActions.find("[action-id=saveAsPdf]").prop("disabled",!e||!p||n),this.$filesActions.find("[action-id=send]").prop("disabled",!e||!m||n),this.$filesActions.find("[action-id=export]").prop("disabled",!e||!v||n),this.$filesActions.find("[action-id=openExternal]").prop("disabled",!e||i||n||this.isDeletedUserSection),this.$filesActions.find("[action-id=attach-to-task]").prop("disabled",!e||!w),this.$container.find("[data-action=new-note]").prop("disabled",!e||this.isDeletedUserSection);var g="parent"!=s&&!l,b=this.$filesActions.find("[action-id=delete]");b.parent().toggleClass("selection-not-fully-deletable",g),b.toggleClass("selection-fully-deletable",!g),b.data("orig-title-text")||b.data("orig-title-text",b.attr("title")),b.attr("title",g?"":b.data("orig-title-text")),this.scrollViewIfNeeded()},t.prototype.areAllElements=function(e,t){for(var n=t.length-1;n>=0;--n)if(!t.eq(n).data(e))return!1;return!0},t.prototype.onFileEntryClick=function(e){var n=this,i=s.JQuery(e.target).closest("[data-id]"),o=i.data("id");if(e.ctrlKey)this.triggerEvent("ctrlClickFile",o);else if(e.shiftKey){var a=[],l=this.$filesList.find(".active"),r=l.parent().children(),c=r.index(l),d=r.index(i);if(c>d){var p=c;c=d,d=p}for(var f=c;f<=d;++f)a.push(r.eq(f).data("id"));this.triggerEvent("selectEntries",JSON.stringify(a),o)}else this.triggerEvent("setActiveFile",o);this.lastClickTid&&this.lastClickId==o?(clearTimeout(this.lastClickTid),this.lastClickTid=null,this.lastClickId=null,this.triggerEvent("fileAction","openExternal")):(this.lastClickId=o,this.lastClickTid=setTimeout((function(){n.lastClickTid=null,n.lastClickId=null}),t.DOUBLE_CLICK_TIME))},t.prototype.onResize=function(){this.$filesList&&(this.$filesList.toggleClass("narrow",this.$filesList.outerWidth()<300),this.asFileChooser?this.$filesList.children(".files-container").css("bottom","0"):this.$filesList.children(".files-container").css("bottom",this.$filesList.children(".files-actions-container").outerHeight()+"px"))},t.prototype.onFileActionClick=function(e){var t=s.JQuery(e.target).closest("[action-id]").attr("action-id");this.triggerEvent("fileAction",t)},t.prototype.onToggleViewModeClick=function(){this.updateViewMode("table"==this.viewMode?"tiles":"table"),this.triggerEvent("viewModeChanged",this.viewMode)},t.prototype.onMarkAllAsReadClick=function(e){e.stopPropagation(),e.currentTarget.classList.contains("disabled")||(this.triggerEvent("markAllAsRead"),this.$settingsMenu.removeClass("visible"))},t.prototype.onExportAllFilesClick=function(e){e.stopPropagation(),e.currentTarget.classList.contains("disabled")||(this.triggerEvent("fileAction","exportFiles"),this.$settingsMenu.removeClass("visible"))},t.prototype.onImportFilesClick=function(e){e.stopPropagation(),e.currentTarget.classList.contains("disabled")||(this.triggerEvent("fileAction","importFiles"),this.$settingsMenu.removeClass("visible"))},t.prototype.onEmptyTrashClick=function(e){e.stopPropagation(),e.currentTarget.classList.contains("disabled")||(this.triggerEvent("fileAction","empty-trash"),this.$settingsMenu.removeClass("visible"))},t.prototype.onAddDirToPlaylistClick=function(e){e.stopPropagation(),e.currentTarget.classList.contains("disabled")||(this.triggerEvent("addDirToPlaylist"),this.$settingsMenu.removeClass("visible"))},t.prototype.updateViewMode=function(e){this.viewMode=e,this.$filesList.toggleClass("view-mode-table","table"==e),this.$filesList.toggleClass("view-mode-tiles","tiles"==e),this.$container.find("[data-action=toggle-view-mode] i.fa").toggleClass("fa-align-justify","tiles"==e),this.$container.find("[data-action=toggle-view-mode] i.fa").toggleClass("fa-th","table"==e),this.updateSplitFileNames()},t.prototype.updateSplitFileNames=function(){var e=this;this.$filesList.find(".file-name-text").each((function(t,n){var i=s.JQuery(n);if(0==i.children().length){var o=i.text().trim(),a=o.substr(0,14),l=o.substr(14,Math.max(0,o.length-14-8)),r=o.substr(a.length+l.length);l.length<=3&&(a+=l,l="");var c='<span class="first">'+e.parent.helper.escapeHtml(a)+"</span>";c+='<span class="middle">'+e.parent.helper.escapeHtml(l)+"</span>",c+='<span class="dots">'+(0==l.length?"":"...")+"</span>",c+='<span class="last">'+e.parent.helper.escapeHtml(r)+"</span>",i.html(c),i.attr("title",o)}}))},t.prototype.updateSettingsMenu=function(){var e=this.$container.find(".file-entry"),t=this.$container.find(".context-menu-settings").find(".context-menu-settings-content").children("li");t.filter("[data-action=empty-trash]").toggleClass("disabled",0==e.length),t.filter("[data-action=mark-all-as-read]").toggleClass("disabled",0==e.filter(".unread").length),t.filter("[data-action=export-files]").toggleClass("disabled",0==e.length),t.filter("[data-action=add-dir-to-playlist]").toggleClass("disabled",0==e.find(".fa-music").length),t.filter("[data-action=import-files]").toggleClass("hide",this.model.isAll||this.model.isTrash||this.model.isLocal),t.filter("[action-id=show-hidden-files]").toggleClass("hide",0==this.model.isLocal)},t.prototype.getRowSize=function(){var e=this.$filesList.find("tr"),t=e.length;return e.each((function(e,n){if(e>0&&s.JQuery(n).position().left<10)return t=e,!1})),Math.max(1,t)},t.prototype.onClipboardChange=function(e){this.$filesActions.find(".action-item[action-id='paste']").prop("disabled",!e)},t.prototype.onMoveCursorUp=function(){this.triggerEvent("moveCursorUp")},t.prototype.onMoveCursorDown=function(){this.triggerEvent("moveCursorDown")},t.prototype.scrollViewIfNeeded=function(){var e=this.files.$container.find(".file-entry.active");if(0!=e.length){var t=e.closest(".files-container .pf-content")[0],n=t.getBoundingClientRect(),i=e[0].getBoundingClientRect();i.top<n.top?t.scrollTop+=i.top-n.top:i.bottom>n.bottom&&(t.scrollTop+=i.bottom-n.bottom)}},t.prototype.onNewNoteClick=function(){if(this.editable){var e={items:[{id:"new-text-note-window",labelKey:"plugin.notes2.component.filesList.newTextNote.title",icon:"fa fa-font"},{id:"new-mindmap-window",labelKey:"plugin.notes2.component.filesList.newMindmap.title",icon:"privmx-icon privmx-icon-mindmap"},{id:"new-audioAndVideo-note-window",labelKey:"plugin.notes2.component.filesList.newAudioAndVideoNote.title",icon:"fa fa-file-video-o"},{id:"new-audio-note-window",labelKey:"plugin.notes2.component.filesList.newAudioNote.title",icon:"fa fa-file-audio-o"},{id:"new-photo-note-window",labelKey:"plugin.notes2.component.filesList.newPhotoNote.title",icon:"fa fa-file-photo-o"},{isSeparator:!0},{id:"new-directory",labelKey:"plugin.notes2.component.filesList.newDirectory.title",icon:"fa fa-folder-o",hidden:this.isAll},{isSeparator:!0,hidden:this.isLocal},{id:"upload",labelKey:this.systemLabel?"plugin.notes2.component.filesList.actions.upload.osSpecific."+this.systemLabel:"plugin.notes2.component.filesList.actions.upload",icon:"fa fa-upload",hidden:this.isLocal}]};this.dropdown=new s.component.dropdown.Dropdown({model:e,template:this.templateManager.createTemplate(d.func),$container:this.$container.find(".button-container"),templateManager:this.templateManager}),this.$container.find(".component-dropdown").css("margin-left","-133px"),this.$container.find(".component-dropdown").addClass("to-right")}else this.triggerEventInTheSameTick("menuAction","upload")},t.prototype.onActionsMenuClick=function(e){e.stopPropagation();var t=s.JQuery(e.target).closest("[data-action-id]").data("action-id");this.dropdown&&(this.dropdown.destroy(),this.dropdown=null),this.triggerEventInTheSameTick("menuAction",t)},t.prototype.onOpenSettingsClick=function(e){var t=s.JQuery(e.currentTarget);this.$settingsMenu.addClass("visible");var n=t.offset().left+t.outerWidth()/2-this.$settingsMenu.find(".context-menu-settings-content").outerWidth(),i=t.offset().top+t.outerHeight();this.$settingsMenu.css("left",n).css("top",i)},t.prototype.onCloseSettingsClick=function(){this.$settingsMenu.removeClass("visible")},t.prototype.onSettingClick=function(e){var t=s.JQuery(e.currentTarget).data("setting");this.triggerEvent("toggleSetting",t)},t.prototype.refreshPath=function(e){var t=this.$container.find(".files-header"),n=t.find(".current-path");this.isTrash&&e&&0==e.indexOf(p.FilesConst.TRASH_PATH)&&(e=e.substr(7));var i=!!e&&"/"!=e;t.toggleClass("with-path",i),n.toggleClass("hide",!i),this.parent.elementEllipsis(n,e,!0)},t.prototype.onTaskClick=function(e){if(!s.JQuery.contains(this.taskChooser.$main[0],e.target)){var t=s.JQuery(e.target),n=t.closest("[data-task-id]").data("task-id"),i=t.closest("[data-id]").data("id");this.taskChooser.movePopup(e.pageX,e.pageY,300,150),this.triggerEvent("openTask",i,n)}},t.prototype.onKeydown=function(e){if(!this.taskChooser.$main.hasClass("visible")){var n=this.getRowSize(),i=this.viewMode,o=t.getSelectionChangeMode(e.shiftKey,e.altKey);e.keyCode===s.webUtils.KEY_CODES.upArrow?(e.preventDefault(),this.triggerEvent("fileAction","up",i,n,o)):e.keyCode===s.webUtils.KEY_CODES.downArrow?(e.preventDefault(),this.triggerEvent("fileAction","down",i,n,o)):e.keyCode===s.webUtils.KEY_CODES.leftArrow?(e.preventDefault(),this.triggerEvent("fileAction","left",i,n,o)):e.keyCode===s.webUtils.KEY_CODES.rightArrow?(e.preventDefault(),this.triggerEvent("fileAction","right",i,n,o)):e.keyCode===s.webUtils.KEY_CODES.enter?(e.preventDefault(),this.triggerEvent("fileAction","openExternal")):e.keyCode===s.webUtils.KEY_CODES.backspace?(e.preventDefault(),this.triggerEvent("fileAction","goToRoot")):e.keyCode==s.webUtils.KEY_CODES.c&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),e.stopImmediatePropagation(),this.triggerEvent("fileAction","copy")):e.keyCode==s.webUtils.KEY_CODES.v&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),e.stopImmediatePropagation(),this.triggerEvent("fileAction","paste")):e.keyCode==s.webUtils.KEY_CODES.x&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),e.stopImmediatePropagation(),this.triggerEvent("fileAction","cut")):e.keyCode==s.webUtils.KEY_CODES.f2?(e.preventDefault(),this.triggerEvent("fileAction","rename")):e.keyCode==s.webUtils.KEY_CODES.delete?(e.preventDefault(),this.triggerEvent("fileAction","delete")):e.keyCode==s.webUtils.KEY_CODES.f7?(e.preventDefault(),this.triggerEvent("fileAction","exportFiles")):e.keyCode==s.webUtils.KEY_CODES.f8?(e.preventDefault(),this.triggerEvent("fileAction","history")):e.keyCode==s.webUtils.KEY_CODES.f9?(e.preventDefault(),this.triggerEvent("fileAction","export")):e.keyCode==s.webUtils.KEY_CODES.f5&&(e.preventDefault(),this.triggerEvent("fileAction","refresh"))}},t.prototype.updateSetting=function(e,t){this.$filesList.find("[data-setting='"+e+"']").find("input[type=checkbox]").prop("checked",t)},t.prototype.setSelectedIds=function(e){this.selectedFileIds=JSON.parse(e),this.$filesList.find(".file-entry.selected").removeClass("selected"),this.addSelectedItemClasses()},t.prototype.addSelectedItemClasses=function(){for(var e=this.$filesList.find(".file-entry"),t={},n=e.length-1;n>=0;--n){t[(s=e.eq(n)).data("id")]=s}for(var i=0,o=this.selectedFileIds;i<o.length;i++){var s;(s=t[o[i]])&&s.addClass("selected")}this.updateButtonsState()},t.prototype.updateCustomSectionName=function(e){},t.prototype.refreshConvHeader=function(){var e=this.templateManager.createTemplate(s.component.template.conversation);this.$container.find(".files-header")[0].innerHTML=this.templateManager.createTemplate(l.func).renderToJQ(this.model,e)[0].querySelector(".files-header").innerHTML,this.personsComponent.refreshAvatars()},t.prototype.onAddPersonClick=function(e){s.JQuery(e.currentTarget).is("button.disabled")||this.triggerEvent("addPerson")},t.prototype.onRemovePersonClick=function(e){var t=s.JQuery(e.currentTarget).data("hashmail")||s.JQuery(e.currentTarget).data("hashmail-image");this.triggerEvent("removePerson",t)},t.getSelectionChangeMode=function(e,t){return e?t?p.SelectionChangeMode.SHRINK:p.SelectionChangeMode.EXTEND:p.SelectionChangeMode.CHANGE},t.prototype.updateLockInfoOnActionButtons=function(e,t){var n=e&&t;this.$filesActions.find("[action-id=unlock]").toggleClass("hide",!n),this.$filesActions.find("[action-id=lock]").toggleClass("hide",e)},t.prototype.hideLockUnlockButtons=function(){this.$filesActions.find("[action-id=unlock]").toggleClass("hide",!0),this.$filesActions.find("[action-id=lock]").toggleClass("hide",!0)},t.DOUBLE_CLICK_TIME=400,t}(s.component.base.ComponentView);n.FilesListView=f,f.prototype.className="com.privmx.plugin.notes2.component.fileslist.FilesListView"},{"../../main/Common":10,"./template/actions-menu.html":4,"./template/file-entry.html":5,"./template/files-actions.html":6,"./template/files-list-empty.html":7,"./template/files-list.html":8,"pmc-web":1}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('<div class="actions-menu actions-list">\n  '),e.items.forEach((function(e){e.hidden||(o("\n    "),e.isSeparator?o('\n          <div class="separator"></div>\n        '):(o('\n    <div class="action" data-action-id="'),o(n.escapeHtml(e.id)),o('">\n      '),e.icon&&(o('\n        <span class="ico '),o(n.escapeHtml(e.icon)),o('"></span>\n      ')),o('\n      <span class="holder">\n        '),o(n.escapeHtml(n.i18n(e.labelKey))),o("\n      </span>\n    </div>\n  ")))})),o("\n</div>\n"),i}}},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};o('\n<tr class="file-entry '),o(n.escapeHtml(t.isActive?"active":"")),o(" "),o(n.escapeHtml(e.unread?"unread":"")),o(" "),o(n.escapeHtml(e.locked?"locked":"")),o('" data-type="'),o(n.escapeHtml(e.type)),o('" data-deletable="'),o(n.escapeHtml(e.deletable)),o('" data-renamable="'),o(n.escapeHtml(e.renamable)),o('" data-hashistory="'),o(n.escapeHtml(e.hasHistory)),o('" data-printable="'),o(n.escapeHtml(e.printable)),o('" data-cansaveaspdf="'),o(n.escapeHtml(e.canSaveAsPdf)),o('" data-id="'),o(n.escapeHtml(e.id)),o('" data-isparentdir="'),o(n.escapeHtml(e.isParentDir)),o('">\n  <td class="unread-marker"></td>\n  <td class="file-name">\n    <i class="fa '),o(n.escapeHtml(e.icon)),o('"></i>\n    ');var s=e.bindedTasksStr?JSON.parse(e.bindedTasksStr):[];o("\n    ");var a=s[0];if(o("\n    "),a){var l=a.labelClass||"task-status-unknown",r=a.taskId,c="#"+(r.indexOf(",")<0?r.substr(0,5):"...");o('\n        <span class="task-id task-label has-task-tooltip '),o(n.escapeHtml(l)),o('" data-task-id="'),o(n.escapeHtml(a.taskId)),o('">'),o(n.escapeHtml(c)),o("</span>\n      ")}return o('\n    <span class="locked-indicator">\n      <i class="fa fa-lock has-userslist-tooltip" data-userslist-id="'),o(n.escapeHtml(e.id)),o('"></i>\n    </span>\n    <span class="file-name-text">\n      '),o(n.escapeHtml(e.name)),o('\n    </span>\n  </td>\n  <td class="file-size">\n    '),"file"==e.type&&(o("\n      "),o(n.escapeHtml(n.bytesSize(e.size))),o("\n    ")),o('\n  </td>\n  <td class="file-mod-date '),o(n.escapeHtml("file"==e.type&&e.modifier?"":"no-modifier")),o('">\n    '),"file"==e.type&&e.modifier&&(o('\n      <canvas class="not-rendered" data-tooltip-trigger="'),o(n.escapeHtml(e.modifier)),o('" data-hashmail-image="'),o(n.escapeHtml(e.modifier)),o('" data-width="16" data-height="16" data-auto-size="true" data-auto-refresh="true" width="10" height="10"></canvas>\n    ')),o("\n    "),e.modificationDate&&(o('\n      <div class="file-date" title="'),o(n.escapeHtml(n.dateWithHourLocal(e.modificationDate))),o('" data-timeago-type="calendarDate" data-timeago="'),o(n.escapeHtml(e.modificationDate)),o('">\n        '),o(n.escapeHtml(n.calendarDate(e.modificationDate))),o("\n      </div>\n    ")),o("\n  </td>\n</tr>\n"),i}}},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('<div class="center buttons-columns">\n  <div class="col-left">\n    <button class="action-item btn btn-default btn-sm small gray" action-id="copy" title="'),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.copy"))),o(' Ctrl-C">\n      <i class="fa fa-copy"></i>\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.copy"))),o('\n    </button>\n    <button class="action-item btn btn-default btn-sm small gray" action-id="cut" title="'),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.cut"))),o(' Ctrl-X" '),o(e.editable?"":'disabled="disabled"'),o('>\n      <i class="fa fa-cut"></i>\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.cut"))),o('\n    </button>\n    <button class="action-item btn btn-default btn-sm small gray" action-id="paste" title="'),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.paste"))),o(' Ctrl-V" '),o(e.clipboard?"":'disabled="disabled"'),o('>\n      <i class="fa fa-paste"></i>\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.paste"))),o('\n    </button>\n  </div>\n  <div class="col-mid">\n    <button class="action-item btn btn-default btn-sm small gray" action-id="rename" title="'),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.rename"))),o(' F2" '),o(e.isTrash||e.editable?"":'disabled="disabled"'),o('>\n      <i class="fa fa-pencil"></i>\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.rename"))),o('\n    </button>\n    <span class="delete-button-wrapper has-basic-tooltip" data-basic-id="delete">\n      <button class="action-item btn btn-default btn-sm small gray" action-id="delete" title="'),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.delete"))),o(' DEL" '),o(e.editable?"":'disabled="disabled"'),o('>\n        <span class="ico-bin"></span>\n        '),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.delete"))),o('\n      </button>\n    </span>\n    <button class="action-item btn btn-default btn-sm small gray" action-id="send" title="'),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.send"))),o('">\n      <span class="left ico-paper-airplane"></span>\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.send"))),o('\n    </button>\n    <button class="action-item btn btn-default btn-sm small gray" data-window-opener="true" action-id="export" title="'),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.export"))),o(' F9">\n      <i class="fa fa-download"></i>\n      '),e.systemLabel?(o("\n        "),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.export.osSpecific",e.systemLabel))),o("\n      ")):(o("\n        "),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.export"))),o("\n      ")),o('\n    </button>\n\n  </div>\n  <div class="col-right">\n    <button class="action-item btn btn-default btn-sm small gray" action-id="openExternal" title="'),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.open.tooltip"))),o('">\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.open"))),o('\n    </button>\n    <button class="action-item btn btn-default btn-sm small gray" data-window-opener="true" action-id="history" title="'),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.history"))),o(' F8">\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.history"))),o('\n    </button>\n    <button class="action-item btn btn-default btn-sm small gray hide" action-id="lock" title="'),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.lock"))),o('" '),o(e.editable?"":'disabled="disabled"'),o(">\n      "),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.lock"))),o('\n    </button>\n    <button class="action-item btn btn-default btn-sm small gray hide" action-id="unlock" title="'),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.unlock"))),o('" '),o(e.editable?"":'disabled="disabled"'),o(">\n      "),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.unlock"))),o('\n    </button>\n    <button class="action-item btn btn-default btn-sm small gray" action-id="attach-to-task" title="'),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.attachToTask"))),o('">\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.actions.attachToTask"))),o("\n    </button>\n  </div>\n</div>\n"),i}}},{}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('<div class="empty-info table-layout">\n  <div class="inner-1">\n    <div class="inner-2">\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.files.empty"))),o("\n    </div>\n  </div>\n</div>"),i}}},{}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./user-profile.html");n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var o="",s=function(e){o+=e};if(s('<div class="files-list'),s(n.escapeHtml("trash"==e.id?" trash":"")),s('">\n  <div class="files-header '),s(n.escapeHtml(0==e.id.indexOf("conversation")?"is-conversation":"")),s('">\n    <div class="current-path"></div>\n    <div class="current-root">\n      '),"my"==e.id&&(s('\n        <div class="inner">\n          <li class="conversation-element contact without-description" data-conversation-id="'),s(n.escapeHtml(e.hashmail)),s('">\n            <span>\n              <div class="image-with-data">\n                <p class="image">\n                  <canvas class="not-rendered" data-tooltip-trigger="'),s(n.escapeHtml(e.hashmail)),s('" data-hashmail-image="'),s(n.escapeHtml(e.hashmail)),s('" data-width="30" data-height="30" data-auto-size="true" data-auto-refresh="true" width="30" height="30"></canvas>\n                </p>\n                <div class="text-col">\n                  <p class="name">\n                    '),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.filter.my"))),s('\n                  </p>\n                </div>\n              </div>\n            </span>\n          </li>\n          <div class="go-to-modules" style="display:none;">\n            '),e.hasChat&&s('\n              <span class="btn btn-sm go-to-chat" data-action="open-chat" data-window-opener="true">\n                <i class="ico-comment"></i>\n              </span>\n            '),s("\n            "),e.hasTasks&&s('\n              <span class="btn btn-sm go-to-tasks" data-action="open-tasks" data-window-opener="true">\n                <i class="fa fa-tasks"></i>\n              </span>\n            '),s("\n          </div>\n        </div>\n      ")),s("\n      "),"all"==e.id&&(s('\n        <div class="inner">\n          <div class="wi-element">\n            <div class="wi-element-inner">\n              <div class="wi-element-icon bckg-icon bckg-icon-inverse2 small-icon">\n                <i class="fa fa-file-o"></i>\n              </div>\n              <div class="wi-element-name">\n                '),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.filter.all"))),s('\n              </div>\n            </div>\n          </div>\n          <div class="go-to-modules" style="display:none;">\n            '),e.hasChat&&s('\n              <span class="btn btn-sm go-to-chat" data-action="open-chat" data-window-opener="true">\n                <i class="ico-comment"></i>\n              </span>\n            '),s("\n            "),e.hasTasks&&s('\n              <span class="btn btn-sm go-to-tasks" data-action="open-tasks" data-window-opener="true">\n                <i class="fa fa-tasks"></i>\n              </span>\n            '),s("\n          </div>\n        </div>\n      ")),s("\n      "),"local"==e.id&&(s('\n        <div class="inner">\n          <div class="wi-element">\n            <div class="wi-element-inner">\n              <div class="wi-element-icon bckg-icon bckg-icon-inverse2 small-icon">\n                <i class="fa fa-desktop"></i>\n              </div>\n              <div class="wi-element-name">\n                '),s(n.escapeHtml(e.computerLocalName)),s("\n              </div>\n            </div>\n          </div>\n        </div>\n      ")),s("\n      "),"trash"==e.id&&(s('\n        <div class="inner">\n          <div class="wi-element">\n            <div class="wi-element-inner">\n              <div class="wi-element-icon bckg-icon bckg-icon-inverse2 small-icon">\n                <i class="fa ico-bin"></i>\n              </div>\n              <div class="wi-element-name">\n                '),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.filter.trash"))),s("\n              </div>\n            </div>\n          </div>\n        </div>\n      ")),s("\n      "),0==e.id.indexOf("channel")||0==e.id.indexOf("conversation")){if(s('\n        <div class="inner">\n        '),0==e.id.indexOf("channel")&&(s('\n            <div class="wi-element">\n              <div class="wi-element-inner">\n                <div class="wi-element-icon bckg-icon bckg-icon-inverse2 '),s(n.escapeHtml("private"==e.channelScope?"bckg-icon-border":"")),s(' has-section-tooltip" data-section-id="'),s(n.escapeHtml(e.id.substr(e.id.indexOf("/")+1))),s('">\n                  <img src="'),s(n.escapeHtml(n.getAssetByName("DEFAULT_PRIVMX_ICON"))),s('" />\n                </div>\n                <div class="wi-element-name">\n                  '),s(n.escapeHtml(e.channelName)),s('\n                </div>\n              </div>\n            </div>\n            <div class="wi-element compact-summary-view">\n              <div class="wi-element-inner">\n                <div class="wi-element-icon">\n                  <span class="ico-note"></span>\n                </div>\n                <div class="wi-element-name">\n                  '),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.title"))),s("\n                </div>\n              </div>\n            </div>\n        ")),s("\n        "),0==e.id.indexOf("conversation")){var a=n.createTemplate(i.func);1==e.persons.length?(s('\n            <div class="single-contact">\n              '),s(a.render(e.persons[0],{truncateDescription:!1})),s("\n            </div>\n          ")):(s('\n          <div class="many-profiles">\n            '),e.persons.forEach((function(e){s("\n              "),s(a.render(e,{truncateDescription:!0})),s("\n            ")})),s("\n          </div>\n          ")),s('\n            <button class="btn btn-success btn-sm small in-summary-as-icon" data-action="add-person" title="'),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.add-user.title"))),s('">\n              <i class="fa fa-user-plus"></i>\n            </button>\n          ')}s('\n        <div class="go-to-modules" style="display:none;">\n          '),e.hasChat&&s('\n            <span class="btn btn-sm go-to-chat" data-action="open-chat" data-window-opener="true">\n              <i class="ico-comment"></i>\n            </span>\n          '),s("\n          "),e.hasTasks&&s('\n            <span class="btn btn-sm go-to-tasks" data-action="open-tasks" data-window-opener="true">\n              <i class="fa fa-tasks"></i>\n            </span>\n          '),s("\n        </div>\n      </div>\n    ")}return s('\n    </div>\n    <div class="button-container">\n      <button class="btn btn-xs btn-default view-mode" action-id="toggle-view-mode" data-action="toggle-view-mode" title="'),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.buttonViewModeTooltip"))),s('">\n        <i class="fa fa-th"></i>\n      </button>\n      \n      <button class="btn btn-xs btn-default refresh" action-id="refresh" data-action="refresh" title="'),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.buttonRefreshTooltip"))),s('">\n        <i class="fa fa-refresh"></i>\n      </button>\n      \n      <button class="btn btn-xs btn-default settings" data-action="open-settings" title="'),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.buttonSettingsTooltip"))),s('">\n        <i class="ico-settings"></i>\n      </button>\n\n      '),e.isTrash||e.isAll&&e.hasNoPrivateSection||e.isDeletedUserSection||(s('\n        <button class="btn btn-success btn-sm small" data-action="new-note" data-window-opener="true" title="'),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.button.new.title"))),s('">\n          <i class="fa fa-plus"></i>\n          <span>'),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.button.new.label"))),s("</span>\n        </button>\n      ")),s('\n    </div>\n  </div>\n  <div class="files-container '),s(n.escapeHtml("my"==e.id?"no-modifiers":"")),s('">\n      <table>\n          <thead></thead>\n          <tbody>\n          </tbody>\n      </table>\n  </div>\n  <div class="files-actions-container">\n  </div>\n  <div class="context-menu-settings">\n    <div class="context-menu-backdrop2"></div>\n    <ul class="context-menu-settings-content">\n      <li class="with-icon" action-id="mark-all-as-read" data-action="mark-all-as-read">\n        <span>\n          <i class="fa fa-check"></i><span></span>'),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.settings.markAllAsRead"))),s('</span>\n        </span>\n      </li>\n      <li class="with-icon" action-id="export-files" data-action="export-files">\n        <span>\n          <i class="fa fa-download"></i><span>'),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.settings.exportFiles"))),s("</span>\n        </span>\n      </li>\n\n      "),e.isTrash&&(s('\n        <li class="with-icon" action-id="empty-trash" data-action="empty-trash">\n          <span>\n            <i class="fa ico-bin"></i><span>'),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.settings.emptyTrash"))),s("</span>\n          </span>\n        </li>\n      ")),s('\n      \x3c!--<li class="with-icon" action-id="add-dir-to-playlist" data-action="add-dir-to-playlist">\n        <span>\n          <i class="fa fa-music"></i><span></span>'),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.settings.addDirToPlaylist"))),s('</span>\n        </span>\n      </li>--\x3e\n      <li class="context-menu-group-header">'),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.settings.header.viewOptions"))),s('</li>\n      <li action-id="show-file-preview" data-setting="show-file-preview">\n        <span>\n          <input type="checkbox" '),s(n.escapeHtml(e.showFilePreview?"checked":"")),s(" />\n          <span>\n            "),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.settings.showFilePreview"))),s('\n          </span>\n        </span>\n      </li>\n      <li action-id="show-url-files" data-setting="show-url-files">\n        <span>\n          <input type="checkbox" '),s(n.escapeHtml(e.showUrlFiles?"checked":"")),s(" />\n          <span>\n            "),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.settings.showUrlFiles"))),s('\n          </span>\n        </span>\n      </li>\n      <li action-id="show-hidden-files" data-setting="show-hidden-files">\n        <span>\n          <input type="checkbox" '),s(n.escapeHtml(e.showHiddenFiles?"checked":"")),s(" />\n          <span>\n            "),s(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.settings.showHiddenFiles"))),s("\n          </span>\n        </span>\n      </li>\n    </ul>\n  </div>\n</div>\n"),o}}},{"./user-profile.html":9}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e},s=n.shortDescription(e.description)||"",a=!!t&&!!t.truncateDescription,l=t&&t.canvasSize?t.canvasSize:30;return o('\n    <div class="user-profile '),o(n.escapeHtml(s?"with-description":"")),o(" "),o(n.escapeHtml(e.present?"present":"")),o(" "),o(n.escapeHtml(a?"truncate-description":"")),o(" "),o(n.escapeHtml(e.deleted?"deleted":"")),o('" data-hashmail-profile="'),o(n.escapeHtml(e.hashmail)),o('" data-description-indicator="true">\n      <div class="image-with-data">\n        <p class="image" data-tooltip-trigger="'),o(n.escapeHtml(e.hashmail)),o('">\n          <canvas class="not-rendered" data-hashmail-image="'),o(n.escapeHtml(e.hashmail)),o('" data-width="'),o(n.escapeHtml(l)),o('" data-height="'),o(n.escapeHtml(l)),o('" data-auto-size="true" data-auto-refresh="true"></canvas>\n        </p>\n        <div class="text-col">\n          <p class="name" data-hashmail-name="'),o(n.escapeHtml(e.hashmail)),o('" data-auto-refresh="true">\n            '),o(n.escapeHtml(e.name||e.username)),o('\n          </p>\n          <p class="desc" data-hashmail-short-description="'),o(n.escapeHtml(e.hashmail)),o('" data-max-length="'),o('" data-auto-refresh="true">\n            '),o(n.escapeHtml(s&&a?n.truncate(s,25):s)),o('\n          </p>\n        </div>\n      </div>\n      <div class="remove-person-button" data-action="remove-person" data-hashmail="'),o(n.escapeHtml(e.hashmail)),o('" title="'),o(n.escapeHtml(n.i18n("plugin.notes2.component.filesList.remove-user.title"))),o('"><i class="fa fa-minus"></i></div>\n    </div>\n  '),o("\n"),i}}},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.FILE_OVERWRITE=0]="FILE_OVERWRITE",e[e.DIRECTORIES_MERGE=1]="DIRECTORIES_MERGE",e[e.DIRECTORY_OVERWRITE_BY_FILE=2]="DIRECTORY_OVERWRITE_BY_FILE",e[e.FILE_OVERWRITE_BY_DIRECTORY=3]="FILE_OVERWRITE_BY_DIRECTORY"}(n.ConflictType||(n.ConflictType={})),function(e){e[e.MOVE=0]="MOVE",e[e.COPY=1]="COPY",e[e.REMOVE=2]="REMOVE"}(n.OperationType||(n.OperationType={}));var i=function(){function e(){}return e.TRASH_ENTRY=".trash",e.TRASH_PATH="/"+e.TRASH_ENTRY,e}();n.FilesConst=i,function(e){e.Global="global",e.Notes2Window="notes2",e.SummaryWindow="summary",e.FileChooser="filechooser"}(n.ViewContext||(n.ViewContext={})),function(e){e[e.CHANGE=0]="CHANGE",e[e.EXTEND=1]="EXTEND",e[e.SHRINK=2]="SHRINK"}(n.SelectionChangeMode||(n.SelectionChangeMode={})),i.prototype.className="com.privmx.plugin.notes2.main.FilesConst"},{}],11:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s,a=e("./template/main.html"),l=e("pmc-web"),r=e("../../component/fileslist/FilesListView");l.Logger.get("main.FileChooser");!function(e){e[e.SIDEBAR=0]="SIDEBAR",e[e.FILES_LIST=1]="FILES_LIST"}(s=n.FocusedElement||(n.FocusedElement={}));var c=function(e){function t(t){var n=e.call(this,t,a.func)||this;return n.$placeholders=[],n.useAutoResizer=!0,n.lastFocusedElement=s.SIDEBAR,n.leftPanelGroups=["my-files","common-files","conversations"],n.switchToFilesListAfterActivateFiles=null,n.filesLists={},n.useAutoResizer&&(n.useAutoResizer=!!window.ResizeObserver),n.notifications=n.addComponent("notifications",new l.component.notification.NotificationView(n,{xs:!0})),n.personsComponent=n.addComponent("personsComponent",new l.component.persons.PersonsView(n,n.helper)),n.personTooltip=new l.component.persontooltip.PersonTooltipView(n.templateManager,n.personsComponent),n.sectionTooltip=n.addComponent("sectiontooltip",new l.component.sectiontooltip.SectionTooltipView(n)),n.sidebar=n.addComponent("sidebar",new l.component.sidebar.SidebarView(n,{conv2List:{personsView:n.personsComponent,extList:{template:null}},conv2Splitter:null,customElementList:{extList:{template:null,onAfterListRender:n.onAfterRenderCustomList.bind(n)}},sectionList:{extList:{template:null}},customSectionList:{extList:{template:null}}})),n}return o(t,e),t.prototype.onAfterRenderCustomList=function(){this.personsComponent.refreshAvatars()},t.prototype.initWindow=function(e){var t,n=this;return this.$main.on("click","[data-action=close]",this.onCloseClick.bind(this)),this.$main.on("click","[data-action=select]",this.onOkClick.bind(this)),this.$modulesContainer=this.$main.find(".modules-container"),document.addEventListener("blur",(function(){clearTimeout(t),t=setTimeout((function(){var e=n.getFocusedElement();null!=e&&(n.lastFocusedElement=e)}),1)}),!0),document.addEventListener("focus",(function(){clearTimeout(t);var e=n.getFocusedElementFromEl(l.JQuery(document.activeElement));null!=e&&(n.lastFocusedElement=e)}),!0),l.Q().then((function(){return n.turnTimeAgoRefresher(),n.$body.on("keydown",n.onKeydown.bind(n)),n.personsComponent.$main=n.$main,n.personTooltip.init(n.$main),n.personsComponent.triggerInit()})).then((function(){return n.splitter=n.addComponent("splitter",new l.component.splitter.SplitterView(n,{type:"vertical",handlePlacement:"right"})),n.splitter.$container=n.$modulesContainer,n.splitter.triggerInit()})).then((function(){n.$listsContainer=l.JQuery("<div class='lists-container'></div>"),n.splitter.$right.empty().append(n.$listsContainer),n.splitter.$left.addClass("sidebar-container")})).then((function(){return n.sidebar.$container=n.splitter.$left,n.sidebar.triggerInit()})).then((function(){n.$modulesContainer.on("click",".action-item[action-id=select]",n.onFileSelectClick.bind(n))}))},t.prototype.createFilesList=function(e){var t=this;return l.Q().then((function(){t.filesLists[e]=t.addComponent(e,new r.FilesListView(t,t.personsComponent));var n=l.JQuery("<div class='notes2-fileslist-component' data-list-id='"+e+"'></div>");return t.$listsContainer.append(n),t.filesLists[e].$container=n,t.filesLists[e].triggerInit()}))},t.prototype.customizeActions=function(e){},t.prototype.onFileSelectClick=function(){this.triggerEvent("select")},t.prototype.setName=function(e){this.$main.find(".name .text").html(e)},t.prototype.onCloseClick=function(){this.triggerEvent("close")},t.prototype.onOkClick=function(){this.triggerEvent("select")},t.prototype.focus=function(){this.getFocusedElementOrDefault()},t.prototype.refreshFocus=function(){var e=this.getFocusedElement();e==s.FILES_LIST?l.JQuery(document.activeElement).closest(".files-list-container").get(0)!=this.active.$container.get(0)&&this.active.$container.focus():null==e&&this.sidebar.$container.focus()},t.prototype.getFocusedElementFromEl=function(e){return e.closest(".sidebar-container").length>0?s.SIDEBAR:e.closest(".lists-container").length>0?s.FILES_LIST:null},t.prototype.getFocusedElement=function(){return this.getFocusedElementFromEl(l.JQuery(document.activeElement))},t.prototype.getFocusedElementOrDefault=function(){var e=this.getFocusedElement();return null==e?null==this.lastFocusedElement?s.SIDEBAR:this.lastFocusedElement:e},t.prototype.onKeydown=function(e){if(e.keyCode!=l.webUtils.KEY_CODES.tab||e.ctrlKey||e.metaKey)e.keyCode==l.webUtils.KEY_CODES.escape?this.onCloseClick():document.activeElement==document.body?this.lastFocusedElement==s.SIDEBAR?(this.sidebar.onKeydown(e),this.sidebar.$container.focus()):this.lastFocusedElement==s.FILES_LIST&&(this.active.onKeydown(e),this.active.$container.focus()):!e.ctrlKey&&!e.metaKey||e.keyCode!=l.webUtils.KEY_CODES.c&&e.keyCode!=l.webUtils.KEY_CODES.v&&e.keyCode!=l.webUtils.KEY_CODES.x||0!=l.JQuery(e.target).closest(".section-files").length||this.lastFocusedElement!=s.FILES_LIST&&this.active.onKeydown(e);else{e.preventDefault();var t=this.getFocusedElementOrDefault();e.shiftKey,t==s.SIDEBAR?this.switchToPanel(s.FILES_LIST,!0):t==s.FILES_LIST&&this.switchToPanel(s.SIDEBAR,!0)}},t.prototype.switchToPanel=function(e,t){this.$main.find(".focus-hightlight").remove();var n=l.JQuery('<div class="focus-hightlight"></div>');this.getFocusedElement()!=e&&(e==s.SIDEBAR?this.sidebar.$container.focus():e==s.FILES_LIST&&(this.splitter.$right.focus(),this.active.$container.focus())),t&&(e==s.SIDEBAR?this.splitter.$left.append(n):e==s.FILES_LIST&&this.splitter.$right.append(n)),setTimeout((function(){n.remove()}),500)},t.prototype.switchFocusToFilesList=function(e){this.active?this.switchToPanel(s.FILES_LIST,e):this.switchToFilesListAfterActivateFiles={highlight:e}},t.prototype.switchFocusToSidebar=function(e){this.switchToPanel(s.SIDEBAR,e)},t.prototype.activateFiles=function(e){var t=this;if(!(e in this.filesLists))return this.$modulesContainer.find(".lists-container").children().each((function(e,t){l.JQuery(t).toggleClass("vhidden",!0)})),this.createFilesList(e).then((function(){t.customizeActions(t.filesLists[e].$container),t.active=t.filesLists[e],t.refreshFocus(),t.switchToFilesListAfterActivateFiles&&t.switchToPanel(s.FILES_LIST,t.switchToFilesListAfterActivateFiles.highlight)}));this.customizeActions(this.filesLists[e].$container),this.$modulesContainer.find(".lists-container").children().each((function(t,n){var i=l.JQuery(n);i.toggleClass("vhidden",i.data("list-id")!=e)})),this.active=this.filesLists[e],this.refreshFocus(),this.switchToFilesListAfterActivateFiles&&this.switchToPanel(s.FILES_LIST,this.switchToFilesListAfterActivateFiles.highlight)},t.prototype.expandRemoteSectionsList=function(e,t){var n=this;this.isRemoteHostVisible(t)?this.toggleRemoteHost(t,!1):(this.sidebar.showHostLoading(t,!1),l.Q().then((function(){if(n.remoteServers||(n.remoteServers={}),!(t in n.remoteServers)){var i=n.$main.find(".host-element[data-host-id='"+t+"']");return n.remoteListsExists(t)?void 0:l.Q().then((function(){i.parent().append(l.JQuery("<div class='remote-sections' data-host-id='"+t+"'></div>")),i.parent().append(l.JQuery("<div class='remote-conversations' data-host-id='"+t+"'></div>"));var o={host:e,sectionsList:n.addComponent("remoteSectionsList-"+t,new l.component.remotesectionlist.RemoteSectionListView(n,{extList:{template:null}})),conv2List:n.addComponent("remoteConv2List-"+t,new l.component.remoteconv2list.RemoteConv2ListView(n,{personsView:n.personsComponent,extList:{template:null}}))};return o.sectionsList.sections.$container=i.parent().find(".remote-sections[data-host-id='"+t+"']"),o.conv2List.conversations.$container=i.parent().find(".remote-conversations[data-host-id='"+t+"']"),n.sidebar.remoteSectionLists[t]=o.sectionsList,n.sidebar.remoteConv2Lists[t]=o.conv2List,n.remoteServers[t]=o,l.Q.all([o.sectionsList.triggerInit(),o.conv2List.triggerInit()])}))}})).then((function(){n.toggleRemoteHost(t,!0)})))},t.prototype.toggleRemoteHost=function(e,t){var n=this.$main.find(".host-element[data-host-id='"+e+"']");n.parent().find(".remote-sections[data-host-id='"+e+"']").toggleClass("hide",!t),n.parent().find(".remote-conversations[data-host-id='"+e+"']").toggleClass("hide",!t),this.sidebar.hostList.toggleHostElementIsExpanded(e,t)},t.prototype.isRemoteHostVisible=function(e){return!this.$main.find(".host-element[data-host-id='"+e+"']").find(".fa.expanded").hasClass("hide")},t.prototype.remoteListsExists=function(e){return this.$main.find(".host-element[data-host-id='"+e+"']").parent().find(".remote-sections[data-host-id='"+e+"']").length>0},t}(l.window.base.BaseWindowView);n.FileChooserWindowView=c,c.prototype.className="com.privmx.plugin.notes2.window.filechooser.FileChooserWindowView"},{"../../component/fileslist/FilesListView":3,"./template/main.html":12,"pmc-web":1}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('<div class="window-filechooser">\n  <div class="content modules-container">\n  </div>\n  <div class="buttons">\n    <button class="btn btn-success" data-action="select">\n      <i class="fa fa-check"></i>\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.window.filechooser.select"))),o('\n    </button>\n    <button class="btn btn-default gray" data-action="close">\n      <i class=""></i>\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.window.filechooser.button.close.label"))),o("\n    </button>\n  </div>\n</div>\n"),i}}},{}],13:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s=e("pmc-web"),a=e("./template/main.html"),l=function(e){function t(t){return e.call(this,t,a.func)||this}return o(t,e),t.prototype.initWindow=function(e){this.$main.on("click","[data-action='cancel']",this.onCancelClick.bind(this)),this.$main.on("click","[data-action='omit']",this.onOmitClick.bind(this)),this.$main.on("click","[data-action='overwrite']",this.onOverwriteClick.bind(this))},t.prototype.onCancelClick=function(){this.triggerEvent("abort")},t.prototype.onOmitClick=function(){this.triggerEvent("omit",this.getForAll())},t.prototype.onOverwriteClick=function(){this.triggerEvent("overwrite",this.getForAll())},t.prototype.getForAll=function(){return this.$main.find("[data-name=forall]").is(":checked")},t}(s.window.base.BaseWindowView);n.FileConflictResolverWindowView=l,l.prototype.className="com.privmx.plugin.notes2.window.fileconflictresolver.FileConflictResolverWindowView"},{"./template/main.html":14,"pmc-web":1}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../main/Common");n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var o="",s=function(e){o+=e};return s('<div class="window-file-conflict-resolver-main" tabindex="-1">\n    <div class="header">\n        '),e.operationType==i.OperationType.MOVE?(s("\n            "),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileconflictresolver.moveConflict"))),s("\n        ")):e.operationType==i.OperationType.COPY&&(s("\n            "),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileconflictresolver.copyConflict"))),s("\n        ")),s('\n    </div>\n    <div class="info">\n        '),e.conflictType==i.ConflictType.FILE_OVERWRITE?(s("\n            "),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileconflictresolver.fileOverwrite"))),s("\n        ")):e.conflictType==i.ConflictType.DIRECTORIES_MERGE?(s("\n            "),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileconflictresolver.directoriesMerge"))),s("\n        ")):e.conflictType==i.ConflictType.DIRECTORY_OVERWRITE_BY_FILE?(s("\n            "),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileconflictresolver.directoryOverwriteByFile"))),s("\n        ")):e.conflictType==i.ConflictType.FILE_OVERWRITE_BY_DIRECTORY&&(s("\n            "),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileconflictresolver.fileOverwriteByDirectory"))),s("\n        ")),s('\n    </div>\n    <div class="file-info">\n        <div class="file-icon">\n            <i class="'),s(n.escapeHtml(e.destination.icon)),s('"></i>\n        </div>\n        <div class="file-data">\n            <div class="file-origin">\n                '),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileconflictresolver.destination"))),s('\n            </div>\n            <div class="file-name">\n                '),s(n.escapeHtml(e.destination.name)),s('\n            </div>\n            <div class="file-path">\n                '),s(n.escapeHtml(e.destination.path)),s('\n            </div>\n        </div>\n    </div>\n    <div class="file-info">\n        <div class="file-icon">\n            <i class="'),s(n.escapeHtml(e.source.icon)),s('"></i>\n        </div>\n        <div class="file-data">\n            <div class="file-origin">\n                '),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileconflictresolver.source"))),s('\n            </div>\n            <div class="file-name">\n                '),s(n.escapeHtml(e.source.name)),s('\n            </div>\n            <div class="file-path">\n                '),s(n.escapeHtml(e.source.path)),s('\n            </div>\n        </div>\n    </div>\n    <div class="buttons">\n        <div class="for-all">\n            <label class="checkbox">\n                <input type="checkbox" data-name="forall" />\n                '),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileconflictresolver.forAll"))),s('\n            </label>\n        </div>\n        <div class="buttons-cnt">\n            <button class="btn btn-default" data-action="cancel">\n                '),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileconflictresolver.button.cancel.label"))),s('\n            </button>\n            <button class="btn btn-default" data-action="omit">\n                '),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileconflictresolver.buttons.omit"))),s('\n            </button>\n            <button class="btn btn-default" data-action="overwrite">\n                '),e.conflictType==i.ConflictType.DIRECTORIES_MERGE?(s("\n                    "),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileconflictresolver.buttons.merge"))),s("\n                ")):(s("\n                    "),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileconflictresolver.buttons.overwrite"))),s("\n                ")),s("\n            </button>\n        </div>\n    </div>\n</div>\n"),o}}},{"../../../main/Common":10}],15:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s=e("pmc-web"),a=e("./template/main.html"),l=function(e){function t(t){return e.call(this,t,a.func)||this}return o(t,e),t.prototype.initWindow=function(e){this.$main.on("click","[data-action='cancel']",this.onCancelClick.bind(this)),this.$main.on("click","[data-action='omit']",this.onOmitClick.bind(this)),this.$main.on("click","[data-action='retry']",this.onRetryClick.bind(this))},t.prototype.onCancelClick=function(){this.triggerEvent("abort")},t.prototype.onOmitClick=function(){this.triggerEvent("omit")},t.prototype.onRetryClick=function(){this.triggerEvent("retry")},t}(s.window.base.BaseWindowView);n.FileErrorWindowView=l,l.prototype.className="com.privmx.plugin.notes2.window.fileerror.FileErrorWindowView"},{"./template/main.html":16,"pmc-web":1}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../main/Common");n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var o="",s=function(e){o+=e};return s('<div class="window-file-error-main" tabindex="-1">\n    <div class="header">\n        '),e.operationType==i.OperationType.MOVE?(s("\n            "),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileerror.moveError"))),s("\n        ")):e.operationType==i.OperationType.COPY?(s("\n            "),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileerror.copyError"))),s("\n        ")):e.operationType==i.OperationType.REMOVE&&(s("\n            "),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileerror.removeError"))),s("\n        ")),s('\n    </div>\n    <div class="info">\n        '),e.dirNotEmptyError?(s("\n            "),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileerror.emptyDir"))),s("\n        ")):(s("\n            "),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileerror.info",e.error.toString(16).toUpperCase()))),s("\n        ")),s("\n    </div>\n    "),e.destination&&(s('\n    <div class="file-info">\n        <div class="file-icon">\n            <i class="fa fa-file-o"></i>\n        </div>\n        <div class="file-data">\n            <div class="file-origin">\n                '),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileerror.destination"))),s('\n            </div>\n            <div class="file-name">\n                '),s(n.escapeHtml(e.destination.name)),s('\n            </div>\n            <div class="file-path">\n                '),s(n.escapeHtml(e.destination.path)),s("\n            </div>\n        </div>\n    </div>\n    ")),s('\n    <div class="file-info">\n        <div class="file-icon">\n            <i class="fa fa-file-o"></i>\n        </div>\n        <div class="file-data">\n            <div class="file-origin">\n                '),s(n.escapeHtml(n.i18n(e.operationType==i.OperationType.REMOVE?"plugin.notes2.window.fileerror.removeDestination":"plugin.notes2.window.fileerror.source"))),s('\n            </div>\n            <div class="file-name">\n                '),s(n.escapeHtml(e.source.name)),s('\n            </div>\n            <div class="file-path">\n                '),s(n.escapeHtml(e.source.path)),s('\n            </div>\n        </div>\n    </div>\n    <div class="buttons">\n        <div class="buttons-cnt">\n            <button class="btn btn-default" data-action="cancel">\n                '),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileerror.button.cancel.label"))),s('\n            </button>\n            <button class="btn btn-default" data-action="omit">\n                '),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileerror.buttons.omit"))),s('\n            </button>\n            <button class="btn btn-default" data-action="retry">\n                '),s(n.escapeHtml(n.i18n("plugin.notes2.window.fileerror.buttons.retry"))),s("\n            </button>\n        </div>\n    </div>\n</div>\n"),o}}},{"../../../main/Common":10}],17:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s=e("pmc-web"),a=e("./template/main.html"),l=e("./TreeItem"),r=e("./pickerpanel/SectionsPickerPanelView"),c=e("./pickerpanel/FilesPickerPanelView"),d=e("./pickerpanel/FilesToImportPanelView"),p=function(e){function t(t){var n=e.call(this,t,a.func)||this;return n.personsComponent=n.addComponent("personsComponent",new s.component.persons.PersonsView(n,n.helper)),n.sectionsPicker=n.addComponent("sectionsPicker",new r.SectionsPickerPanelView(n,null)),n.sectionsPicker.ipcMode=!0,n.filesPicker=n.addComponent("filesPicker",new c.FilesPickerPanelView(n,null)),n.filesPicker.ipcMode=!0,n.choosenFiles=n.addComponent("choosenFiles",new d.FilesToImportPanelView(n,null)),n.choosenFiles.ipcMode=!0,n.panelsSplitter=n.addComponent("panelsSplitter",new s.component.splitter.SplitterView(n,{firstPanelMinSize:200,secondPanelMinSize:function(){return 200},type:"vertical",handlePlacement:"right",handleDot:!1})),n.panelsSplitter.addEventListener("handleMove",n.onHandleMove.bind(n)),n}return o(t,e),t.prototype.initWindow=function(e){var t=this;return this.$main.on("click","[data-action=import]",this.onImportSelected.bind(this)),this.$main.on("click","[data-action=close]",this.onClose.bind(this)),this.$main.find("input[name=hidden-files]").change(this.onHiddenChange.bind(this)),s.Q().then((function(){return s.JQuery(document).on("keydown",t.onKeyDown.bind(t)),t.panelsSplitter.$container=t.$main.find(".content"),t.panelsSplitter.triggerInit()})).then((function(){return t.filesPicker.$container=t.panelsSplitter.$left,t.choosenFiles.$container=t.panelsSplitter.$right,t.personsComponent.$main=t.$main,t.$sizeCounterContainer=t.$main.find(".bottom-bar .totalSize"),t.$countContainer=t.$main.find(".bottom-bar .count"),s.Q.all([t.choosenFiles.triggerInit(),t.filesPicker.triggerInit(),t.personsComponent.triggerInit()])})).then((function(){t.$topBarRightPanel=t.$main.find(".top-bar .right"),t.$topBarLeftPanel=t.$main.find(".top-bar .left"),t.$bottomBarRightPanel=t.$main.find(".bottom-bar .right"),t.$bottomBarLeftPanel=t.$main.find(".bottom-bar .left");var n=t.panelsSplitter.$handle.css("left");t.setPanelsPos(n),t.hidePathIfRoot(e.destDirectory),t.personsComponent.refreshAvatars(),t.$main.focus()}))},t.prototype.onHiddenChange=function(e){this.triggerEvent("hiddenChanged",this.$main.find("input[name=hidden-files]").prop("checked"))},t.prototype.onKeyDown=function(e){e.keyCode===s.webUtils.KEY_CODES.escape&&(e.preventDefault(),this.triggerEvent("close"))},t.prototype.onImportSelected=function(){this.setImportButtonLocked(!0),this.triggerEvent("importFiles")},t.prototype.setImportButtonLocked=function(e){this.$main.find("[data-action=import]").toggleClass("disabled",e)},t.prototype.toggle=function(e,t){this.$main.find(".file-entry[data-id='"+e+"'] .tree-children").toggleClass("hide",!t)},t.prototype.onCloseClick=function(){this.triggerEvent("close")},t.prototype.onAfterFilesListRender=function(){this.scrollTo(this.$main.find(".active"))},t.prototype.scrollTo=function(e){if(0!=e.length){var t=this.$main.find(".table-container")[0],n=e[0].getBoundingClientRect(),i=t.getBoundingClientRect();n.bottom>i.bottom&&t.scrollTo(0,t.scrollTop+(n.bottom-i.bottom)),n.top<i.top&&t.scrollTo(0,t.scrollTop-(i.top-n.top))}},t.prototype.resetSizeCounter=function(){this.sizeCounter=0,this.$sizeCounterContainer.text(this.sizeCounter)},t.prototype.addSizeToCounter=function(e){this.sizeCounter+=e,this.$sizeCounterContainer.text(this.helper.bytesSize2(this.sizeCounter))},t.prototype.updateFilesTotal=function(e,t){this.$sizeCounterContainer.text(this.helper.bytesSize2(t)),this.$countContainer.text(e)},t.prototype.doneProcessing=function(e){var t=l.ViewTreeItem.fromId(this.$main[0],e);t&&t.$el.find(".on-progress").empty()},t.prototype.onClose=function(){this.triggerEvent("close")},t.prototype.setPanelsPos=function(e){var t="number"==typeof e?e.toString():e,n=t.includes("px")?t:t+"px";this.$topBarLeftPanel.css("width",n),this.$bottomBarLeftPanel.css("width",n)},t.prototype.hidePathIfRoot=function(e){"/"==e&&this.$topBarRightPanel.toggleClass("with-path",!1)},t.prototype.onHandleMove=function(e){this.setPanelsPos(e.position)},t.prototype.updateCurrentDir=function(e){this.$topBarLeftPanel.find(".current-path").text(e)},t.DOUBLE_CLICK_TIME=400,t}(s.window.base.BaseWindowView);n.FilesImporterWindowView=p,p.prototype.className="com.privmx.plugin.notes2.window.filesimporter.FilesImporterWindowView"},{"./TreeItem":18,"./pickerpanel/FilesPickerPanelView":20,"./pickerpanel/FilesToImportPanelView":21,"./pickerpanel/SectionsPickerPanelView":22,"./template/main.html":28,"pmc-web":1}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("pmc-web"),o=function(){function e(e){this.$el=e,this.id=this.$el.data("id"),this.type=this.$el.data("type"),this.parentId=this.$el.data("parent-id"),this.checked=this.$el.find("input[type=checkbox]").prop("checked")}return e.fromId=function(t,n){return new e(i.JQuery(t).find(".file-entry[data-id='"+n+"']"))},e.fromEvent=function(t){return new e(i.JQuery(t.currentTarget).closest(".file-entry"))},e.prototype.serialize=function(){return JSON.stringify({id:this.id,parentId:this.parentId,type:this.type,checked:this.checked})},e}();n.ViewTreeItem=o,o.prototype.className="com.privmx.plugin.notes2.window.filesimporter.ViewTreeItem"},{"pmc-web":1}],19:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function a(e){try{r(i.next(e))}catch(e){s(e)}}function l(e){try{r(i.throw(e))}catch(e){s(e)}}function r(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(a,l)}r((i=i.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,i,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function l(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&s[0]?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};Object.defineProperty(n,"__esModule",{value:!0});var l=e("pmc-web"),r=e("./template/main.html"),c=function(e){function t(t,n){var i=e.call(this,t)||this;return i.personsComponent=n,i}return o(t,e),t.prototype.init=function(e){var t=this;return l.Q().then((function(){return s(t,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return this.setupListOptionsBeforeInit(),this.createComponents(),this.render(e),t=this.$container.find(".items-list"),this.items.$container=t,[4,this.items.triggerInit()];case 1:return n.sent(),this.onAfterInit(),[2]}}))}))}))},t.prototype.createComponents=function(){this.items=this.addComponent("items",new l.component.extlist.ExtListView(this,this.listOptions))},t.prototype.render=function(e){this.$container.empty().append(this.templateManager.createTemplate(r.func).renderToJQ(e))},t}(l.component.base.ComponentView);n.BaseItemsPanelView=c,c.prototype.className="com.privmx.plugin.notes2.window.filesimporter.pickerpanel.BaseItemsPanelView"},{"./template/main.html":25,"pmc-web":1}],20:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s=e("./template/file-entry.html"),a=e("./BaseItemsPanelView"),l=e("../TreeItem"),r=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.personsComponent=n,i}return o(t,e),t.prototype.setupListOptionsBeforeInit=function(){this.listOptions={template:s.func}},t.prototype.onDirectoryClick=function(e){var n=this;e.stopPropagation();var i=l.ViewTreeItem.fromEvent(e);"directory"==i.type&&(this.lastClickTid&&this.lastClickId==i.id?(clearTimeout(this.lastClickTid),this.lastClickTid=null,this.lastClickId=null,this.triggerEvent("directoryClick",i.id,i.parentId)):(this.lastClickId=i.id,this.lastClickTid=setTimeout((function(){n.lastClickTid=null,n.lastClickId=null}),t.DOUBLE_CLICK_TIME)))},t.prototype.onAddClick=function(e){e.stopPropagation();var t=l.ViewTreeItem.fromEvent(e);this.triggerEvent("addItemClick",t.id)},t.prototype.onAfterInit=function(){this.$container.on("click",".file-entry[data-type='directory'] .file-name",this.onDirectoryClick.bind(this)),this.$container.on("click",".file-entry .add-remove-btn",this.onAddClick.bind(this))},t.DOUBLE_CLICK_TIME=250,t}(a.BaseItemsPanelView);n.FilesPickerPanelView=r,r.prototype.className="com.privmx.plugin.notes2.window.filesimporter.pickerpanel.FilesPickerPanelView"},{"../TreeItem":18,"./BaseItemsPanelView":19,"./template/file-entry.html":24}],21:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s=e("./template/choosen-file.html"),a=e("./BaseItemsPanelView"),l=e("../TreeItem"),r=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.personsComponent=n,i}return o(t,e),t.prototype.setupListOptionsBeforeInit=function(){this.listOptions={template:s.func}},t.prototype.onRemoveClick=function(e){e.stopPropagation();var t=l.ViewTreeItem.fromEvent(e);this.triggerEvent("removeItemClick",t.id)},t.prototype.onAfterInit=function(){this.$container.on("click",".file-entry .add-remove-btn",this.onRemoveClick.bind(this))},t}(a.BaseItemsPanelView);n.FilesToImportPanelView=r,r.prototype.className="com.privmx.plugin.notes2.window.filesimporter.pickerpanel.FilesToImportPanelView"},{"../TreeItem":18,"./BaseItemsPanelView":19,"./template/choosen-file.html":23}],22:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s=e("./template/section.html"),a=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.personsComponent=n,i}return o(t,e),t.prototype.setupListOptionsBeforeInit=function(){this.listOptions={template:s.func}},t.prototype.onAfterInit=function(){},t}(e("./BaseItemsPanelView").BaseItemsPanelView);n.SectionsPickerPanelView=a,a.prototype.className="com.privmx.plugin.notes2.window.filesimporter.pickerpanel.SectionsPickerPanelView"},{"./BaseItemsPanelView":19,"./template/section.html":26}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('\n<div class="file-entry '),o(n.escapeHtml(t.isActive?"active":"")),o('" data-type="'),o(n.escapeHtml(e.fileType)),o('" data-id="'),o(n.escapeHtml(e.id)),o('" data-isparentdir="'),o(n.escapeHtml(e.isParentDir)),o('">\n  <span class="actions">\n    <button tabindex="-1" class="btn btn-xs btn-warning add-remove-btn" data-action="remove-item">\n      <i class="fa fa-times"></i>\n    </button>\n  </span>\n  <span class="file-name">\n    <i class="fa '),o(n.escapeHtml(e.icon)),o('"></i>\n    <span class="file-name-text">\n      '),o(n.escapeHtml(e.name)),o('\n    </span>\n  </span>\n  \x3c!-- <td class="file-size">\n    '),"file"==e.fileType&&(o("\n      "),o(n.escapeHtml(n.bytesSize2(e.size))),o("\n    ")),o('\n  </td>\n  <td class="file-mod-date no-modifier">\n    '),e.modificationDate&&(o('\n      <div class="file-date" title="'),o(n.escapeHtml(n.dateWithHourLocal(e.modificationDate))),o('" data-timeago-type="calendarDate" data-timeago="'),o(n.escapeHtml(e.modificationDate)),o('">\n        '),o(n.escapeHtml(n.calendarDate(e.modificationDate))),o("\n      </div>\n    ")),o("\n  </td> --\x3e\n</div>\n"),i}}},{}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('\n<div class="file-entry '),o(n.escapeHtml(t.isActive?"active":"")),o('" data-type="'),o(n.escapeHtml(e.fileType)),o('" data-id="'),o(n.escapeHtml(e.id)),o('" data-isparentdir="'),o(n.escapeHtml(e.isParentDir)),o('">\n  <span class="actions">\n    '),"parent"!=e.id&&o('\n      <button tabindex="-1" class="btn btn-xs btn-default gray add-remove-btn" data-action="add-item">\n        <span class="btn-icon">&raquo;</span>\n      </button>  \n    '),o('\n  </span>\n  <span class="file-name">\n    <i class="fa '),o(n.escapeHtml(e.icon)),o('"></i>\n    <span class="file-name-text">\n      '),o(n.escapeHtml(e.name)),o('\n    </span>\n  </span>\n\n  \x3c!-- <td class="file-size">\n    '),"file"==e.fileType&&(o("\n      "),o(n.escapeHtml(n.bytesSize2(e.size))),o("\n    ")),o('\n  </td>\n  <td class="file-mod-date no-modifier">\n    '),e.modificationDate&&(o('\n      <div class="file-date" title="'),o(n.escapeHtml(n.dateWithHourLocal(e.modificationDate))),o('" data-timeago-type="calendarDate" data-timeago="'),o(n.escapeHtml(e.modificationDate)),o('">\n        '),o(n.escapeHtml(n.calendarDate(e.modificationDate))),o("\n      </div>\n    ")),o("\n  </td> --\x3e\n</div>\n"),i}}},{}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="";return i+='\n<div class="picker-panel">\n    <div class="items-list"></div>\n</div>'}}},{}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('\n\n\n<div class="section-element wi-element '),o(n.escapeHtml(e.description?"with-description":"")),o(" "),o(n.escapeHtml(t.isActive?"active":"")),o(" "),o(n.escapeHtml(e.enabled?"":"disabled")),o(" "),o(n.escapeHtml(e.primary?"primary":"")),o('" data-section-id="'),o(n.escapeHtml(e.id)),o('">\n    <div class="wi-element-inner">\n      <div class="wi-element-icon bckg-icon '),o(n.escapeHtml("private"==e.scope?"bckg-icon-border":"")),o(' has-section-tooltip" data-section-id="'),o(n.escapeHtml(e.id)),o('">\n        <img src="'),o(n.escapeHtml(n.getAssetByName("DEFAULT_PRIVMX_ICON"))),o('" />\n      </div>\n      <div class="wi-element-name '),o(n.escapeHtml(e.breadcrumb.length>0?"with-breadcrumb":"")),o('">\n        <div class="name-wrapper">\n          '),e.breadcrumb.length>0&&(o('\n            <span class="section-breadcrumb">'),o(e.breadcrumb),o("</span>\n          ")),o("\n          "),o(n.escapeHtml(e.name)),o('\n          <div class="voice-chat-tooltip has-userslist-tooltip" data-userslist-id="'),o(n.escapeHtml(e.id)),o('"></div>\n          '),e.description&&(o('\n            <div class="wi-element-description">'),o(n.escapeHtml(e.description)),o("</div>\n          ")),o("  \n        </div>\n      </div>\n    </div>\n  </div>\n"),i}}},{}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('<div class="current-path">'),o(n.escapeHtml(e.currentDir)),o('</div>\n<div class="inner">\n  <div class="wi-element">\n    <div class="wi-element-inner">\n      <div class="wi-element-icon bckg-icon bckg-icon-inverse2'),o(n.escapeHtml(" private"==e.sectionType?" private":"")),o('">\n        <img src="'),o(n.escapeHtml(n.getAssetByName("DEFAULT_PRIVMX_ICON"))),o('" />\n      </div>\n      <div class="wi-element-name">\n        <span class="name">'),o(n.escapeHtml(e.sectionName)),o("</span>\n      </div>\n    </div>\n  </div>\n</div>"),i}}},{}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./dest-section.html"),o=e("./source-header.html"),s=e("pmc-web").component.template.conversation;n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var a="",l=function(e){a+=e};return l('<div class="window-filesimporter-main" tabindex="-1">\n  <div class="top-bar">\n    <div class="top-bar-panel left">\n      '),l(n.createTemplate(o.func).render({computerName:e.computerName,currentPath:e.currentPath})),l('\n    </div>\n    <div class="top-bar-panel right with-path">\n      <div class="dest">\n        '),e.sectionName&&(l('\n        <div class="talking-section--section-container">\n          '),l(n.createTemplate(i.func).render({sectionName:e.sectionName,sectionType:e.sectionType,currentDir:e.destDirectory})),l('\n            <div class="visible-avatars-list" data-action="toggle-listening-users-dropdown"></div>\n        </div>\n      ')),l("\n      "),e.conversationModel&&(l('\n        <div class="talking-section--conversation-container">\n          '),l(n.createTemplate(s).render(e.conversationModel,{isActive:!1})),l('\n            <div class="visible-avatars-list" data-action="toggle-listening-users-dropdown"></div>\n        </div>\n      ')),l('\n  \n      </div>\n    </div>\n  </div>\n\n  <div class="content">\n    <div class="files">\n      <ul class="clt">\n        \n      </ul>\n    </div>\n  </div>\n  <div class="bottom-bar">\n    <div class="bottom-bar-panel left">\n      <div class="show-hidden">\n        <input type="checkbox" name="hidden-files" '),l(n.escapeHtml(e.showHiddenFiles?"checked":"")),l('/>\n        <label for="hidden-files">Show hidden files</label>\n      </div>  \n    </div>\n    <div class="bottom-bar-panel right">\n      <div class="info">\n        <span class="size-label">'),l(n.escapeHtml(n.i18n("plugin.notes2.window.filesimporter.totalSize.label"))),l(':</span>\n        <span class="count"></span> (<span class="totalSize"></span>)\n      </div>  \n    </div>  \n    <div class="buttons">\n      <button class="btn btn-success" data-action="import">\n        <i class="fa fa-upload"></i>\n        '),l(n.escapeHtml(n.i18n("plugin.notes2.window.filesimporter.button.import.label"))),l('\n      </button>\n      <button class="btn btn-default gray" data-action="close">\n        '),l(n.escapeHtml(n.i18n("core.button.cancel.label"))),l("\n      </button>\n    </div>\n\n  </div>\n</div>\n"),a}}},{"./dest-section.html":27,"./source-header.html":29,"pmc-web":1}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('\n<div class="current-path">'),o(n.escapeHtml(e.currentPath)),o('</div>\n<div class="inner">\n    <div class="wi-element">\n      <div class="wi-element-inner">\n        <div class="wi-element-icon bckg-icon bckg-icon-inverse2 small-icon">\n          <i class="fa fa-desktop"></i>\n        </div>\n        <div class="wi-element-name">\n          '),o(n.escapeHtml(e.computerName)),o("\n        </div>\n      </div>\n    </div>\n  </div>"),i}}},{}],30:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s=e("pmc-web"),a=e("./template/main.html"),l=e("./template/version.html"),r=function(e){function t(t){var n=e.call(this,t,a.func)||this;return n.personsComponent=n.addComponent("personsComponent",new s.component.persons.PersonsView(n,n.helper)),n.personTooltip=new s.component.persontooltip.PersonTooltipView(n.templateManager,n.personsComponent),n.notifications=n.addComponent("notifications",new s.component.notification.NotificationView(n,{xs:!0})),n.versions=n.addComponent("versions",new s.component.extlist.ExtListView(n,{template:l.func})),n.versions.addEventListener("ext-list-change",n.onAfterVersionListRender.bind(n)),n}return o(t,e),t.prototype.initWindow=function(e){var t=this;return s.Q().then((function(){return t.turnTimeAgoRefresher(),t.$main.on("click","[data-signature]",t.onVersionClick.bind(t)),t.$main.on("click","[data-action='open']",t.onOpenClick.bind(t)),t.$main.on("click","[data-action='copy']",t.onCopyClick.bind(t)),t.$main.on("click","[data-action='close']",t.onCloseClick.bind(t)),s.JQuery(document).on("keydown",t.onKeyDown.bind(t)),t.personsComponent.$main=t.$main,t.personTooltip.init(t.$main),t.versions.$container=t.$main.find(".versions"),t.notifications.$container=t.$main.find(".notifications"),s.Q.all([t.personsComponent.triggerInit(),t.versions.triggerInit(),t.notifications.triggerInit()])})).then((function(){t.personsComponent.refreshAvatars(),t.$main.focus()}))},t.prototype.onKeyDown=function(e){e.keyCode===s.webUtils.KEY_CODES.upArrow?(e.preventDefault(),this.triggerEvent("selectUp")):e.keyCode===s.webUtils.KEY_CODES.downArrow?(e.preventDefault(),this.triggerEvent("selectDown")):e.keyCode===s.webUtils.KEY_CODES.enter?(e.preventDefault(),this.triggerEvent("openSelectedVersion")):e.keyCode==s.webUtils.KEY_CODES.c&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),this.triggerEvent("copySelectedVersion")):e.keyCode===s.webUtils.KEY_CODES.escape&&(e.preventDefault(),this.triggerEvent("close"))},t.prototype.onVersionClick=function(e){var n=this,i=s.JQuery(e.target).closest("[data-signature]").data("signature");this.triggerEvent("setActive",i),this.lastClickTid&&this.lastClickId==i?(clearTimeout(this.lastClickTid),this.lastClickTid=null,this.lastClickId=null,this.triggerEvent("openSelectedVersion")):(this.lastClickId=i,this.lastClickTid=setTimeout((function(){n.lastClickTid=null,n.lastClickId=null}),t.DOUBLE_CLICK_TIME))},t.prototype.onOpenClick=function(){this.triggerEvent("openSelectedVersion")},t.prototype.onCopyClick=function(){this.triggerEvent("copySelectedVersion")},t.prototype.onCloseClick=function(){this.triggerEvent("close")},t.prototype.onAfterVersionListRender=function(){this.personsComponent.refreshAvatars(),this.scrollTo(this.$main.find(".active"))},t.prototype.scrollTo=function(e){if(0!=e.length){var t=this.$main.find(".table-container")[0],n=e[0].getBoundingClientRect(),i=t.getBoundingClientRect();n.bottom>i.bottom&&t.scrollTo(0,t.scrollTop+(n.bottom-i.bottom)),n.top<i.top&&t.scrollTo(0,t.scrollTop-(i.top-n.top))}},t.DOUBLE_CLICK_TIME=400,t}(s.window.base.BaseWindowView);n.HistoryWindowView=r,r.prototype.className="com.privmx.plugin.notes2.window.history.HistoryWindowView"},{"./template/main.html":31,"./template/version.html":32,"pmc-web":1}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('<div class="window-history-main" tabindex="-1">\n  <div class="header">\n    <i class="fa '),o(n.escapeHtml(e.icon)),o('"></i>\n    '),o(n.escapeHtml(e.name)),o('\n  </div>\n  <div class="table-container">\n    <table>\n      <tbody class="versions">\n      </tbody>\n    </table>\n  </div>\n  <div class="buttons">\n    <button class="btn btn-success" data-action="open">\n      <i class="fa fa-folder-open-o"></i>\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.window.history.open"))),o('\n    </button>\n    <button class="btn btn-default" data-action="copy">\n      <i class="fa fa-copy"></i>\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.window.history.copy"))),o('\n    </button>\n    <button class="btn btn-default" data-action="close">\n      <i class=""></i>\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.window.history.button.close.label"))),o('\n    </button>\n  </div>\n  <div class="notifications"></div>\n</div>\n'),i}}},{}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('<tr class="version-entry '),o(n.escapeHtml(t.isActive?"active":"")),o('" data-signature="'),o(n.escapeHtml(e.signature)),o('">\n  <td class="name">\n     <i class="fa fa-circle"></i>\n     <span title="'),o(n.escapeHtml(n.dateWithHourLocal(e.modifiedDate))),o('" data-timeago-type="calendarDate" data-timeago="'),o(n.escapeHtml(e.modifiedDate)),o('">\n       '),o(n.escapeHtml(n.calendarDate(e.modifiedDate))),o('\n     </span>\n  </td>\n  <td class="size">\n     '),o(n.escapeHtml(n.bytesSize(e.size))),o('\n  </td>\n  <td class="date">\n    '),e.modifier&&(o('\n      <canvas class="not-rendered" data-tooltip-trigger="'),o(n.escapeHtml(e.modifier)),o('" data-hashmail-image="'),o(n.escapeHtml(e.modifier)),o('" data-width="16" data-height="16" data-auto-size="true" data-auto-refresh="true" width="10" height="10"></canvas>\n    ')),o("\n  </td>\n</tr>"),i}}},{}],33:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s=e("pmc-web"),a=e("./template/main.html"),l=e("./template/channel.html"),r=function(e){function t(t){var n=e.call(this,t,a.func)||this;return n.inputModified=!1,n.personsComponent=n.addComponent("personsComponent",new s.component.persons.PersonsView(n,n.helper)),n.conversations=n.addComponent("conversations",new s.component.conv2list.Conv2ListView(n,{personsView:n.personsComponent,extList:{template:null}})),n}return o(t,e),t.prototype.initWindow=function(e){var t=this;return s.Q().then((function(){return t.$main.on("click",".type",t.onTypeClick.bind(t)),t.$main.on("click","[data-action=create]",t.onCreateClick.bind(t)),t.$main.on("click","[data-action=cancel]",t.onCancelClick.bind(t)),t.$main.on("click","[data-conversation-id]",t.onConversationClick.bind(t)),t.$body.on("keydown",t.onKeyDown.bind(t)),t.$main.find(".type").first().click(),t.$main.find(".name input").on("input",(function(){t.inputModified=!0})),t.personsComponent.$main=t.$main,t.personsComponent.triggerInit()})).then((function(){return t.conversations.conversations.$container=t.$main.find(".conversations"),t.conversations.triggerInit()})).then((function(){var n=t.$main.find(".channels"),i=t.templateManager.createTemplate(l.func);e.channels.forEach((function(e){n.append(i.renderToJQ(e))})),t.setActive(e.defaultDestination),t.bindKeyPresses(),t.focusOnInput()}))},t.prototype.onTypeClick=function(e){var t=s.JQuery(e.target).closest(".type");t.hasClass("disabled")||(this.$main.find(".types .type").removeClass("active"),t.addClass("active"),this.currentActionId=t.data("action-id"),this.triggerEvent("chooseAction",t.data("action-id"),void 0,!0),this.setName(t.data("default-name")),this.focusOnInput())},t.prototype.getCurrentSelectedType=function(){return this.$main.find(".types .type.active")},t.prototype.onTypeSwitch=function(){var e=this.getCurrentSelectedType(),t=e.parent().find(".type"),n=t.index(e);++n>=t.length&&(n=0);var i=s.JQuery(t.get(n));i.hasClass("disabled")||(this.$main.find(".types .type").removeClass("active"),i.addClass("active"),this.triggerEvent("chooseAction",i.data("action-id")),this.currentActionId=i.data("action-id"),this.setName(i.data("default-name")),this.focusOnInput())},t.prototype.onCancelClick=function(){this.triggerEvent("cancel")},t.prototype.onCreateClick=function(){this.createFile()},t.prototype.onKeyDown=function(e){13==e.keyCode&&(e.preventDefault(),this.createFile())},t.prototype.onConversationClick=function(e){var t=s.JQuery(e.target).closest("[data-conversation-id]");this.setActive(t.data("conversation-id"))},t.prototype.setActive=function(e){this.$main.find("[data-conversation-id]").removeClass("active");var t=this.$main.find("[data-conversation-id='"+e+"']");0==t.length&&(t=this.$main.find("[data-conversation-id='my']")),t.addClass("active");var n=this.$main.find(".destinations")[0];n.scrollTop=t[0].offsetTop-n.offsetTop},t.prototype.setName=function(e){this.inputModified||this.$main.find(".name input").val(e)},t.prototype.createFile=function(){var e=this.$main.find(".name input"),t=e.val(),n=this.$main.find(".types .type.active").data("action-id");if(t){var i=this.$main.find(".active[data-conversation-id]").data("conversation-id"),o=this.$main.find("[data-action=check]").is(":checked");this.triggerEvent("createFile",n,i,t,o)}else e.focus()},t.prototype.focusOnInput=function(){var e=this.$main.find(".name input"),t=e.get(0).value;this.inputModified?e.focus():-1!=t.indexOf(".")?(e.focus(),e.get(0).setSelectionRange(0,t.lastIndexOf("."))):e.focus().select()},t.prototype.bindKeyPresses=function(){var e=this;s.JQuery(document).on("keydown",(function(t){t.keyCode==s.webUtils.KEY_CODES.tab?(t.preventDefault(),e.onTypeSwitch()):t.keyCode==s.webUtils.KEY_CODES.enter&&e.currentActionId.indexOf("upload")>-1?(t.preventDefault(),e.triggerEvent("uploadActionConfirmed")):t.keyCode==s.webUtils.KEY_CODES.escape&&(t.preventDefault(),e.triggerEvent("cancel"))}))},t}(s.window.base.BaseWindowView);n.NewNoteWindowView=r,r.prototype.className="com.privmx.plugin.notes2.window.newnote.NewNoteWindowView"},{"./template/channel.html":34,"./template/main.html":35,"pmc-web":1}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('<div class="wi-element channel-entry" data-conversation-id="'),o(n.escapeHtml(e.id)),o('">\n  <div class="wi-element-inner">\n    <div class="wi-element-icon bckg-icon '),o(n.escapeHtml("private"==e.scope?"bckg-icon-border":"")),o('">\n      <img src="'),o(n.escapeHtml(n.getAssetByName("DEFAULT_PRIVMX_ICON"))),o('" />\n    </div>\n    <div class="wi-element-name">\n      '),o(n.escapeHtml(e.name)),o("\n    </div>\n  </div>\n</div>"),i}}},{}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('<div class="window-new-note-main">\n  <div class="types">\n    '),e.actions.forEach((function(e){o('\n      <div class="type" data-action-id="'),o(n.escapeHtml(e.id)),o('" data-default-name='),o(n.escapeHtml(e.defaultName)),o('>\n        <i class="'),o(n.escapeHtml(e.icon)),o('"></i>\n        <div class="label-text">'),o(n.escapeHtml(n.i18n(e.labelKey))),o("</div>\n      </div>\n    ")})),o('\n  </div>\n  <div class="name">\n    <div class="label-text">\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.window.newNote.fileName.label"))),o('\n    </div>\n    <div class="input">\n      <input class="form-control" type="text" value="new-file"/>\n    </div>\n  </div>\n  <div class="destinations-entry">\n    <div class="label-text">\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.window.newNote.destination.label"))),o('\n    </div>\n    <div class="destinations">\n      <div class="conversation-element contact without-description" data-conversation-id="my">\n        <span>\n          <div class="image-with-data">\n            <p class="image">\n              <canvas class="not-rendered" data-tooltip-trigger="'),o(n.escapeHtml(e.hashmail)),o('" data-hashmail-image="'),o(n.escapeHtml(e.hashmail)),o('" data-width="30" data-height="30" data-auto-size="true" data-auto-refresh="true"></canvas>\n            </p>\n            <div class="text-col">\n              <p class="name">\n                '),o(n.escapeHtml(n.i18n("plugin.notes2.window.newNote.filter.my"))),o('\n              </p>\n            </div>\n          </div>\n        </span>\n      </div>\n      <div class="wi-element channel-entry" data-conversation-id="local">\n        <div class="wi-element-inner">\n          <div class="wi-element-icon bckg-icon ">\n            <i class="fa fa-desktop"></i>\n          </div>\n          <div class="wi-element-name">\n              '),o(n.escapeHtml(n.i18n("plugin.notes2.window.newNote.filter.local"))),o('\n          </div>\n        </div>\n      </div>\n      <div class="channels">\n      </div>\n      <ul class="conversations">\n      </ul>\n    </div>\n    </ul>\n  </div>\n  <div class="buttons">\n    <div class="input checkbox">\n      <label>\n        <input type="checkbox" name="newnote.open-after-create" data-action="check" checked="checked"/>\n        '),o(n.escapeHtml(n.i18n("plugin.notes2.window.newNote.checkbox.openAfterCreate"))),o('\n      </label>\n    </div>\n    <button class="btn btn-success" data-action="create">\n        '),o(n.escapeHtml(n.i18n("plugin.notes2.window.newNote.button.create.label"))),o('\n    </button>\n    <button class="btn btn-default" data-action="cancel">\n        '),o(n.escapeHtml(n.i18n("plugin.notes2.window.newNote.button.cancel.label"))),o("\n    </button>\n  </div>\n</div>\n"),i}}},{}],36:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s,a=e("pmc-web"),l=e("./template/main.html"),r=e("./template/editor-loader.html"),c=e("./template/empty-preview.html"),d=e("./template/directory-preview.html"),p=e("../../component/fileslist/FilesListView"),f=a.Logger.get("notes2-plugin.window.notes2.Notes2WindowView");!function(e){e[e.SIDEBAR=0]="SIDEBAR",e[e.FILES_LIST=1]="FILES_LIST",e[e.PREVIEW=2]="PREVIEW"}(s=n.FocusedElement||(n.FocusedElement={}));var u=function(e){function t(n){var i=e.call(this,n,l.func)||this;return i.isCtrlKeyDown=!1,i.leftPanelGroups=["my-files","common-files","conversations"],i.lastFocusedElement=s.SIDEBAR,i.isSearchOn=!1,i.mostRecentlyActivatedId="none",i.filesLists={},i.verticalSplitter=i.addComponent("verticalSplitter",new a.component.splitter.SplitterView(i,{type:"vertical",handlePlacement:"right",handleDot:!0,firstPanelMinSize:t.SIDEBAR_MIN_WIDTH,secondPanelMinSize:function(){return i.filesVerticalSplitter&&i.filesVerticalSplitter.$left&&i.filesVerticalSplitter.$left.children().length>0?i.filesVerticalSplitter.$component.hasClass("hide-file-preview")?t.FILESLIST_MIN_WIDTH:i.filesVerticalSplitter.$left.outerWidth()+t.PREVIEW_MIN_WIDTH:t.FILESLIST_MIN_WIDTH+t.PREVIEW_MIN_WIDTH}})),i.filesVerticalSplitter=i.addComponent("filesVerticalSplitter",new a.component.splitter.SplitterView(i,{type:"vertical",handlePlacement:"right",handleDot:!0,firstPanelMinSize:t.FILESLIST_MIN_WIDTH,secondPanelMinSize:t.PREVIEW_MIN_WIDTH})),i.notifications=i.addComponent("notifications",new a.component.notification.NotificationView(i,{xs:!0})),i.filesVerticalSplitter.addEventListener("handleMove",i.onHandleMove.bind(i)),i.personsComponent=i.addComponent("personsComponent",new a.component.persons.PersonsView(i,i.helper)),i.personTooltip=new a.component.persontooltip.PersonTooltipView(i.templateManager,i.personsComponent),i.disabledSection=i.addComponent("disabled-section",new a.component.disabledsection.DisabledSectionView(i)),i.loading=i.addComponent("loading",new a.component.loading.LoadingView(i)),i.sectionTooltip=i.addComponent("sectiontooltip",new a.component.sectiontooltip.SectionTooltipView(i)),i.sidebar=i.addComponent("sidebar",new a.component.sidebar.SidebarView(i,{conv2List:{personsView:i.personsComponent,extList:{template:null}},conv2Splitter:null,customElementList:{extList:{template:null,onAfterListRender:i.onAfterRenderCustomList.bind(i)}},sectionList:{extList:{template:null}},customSectionList:{extList:{template:null}}})),i}return o(t,e),t.prototype.onAfterRenderCustomList=function(){this.personsComponent.refreshAvatars()},t.prototype.initWindow=function(e){var t,n=this;return document.addEventListener("blur",(function(){clearTimeout(t),t=setTimeout((function(){var e=n.getFocusedElement();null!=e&&(n.lastFocusedElement=e)}),1)}),!0),document.addEventListener("focus",(function(){clearTimeout(t);var e=n.getFocusedElementFromEl(a.JQuery(document.activeElement));null!=e&&(n.lastFocusedElement=e)}),!0),a.Q().then((function(){return n.turnTimeAgoRefresher(),n.$body.on("keydown",n.onKeydown.bind(n)),n.personsComponent.$main=n.$main,n.personTooltip.init(n.$main),n.personsComponent.triggerInit()})).then((function(){return n.verticalSplitter.$container=n.$mainContainer,n.verticalSplitter.triggerInit()})).then((function(){return n.verticalSplitter.$left.addClass("sidebar-container"),n.sidebar.$container=n.verticalSplitter.$left,n.sidebar.triggerInit()})).then((function(){n.verticalSplitter.$right.append(a.JQuery("<div class='section-files'></div>")),n.$disabledSectionContainer=a.JQuery("<div class='disabled-section'>"),n.verticalSplitter.$right.append(n.$disabledSectionContainer),n.disabledSection.$container=n.$disabledSectionContainer,n.disabledSection.triggerInit()})).then((function(){return n.filesVerticalSplitter.$container=n.verticalSplitter.$right.find(".section-files"),n.filesVerticalSplitter.triggerInit()})).then((function(){return n.filesVerticalSplitter.$right.addClass("preview-container").attr("tabindex","-1"),n.notifications.$container=n.filesVerticalSplitter.$left,n.notifications.triggerInit()})).then((function(){var t=n.templateManager.createTemplate(c.func).renderToJQ();n.filesVerticalSplitter.$right.append(t),n.filesVerticalSplitter.$right.append('<div class="trashed-info"></div>'),n.$trashedInfo=n.filesVerticalSplitter.$right.children(".trashed-info"),n.$editorLoader=n.templateManager.createTemplate(r.func).renderToJQ(),n.filesVerticalSplitter.$right.append(n.$editorLoader),n.makeCustomScroll(n.$main.find(".left-panel .scrollable-content")),n.activateFiles(e.activeId),null!=e.iframeId?n.showIframe(e.iframeId,e.iframeLoad):e.directory&&n.showDirectoryPreview(e.directory)})).then((function(){return n.sectionTooltip.refreshAvatars=n.refreshAvatars.bind(n),n.sectionTooltip.$container=n.$main,n.sectionTooltip.triggerInit()})).then((function(){return n.sidebar.usersListTooltip.refreshAvatars=n.refreshAvatars.bind(n),n.loading.$container=n.filesVerticalSplitter.$left,n.loading.triggerInit()})).then((function(){n.updateShowFilePreview(e.showFilePreview)}))},t.prototype.refreshAvatars=function(){this.personsComponent.refreshAvatars()},t.prototype.toggleDisabledSection=function(e){e?this.$main.find(".section-files").hide():this.$main.find(".section-files").show(),this.$disabledSectionContainer.css("display",e?"block":"none")},t.prototype.activateFiles=function(e){var t=this;if(this.mostRecentlyActivatedId=e,this.toggleDisabledSection(!1),this.$main.find(".preview-container").toggleClass("hidden",null==e),null==e)return this.active&&(this.active.$container.addClass("vhidden"),this.active.onDeactivate()),void this.loading.onFinishedLoading();e in this.filesLists||(this.filesLists[e]=this.addComponent(e,new p.FilesListView(this,this.personsComponent)),this.filesLists[e].$container=a.JQuery('<div class="files-list-container vhidden"></div>'),this.filesVerticalSplitter.$left.append(this.filesLists[e].$container),this.filesVerticalSplitter.$left.addClass("notes2-fileslist-component")),this.filesLists[e].triggerInit().then((function(){if(t.mostRecentlyActivatedId==e){var n=t.filesLists[e];t.active!=n?(t.active&&(t.active.$container.addClass("vhidden"),t.active.onDeactivate()),t.active=n,t.dragDrop=new a.component.dragdrop.DragDrop(t,n.$container.children(".files-list")),n.$container.removeClass("vhidden"),n.onActivate(),t.refreshFocus(),t.loading.onFinishedLoading()):t.loading.onFinishedLoading()}})).fail((function(e){t.loading.onFinishedLoading(),f.error("Cannot create files list",e)}))},t.prototype.onHandleMove=function(){for(var e in this.filesLists)this.filesLists[e].onResize()},t.prototype.showEditorLoader=function(e){this.$editorLoader.attr("data-style-name",e||""),this.$editorLoader.find(".inner2").html('<i class="fa fa-circle-o-notch fa-spin"></i>'),this.$editorLoader.removeClass("hide")},t.prototype.hideEditorLoader=function(){this.$editorLoader.addClass("hide"),this.$editorLoader.find(".inner2").empty()},t.prototype.removeIframe=function(e){this.filesVerticalSplitter.$right.find(".iframe-container#iframe-"+e).remove()},t.prototype.hideIframe=function(e){this.filesVerticalSplitter.$right.find(".iframe-container#iframe-"+e).removeClass("active")},t.prototype.clearPreview=function(){var e=this.filesVerticalSplitter.$right;e.find(".iframe-container:not(.new-active)").removeClass("active"),e.find(".iframe-container.new-active").removeClass("new-active"),this.hideDirectoryPreview()},t.prototype.showIframe=function(e,t){var n=this.filesVerticalSplitter.$right,i=n.find(".iframe-container#iframe-"+e);if(i.length>0)i.addClass("active new-active"),this.hideDirectoryPreview(),this.hideEditorLoader();else{this.clearPreview();var o=a.JQuery('<div id="iframe-'+e+'" class="iframe-container active"></div>');n.append(o),this.viewManager.parent.registerDockedWindow(e,t,o[0])}this.triggerEvent("afterShowIframe",e)},t.prototype.showDirectoryPreview=function(e){var t=this.filesVerticalSplitter.$right;this.clearPreview(),t.append(this.templateManager.createTemplate(d.func).renderToJQ(e))},t.prototype.hideDirectoryPreview=function(e){void 0===e&&(e=0);var t=this.filesVerticalSplitter.$right,n="";n=0==e?this.i18n("plugin.notes2.window.notes2.preview.empty"):this.i18n("plugin.notes2.window.notes2.preview.multi",e),t.find(".empty-info").find(".inner-2").text(n),t.find(".directory-preview").remove()},t.prototype.focus=function(){this.switchToPanel(this.getFocusedElementOrDefault(),!0)},t.prototype.refreshFocus=function(){var e=this.getFocusedElement();e==s.FILES_LIST?a.JQuery(document.activeElement).closest(".files-list-container").get(0)!=this.active.$container.get(0)&&this.active.$container.focus():null==e&&this.sidebar.$container.focus()},t.prototype.getFocusedElementFromEl=function(e){return e.closest(".sidebar-container").length>0?s.SIDEBAR:e.closest(".preview-container").length>0?s.PREVIEW:e.closest(".section-files").length>0?s.FILES_LIST:null},t.prototype.getFocusedElement=function(){return this.getFocusedElementFromEl(a.JQuery(document.activeElement))},t.prototype.getFocusedElementOrDefault=function(){var e=this.getFocusedElement();return null==e?null==this.lastFocusedElement?s.SIDEBAR:this.lastFocusedElement:e},t.prototype.onKeydown=function(e){if(e.keyCode==a.webUtils.KEY_CODES.r&&e.ctrlKey&&(e.preventDefault(),this.triggerEvent("refresh")),e.keyCode!=a.webUtils.KEY_CODES.tab||e.ctrlKey||e.metaKey)document.activeElement==document.body?this.lastFocusedElement==s.SIDEBAR?(this.sidebar.onKeydown(e),this.sidebar.$container.focus()):this.lastFocusedElement==s.FILES_LIST&&(this.active.onKeydown(e),this.active.$container.focus()):!e.ctrlKey&&!e.metaKey||e.keyCode!=a.webUtils.KEY_CODES.c&&e.keyCode!=a.webUtils.KEY_CODES.v&&e.keyCode!=a.webUtils.KEY_CODES.x||0!=a.JQuery(e.target).closest(".section-files").length||this.active.onKeydown(e);else{e.preventDefault();var t=this.getFocusedElementOrDefault();e.shiftKey?t==s.SIDEBAR?this.switchToPanel(s.PREVIEW,!0):t==s.FILES_LIST?this.switchToPanel(s.SIDEBAR,!0):t==s.PREVIEW&&this.switchToPanel(s.FILES_LIST,!0):t==s.SIDEBAR?this.switchToPanel(s.FILES_LIST,!0):t==s.FILES_LIST?this.switchToPanel(s.PREVIEW,!0):t==s.PREVIEW&&this.switchToPanel(s.SIDEBAR,!0)}},t.prototype.switchToPanel=function(e,t){this.$main.find(".focus-hightlight").remove();var n=a.JQuery('<div class="focus-hightlight"></div>'),i=this.getFocusedElement();if(e==s.PREVIEW){this.triggerEvent("activatePreview");var o=this.$main.find(".iframe-container.active iframe")[0];if(o&&o.contentWindow){o.contentWindow.focus();try{var l=o.contentWindow.privmxViewRequire("Starter").Starter.viewInstance;l.focus&&l.focus()}catch(e){f.error("Cannot call focus method in view")}}else this.$main.find(".preview-container").focus()}else i!=e&&(e==s.SIDEBAR?this.sidebar.$container.focus():e==s.FILES_LIST&&this.active.$container.focus());t&&(e==s.PREVIEW?this.filesVerticalSplitter.$right.append(n):e==s.SIDEBAR?this.$main.find(".sidebar-container").append(n):e==s.FILES_LIST&&this.filesVerticalSplitter.$left.append(n)),setTimeout((function(){n.remove()}),500)},t.prototype.switchPanelFromPreview=function(e){e?this.switchToPanel(s.FILES_LIST,!0):this.switchToPanel(s.SIDEBAR,!0)},t.prototype.grabFocus=function(e){void 0===e&&(e=!0),this.switchToPanel(this.getFocusedElementOrDefault(),e)},t.prototype.changeIsSearchOn=function(e){this.isSearchOn=e,this.sidebar.$container.toggleClass("search-on",e),this.personsComponent.refreshAvatars()},t.prototype.updateSetting=function(e,t){"show-file-preview"==e&&this.updateShowFilePreview(t)},t.prototype.updateShowFilePreview=function(e){this.filesVerticalSplitter.$component.toggleClass("show-file-preview",e),this.filesVerticalSplitter.$component.toggleClass("hide-file-preview",!e)},t.prototype.setPreviewTrashedInfo=function(e){var t=e?JSON.parse(e):null,n=this.$trashedInfo;if(t){var i=t.who,o=t.when?this.helper.calendarDate(t.when):null,s=t.fullSectionName,a=!!i;n.html(this.helper.i18n("plugin.notes2.window.notes2.trashedInfo."+(a?"full":"onlySection"),this.helper.escapeHtml(s),this.helper.escapeHtml(i),this.helper.escapeHtml(o)))}else n.empty()},t.prototype.expandRemoteSectionsList=function(e,t){var n=this;this.isRemoteHostVisible(t)?this.toggleRemoteHost(t,!1):(this.sidebar.showHostLoading(t,!1),a.Q().then((function(){if(n.remoteServers||(n.remoteServers={}),!(t in n.remoteServers)){var i=n.$main.find(".host-element[data-host-id='"+t+"']");return n.remoteListsExists(t)?void 0:a.Q().then((function(){i.parent().append(a.JQuery("<div class='remote-sections' data-host-id='"+t+"'></div>")),i.parent().append(a.JQuery("<div class='remote-conversations' data-host-id='"+t+"'></div>"));var o={host:e,sectionsList:n.addComponent("remoteSectionsList-"+t,new a.component.remotesectionlist.RemoteSectionListView(n,{extList:{template:null}})),conv2List:n.addComponent("remoteConv2List-"+t,new a.component.remoteconv2list.RemoteConv2ListView(n,{personsView:n.personsComponent,extList:{template:null}}))};return o.sectionsList.sections.$container=i.parent().find(".remote-sections[data-host-id='"+t+"']"),o.conv2List.conversations.$container=i.parent().find(".remote-conversations[data-host-id='"+t+"']"),n.sidebar.remoteSectionLists[t]=o.sectionsList,n.sidebar.remoteConv2Lists[t]=o.conv2List,n.remoteServers[t]=o,a.Q.all([o.sectionsList.triggerInit(),o.conv2List.triggerInit()])}))}})).then((function(){n.toggleRemoteHost(t,!0)})))},t.prototype.toggleRemoteHost=function(e,t){var n=this.$main.find(".host-element[data-host-id='"+e+"']");n.parent().find(".remote-sections[data-host-id='"+e+"']").toggleClass("hide",!t),n.parent().find(".remote-conversations[data-host-id='"+e+"']").toggleClass("hide",!t),this.sidebar.hostList.toggleHostElementIsExpanded(e,t)},t.prototype.isRemoteHostVisible=function(e){return!this.$main.find(".host-element[data-host-id='"+e+"']").find(".fa.expanded").hasClass("hide")},t.prototype.remoteListsExists=function(e){return this.$main.find(".host-element[data-host-id='"+e+"']").parent().find(".remote-sections[data-host-id='"+e+"']").length>0},t.prototype.hideLoading=function(){this.loading.onFinishedLoading()},t.SIDEBAR_MIN_WIDTH=100,t.FILESLIST_MIN_WIDTH=220,t.PREVIEW_MIN_WIDTH=100,t}(a.window.base.BaseAppWindowView);n.Notes2WindowView=u,u.prototype.className="com.privmx.plugin.notes2.window.notes2.Notes2WindowView"},{"../../component/fileslist/FilesListView":3,"./template/directory-preview.html":37,"./template/editor-loader.html":38,"./template/empty-preview.html":39,"./template/main.html":40,"pmc-web":1}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('<div class="directory-preview table-layout">\n  <div class="inner-1">\n    <div class="inner-2">\n      <div class="name">\n        <i class="fa fa-folder"></i>\n        <div class="text">'),o(n.escapeHtml(e.name)),o('</div>\n      </div>\n      <div class="file-info">\n        <div class="entry">\n          '),o(n.escapeHtml(n.i18n("plugin.notes2.window.notes2.directoryPreview.elements"))),o(":\n          "),o(n.escapeHtml(e.fileCount)),o('\n        </div>\n        <div class="entry">\n          '),o(n.escapeHtml(n.i18n("plugin.notes2.window.notes2.directoryPreview.size"))),o(":\n          "),o(n.escapeHtml(0==e.size?"0 KB":n.bytesSize(e.size))),o("\n        </div>\n      </div>\n    </div>\n  </div>\n</div>"),i}}},{}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="";return i+='<div class="editor-loader hide table-layout">\n  <div class="inner-1">\n    <div class="inner-2">\n    </div>\n  </div>\n</div>'}}},{}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('<div class="empty-info table-layout">\n  <div class="inner-1">\n    <div class="inner-2">\n      '),o(n.escapeHtml(n.i18n("plugin.notes2.window.notes2.preview.empty"))),o("\n    </div>\n  </div>\n</div>"),i}}},{}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="";return i+='<div class="app">\n  <div class="app-nav-bar"></div>\n\n  <div class="app-main-container window-notes2-main with-aside">\n  </div>\n</div>\n'}}},{}],41:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s=e("pmc-web"),a=e("./template/main.html"),l=e("./template/fileItem.html"),r=e("./template/empty.html"),c=function(e){function t(t){var n=e.call(this,t,a.func)||this;return n.personsComponent=n.addComponent("personsComponent",new s.component.persons.PersonsView(n,n.helper)),n.recentList=n.addComponent("recentList",new s.component.extlist.ExtListView(n,{template:l.func,emptyTemplate:r.func,extra:n.templateManager.createTemplate(s.component.template.conversation)})),n.recentList.addEventListener("ext-list-change",n.onAfterVersionListRender.bind(n)),n.notifications=n.addComponent("notifications",new s.component.notification.NotificationView(n,{xs:!0})),n}return o(t,e),t.prototype.initWindow=function(){var e=this;return s.Q().then((function(){return e.turnTimeAgoRefresher(),e.$main.on("click","[data-file-id]",e.onFileClick.bind(e)),e.$main.on("click","[data-action='open']",e.onOpenClick.bind(e)),e.$main.on("click","[data-action='close']",e.onCloseClick.bind(e)),e.$main.on("click","[data-action='clear-list']",e.onClearListClick.bind(e)),e.$main.on("click","[data-action='refresh']",e.onRefreshClick.bind(e)),s.JQuery(document).on("keydown",e.onKeyDown.bind(e)),e.personsComponent.$main=e.$main,e.recentList.$container=e.$main.find("tbody"),s.Q.all([e.personsComponent.triggerInit(),e.recentList.triggerInit()])})).then((function(){return e.notifications.$container=e.$main.find(".notifications-container"),e.notifications.triggerInit()})).then((function(){e.personsComponent.refreshAvatars(),e.$main.focus()}))},t.prototype.onKeyDown=function(e){e.keyCode===s.webUtils.KEY_CODES.upArrow?(e.preventDefault(),this.triggerEvent("selectUp")):e.keyCode===s.webUtils.KEY_CODES.downArrow?(e.preventDefault(),this.triggerEvent("selectDown")):e.keyCode===s.webUtils.KEY_CODES.enter?(e.preventDefault(),this.triggerEvent("openSelected")):e.keyCode===s.webUtils.KEY_CODES.escape&&(e.preventDefault(),this.triggerEvent("close"))},t.prototype.onFileClick=function(e){var n=this,i=s.JQuery(e.target).closest("[data-file-id]").data("file-id"),o=s.JQuery(e.target).closest("[data-file-did]").data("file-did");this.triggerEvent("setActive",i,o),this.lastClickTid&&this.lastClickId==i?(clearTimeout(this.lastClickTid),this.lastClickTid=null,this.lastClickId=null,this.triggerEvent("openSelected")):(this.lastClickId=i,this.lastClickTid=setTimeout((function(){n.lastClickTid=null,n.lastClickId=null}),t.DOUBLE_CLICK_TIME))},t.prototype.onOpenClick=function(){this.triggerEvent("openSelected")},t.prototype.onCloseClick=function(){this.triggerEvent("close")},t.prototype.onClearListClick=function(){this.triggerEvent("clearList")},t.prototype.onRefreshClick=function(){this.triggerEvent("refresh")},t.prototype.onAfterVersionListRender=function(){this.recentList.$container.find(".image canvas:not(.resized)").each((function(e,t){s.JQuery(t).addClass("resized").attr("data-width","16").attr("data-height","16").attr("width","16").attr("height","16")})),this.recentList.$container.find(".avatar-2 canvas:not(.resized)").each((function(e,t){s.JQuery(t).addClass("resized").attr("data-width","8").attr("data-height","8").attr("width","8").attr("height","8")})),this.personsComponent.refreshAvatars(),this.scrollTo(this.$main.find(".active"));var e=1==this.recentList.$container.children(".empty").length;this.$main.find("button[data-action=open]").prop("disabled",e),this.$main.find(".button-clear-list").toggleClass("disabled",e)},t.prototype.scrollTo=function(e){if(0!=e.length){var t=this.$main.find(".table-container")[0],n=e[0].getBoundingClientRect(),i=t.getBoundingClientRect();n.bottom>i.bottom&&t.scrollTo(0,t.scrollTop+(n.bottom-i.bottom)),n.top<i.top&&t.scrollTo(0,t.scrollTop-(i.top-n.top))}},t.prototype.recentFilesListLoaded=function(){this.$main.addClass("recent-files-list-loaded")},t.prototype.recentFilesListLoading=function(){this.$main.removeClass("recent-files-list-loaded")},t.prototype.setRefreshing=function(e){this.$main.toggleClass("refreshing",e),this.$main.find(".loading-container .fa").toggleClass("fa-spin",e)},t.DOUBLE_CLICK_TIME=400,t}(s.window.base.BaseWindowView);n.RecentFilesWindowView=c,c.prototype.className="com.privmx.plugin.notes2.window.recentfiles.RecentFilesWindowView"},{"./template/empty.html":42,"./template/fileItem.html":43,"./template/main.html":44,"pmc-web":1}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('<div class="empty">\n  <span class="no-files">'),o(n.escapeHtml(n.i18n("plugin.notes2.window.recentfiles.nofiles.label"))),o('</span>\n  <span class="loading"><i class="fa fa-circle-o-notch fa-spin"></i></span>\n</div>'),i}}},{}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('<tr class="recentfiles-file '),o(n.escapeHtml(t.isActive?"active":"")),o('" data-file-id="'),o(n.escapeHtml(e.fileId)),o('" data-file-did="'),o(n.escapeHtml(e.did)),o('">\n  <td class="name">\n    <i class="'),o(n.escapeHtml(e.icon)),o('"></i>\n    '),o(n.escapeHtml(e.fileName)),o('\n  </td>\n  <td class="date">\n    <div title="'),o(n.escapeHtml(n.dateWithHourLocal(e.modified))),o('" data-timeago-type="calendarDate" data-timeago="'),o(n.escapeHtml(e.modified)),o('">\n      '),o(n.escapeHtml(n.calendarDate(e.modified))),o('\n    </div>\n  </td>\n  <td class="source">\n    '),"channel"==e.id&&(o("\n      "),"<my>"==e.channelName?(o('\n        <li class="conversation-element contact without-description" data-conversation-id="'),o(n.escapeHtml(e.hashmail)),o('">\n          <span>\n            <div class="image-with-data">\n              <p class="image">\n                <canvas class="not-rendered" data-tooltip-trigger="'),o(n.escapeHtml(e.hashmail)),o('" data-hashmail-image="'),o(n.escapeHtml(e.hashmail)),o('" data-width="16" data-height="16" data-auto-size="true" data-auto-refresh="true" width="16" height="16"></canvas>\n              </p>\n              <div class="text-col">\n                <p class="name">\n                  '),o(n.escapeHtml(n.i18n("plugin.notes2.window.recentfiles.filter.my"))),o("\n                </p>\n              </div>\n            </div>\n          </span>\n        </li>\n      ")):(o('\n        <div class="wi-element">\n          <div class="wi-element-inner">\n            <div class="wi-element-icon bckg-icon bckg-icon-small bckg-icon-inverse2 '),o(n.escapeHtml("private"==e.channelScope?"bckg-icon-border":"")),o('">\n              <img src="'),o(n.escapeHtml(n.getAssetByName("DEFAULT_PRIVMX_ICON"))),o('" />\n            </div>\n            <div class="wi-element-name">\n              '),o(n.escapeHtml(e.channelName)),o("\n            </div>\n          </div>\n        </div>\n      ")),o("\n    ")),o("\n    "),"local"==e.id&&(o('\n      <div class="local-files-info">\n        <i class="fa fa-desktop"></i> '),o(n.escapeHtml(n.i18n("plugin.notes2.window.recentfiles.filter.local",e.systemLabel))),o("\n      </div>\n    ")),o("\n    "),"conversation"==e.id&&(o("\n      "),o(t.listView.extra.render(e.convModel,{})),o("\n    ")),o("\n  </td>\n</tr>"),i}}},{}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.func={helper:"com.privmx.core.web-utils.MailClientViewHelper",func:function(e,t,n){var i="",o=function(e){i+=e};return o('<div class="window-recentfiles-main" tabindex="-1">\n  <div class="header">\n    '),o(n.escapeHtml(n.i18n("plugin.notes2.window.recentfiles.title"))),o('\n    <span class="btn btn-sm refresh" data-action="refresh">\n      <i class="fa fa-refresh"></i>\n    </span>\n  </div>\n  <div class="table-container">\n    <table>\n      <tbody>\n      </tbody>\n    </table>\n  </div>\n  <div class="buttons-container">\n    <div class="buttons">\n      <button class="btn btn-success" data-action="open" tabindex="2">\n        <i class="fa fa-check"></i>\n        '),o(n.escapeHtml(n.i18n("plugin.notes2.window.recentfiles.button.ok.label"))),o('\n      </button>\n      <button class="btn btn-default" data-action="close" tabindex="3">\n        '),o(n.escapeHtml(n.i18n("plugin.notes2.window.recentfiles.button.close.label"))),o('\n      </button>\n      <span class="link button-clear-list" data-action="clear-list">\n        <i class="fa fa-trash"></i> '),o(n.escapeHtml(n.i18n("plugin.notes2.window.recentfiles.clearList"))),o('\n      </span>\n    </div>\n  </div>\n  <div class="tab-index-guard" tabindex="999"></div>\n  <div class="notifications-container"></div>\n  <div class="loading-container">\n    <span class="loading"><i class="fa fa-circle-o-notch"></i></span>\n  </div>\n</div>\n'),i}}},{}]},{},[2]);
//# sourceMappingURL=view.js.map
