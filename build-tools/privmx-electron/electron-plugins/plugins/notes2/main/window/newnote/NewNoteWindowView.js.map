{"version":3,"sources":["window/newnote/NewNoteWindowView.ts"],"names":[],"mappings":"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","file":"NewNoteWindowView.js","sourcesContent":["import {component, JQuery as $, webUtils, window, Types, Q} from \"pmc-web\";\nimport {func as mainTemplate} from \"./template/main.html\";\nimport {func as channelTemplate} from \"./template/channel.html\";\nimport {Model} from \"./NewNoteWindowController\";\n\nexport class NewNoteWindowView extends window.base.BaseWindowView<Model> {\n    \n    conversations: component.conv2list.Conv2ListView;\n    personsComponent: component.persons.PersonsView;\n    currentActionId: string;\n    inputModified: boolean = false;\n    \n    constructor(parent: Types.app.ViewParent) {\n        super(parent, mainTemplate);\n        this.personsComponent = this.addComponent(\"personsComponent\", new component.persons.PersonsView(this, this.helper));\n        \n        this.conversations = this.addComponent(\"conversations\", new component.conv2list.Conv2ListView(this, {\n            personsView: this.personsComponent,\n            extList: {\n                template: null\n            }\n        }));\n    }\n    \n    initWindow(model: Model): Q.Promise<void> {\n        return Q().then(() => {\n            this.$main.on(\"click\", \".type\", this.onTypeClick.bind(this));\n            this.$main.on(\"click\", \"[data-action=create]\", this.onCreateClick.bind(this));\n            this.$main.on(\"click\", \"[data-action=cancel]\", this.onCancelClick.bind(this));\n            this.$main.on(\"click\", \"[data-conversation-id]\", this.onConversationClick.bind(this));\n            this.$body.on(\"keydown\", this.onKeyDown.bind(this));\n            this.$main.find(\".type\").first().click();\n            this.$main.find(\".name input\").on(\"input\", () => {\n                this.inputModified = true;\n            })\n            this.personsComponent.$main = this.$main;\n            return this.personsComponent.triggerInit();\n        })\n        .then(() => {\n            this.conversations.conversations.$container = this.$main.find(\".conversations\");\n            return this.conversations.triggerInit();\n        })\n        .then(() => {\n            let $channels = this.$main.find(\".channels\");\n            let channelTmpl = this.templateManager.createTemplate(channelTemplate);\n            model.channels.forEach(c => {\n                $channels.append(channelTmpl.renderToJQ(c));\n            });\n            this.setActive(model.defaultDestination);\n            this.bindKeyPresses();\n            this.focusOnInput();\n        })\n    }\n    \n    onTypeClick(event: MouseEvent): void {\n        let $e = $(event.target).closest(\".type\");\n        if ($e.hasClass(\"disabled\")) {\n            return;\n        }\n        this.$main.find(\".types .type\").removeClass(\"active\");\n        $e.addClass(\"active\");\n        this.currentActionId = $e.data(\"action-id\");\n        this.triggerEvent(\"chooseAction\", $e.data(\"action-id\"), undefined, true);\n        this.setName($e.data(\"default-name\"));\n        this.focusOnInput();\n    }\n\n    getCurrentSelectedType() {\n        return this.$main.find(\".types .type.active\");\n    }\n\n    onTypeSwitch(): void {\n        let $current = this.getCurrentSelectedType();\n        let $list = $current.parent().find(\".type\");\n        let index = $list.index($current);\n        \n        index++;\n        if (index >= $list.length) {\n            index = 0;\n        }\n        let $e = $($list.get(index));\n        if ($e.hasClass(\"disabled\")) {\n            return;\n        }\n        this.$main.find(\".types .type\").removeClass(\"active\");\n        $e.addClass(\"active\");\n        this.triggerEvent(\"chooseAction\", $e.data(\"action-id\"));\n        this.currentActionId = $e.data(\"action-id\");\n        this.setName($e.data(\"default-name\"));\n        this.focusOnInput();\n    }\n\n    \n    onCancelClick(): void {\n        this.triggerEvent(\"cancel\");\n    }\n    \n    onCreateClick(): void {\n        this.createFile();\n    }\n    \n    onKeyDown(event: KeyboardEvent): void {\n        if (event.keyCode == 13) {\n            event.preventDefault();\n            this.createFile();\n        }\n    }\n    \n    onConversationClick(event: MouseEvent) {\n        let $e = $(event.target).closest(\"[data-conversation-id]\");\n        this.setActive($e.data(\"conversation-id\"));\n    }\n    \n    setActive(active: string) {\n        this.$main.find(\"[data-conversation-id]\").removeClass(\"active\");\n        let $e = this.$main.find(\"[data-conversation-id='\" + active + \"']\");\n        if ($e.length == 0) {\n            $e = this.$main.find(\"[data-conversation-id='my']\");\n        }\n        $e.addClass(\"active\");\n        let dests = this.$main.find(\".destinations\")[0];\n        dests.scrollTop = $e[0].offsetTop - dests.offsetTop;\n    }\n    \n    setName(name: string) {\n        if (! this.inputModified) {\n            this.$main.find(\".name input\").val(name);\n        }\n    }\n    \n    createFile(): void {\n        let $input = this.$main.find(\".name input\");\n        let name = <string>$input.val();\n        let actionId = this.$main.find(\".types .type.active\").data(\"action-id\");\n        if (!name) {\n            $input.focus();\n            return;\n        }\n        let destination = this.$main.find(\".active[data-conversation-id]\").data(\"conversation-id\");\n        let openAfterCreate = this.$main.find(\"[data-action=check]\").is(\":checked\");\n        this.triggerEvent(\"createFile\", actionId, destination, name, openAfterCreate);\n    }\n\n    focusOnInput(): void {\n        let $ele = this.$main.find(\".name input\");\n        let filename:string = (<HTMLInputElement>$ele.get(0)).value;\n        if (!this.inputModified) {\n\n            if (filename.indexOf(\".\") != -1) {\n                $ele.focus();\n                (<HTMLInputElement>$ele.get(0)).setSelectionRange(0, filename.lastIndexOf(\".\"));\n            }\n            else {\n                $ele.focus().select();\n            }\n          \n        } else {\n            $ele.focus();\n        }\n    }\n    \n    bindKeyPresses(): void {\n        $(document).on(\"keydown\", e => {\n            if (e.keyCode == webUtils.KEY_CODES.tab) {\n                e.preventDefault();\n                this.onTypeSwitch();\n            } else\n            if (e.keyCode == webUtils.KEY_CODES.enter && this.currentActionId.indexOf(\"upload\") > -1) {\n                e.preventDefault();\n                this.triggerEvent(\"uploadActionConfirmed\");\n            } else\n            if (e.keyCode == webUtils.KEY_CODES.escape) {\n                e.preventDefault();\n                this.triggerEvent(\"cancel\");\n            }\n        });\n    }\n    \n}\n\n(<any>NewNoteWindowView.prototype).className = \"com.privmx.plugin.notes2.window.newnote.NewNoteWindowView\";"],"sourceRoot":"../../../src"}