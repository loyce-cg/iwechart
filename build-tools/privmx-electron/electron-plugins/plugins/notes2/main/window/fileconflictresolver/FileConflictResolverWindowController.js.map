{"version":3,"sources":["window/fileconflictresolver/FileConflictResolverWindowController.ts"],"names":[],"mappings":"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","file":"FileConflictResolverWindowController.js","sourcesContent":["import {mail, window, Q, Types, privfs, app} from \"pmc-mail\";\nimport {Notes2Plugin} from \"../../main/Notes2Plugin\";\nimport {ConflictType, OperationType} from \"../../main/Common\";\nimport {Helper} from \"../../main/Helper\";\nimport { i18n } from \"./i18n\";\n\nexport interface Model {\n    conflictType: ConflictType;\n    operationType: OperationType;\n    source: {\n        name: string;\n        path: string;\n        icon: string;\n    };\n    destination: {\n        name: string;\n        path: string;\n        icon: string;\n    };\n}\n\nexport interface FCRResult {\n    abort: boolean;\n    behaviour: boolean;\n    forAll: boolean;\n}\n\nexport class FileConflictResolverWindowController extends window.base.BaseWindowController {\n    \n    static textsPrefix: string = \"plugin.notes2.window.fileconflictresolver.\";\n    \n    static registerTexts(localeService: mail.LocaleService): void {\n        localeService.registerTexts(i18n, this.textsPrefix);\n    }\n    \n    notes2Plugin: Notes2Plugin;\n    defer: Q.Deferred<FCRResult>;\n    \n    constructor(parentWindow: Types.app.WindowParent, public model: Model) {\n        super(parentWindow, __filename, __dirname);\n        this.ipcMode = true;\n        this.setPluginViewAssets(\"notes2\");\n        this.notes2Plugin = this.app.getComponent(\"notes2-plugin\");\n        this.openWindowOptions = {\n            modal: true,\n            toolbar: false,\n            show: false,\n            position: \"center\",\n            width: 500,\n            height: 400,\n            widget: false,\n            draggable: false,\n            resizable: false,\n            title: this.i18n(\"plugin.notes2.window.fileconflictresolver.title\")\n        };\n        this.defer = Q.defer<FCRResult>();\n    }\n    \n    getPromise() {\n        return this.defer.promise;\n    }\n    \n    getModel(): Model {\n        return this.model;\n    }\n    \n    beforeClose(): Q.IWhenable<void> {\n        this.defer.resolve({\n            abort: true,\n            behaviour: null,\n            forAll: false\n        });\n    }\n    \n    onViewAbort() {\n        this.close();\n    }\n    \n    onViewOmit(forAll: boolean) {\n        this.defer.resolve({\n            abort: false,\n            behaviour: false,\n            forAll: forAll\n        });\n        this.close();\n    }\n    \n    onViewOverwrite(forAll: boolean) {\n        this.defer.resolve({\n            abort: false,\n            behaviour: true,\n            forAll: forAll\n        });\n        this.close();\n    }\n    \n    static convertModel(result: privfs.fs.file.multi.OperationResult, app: app.common.CommonApplication): Model {\n        let conflictType = Helper.convertConflictType(result.status);\n        let dstIsFolder = conflictType == ConflictType.DIRECTORIES_MERGE || conflictType == ConflictType.DIRECTORY_OVERWRITE_BY_FILE;\n        let srcIsFolder = conflictType == ConflictType.DIRECTORIES_MERGE || conflictType == ConflictType.FILE_OVERWRITE_BY_DIRECTORY;\n        let model: Model = {\n            conflictType: conflictType,\n            operationType: Helper.convertOperationType(result.operation.type),\n            source: {\n                name: mail.filetree.Path.parsePath(result.operation.source.path).name.original,\n                path: result.operation.source.path,\n                icon: srcIsFolder ? \"fa fa-folder\" : app.shellRegistry.resolveIcon(mail.filetree.MimeType.resolve(result.operation.source.path)),\n            },\n            destination: {\n                name: mail.filetree.Path.parsePath(result.operation.destination.path).name.original,\n                path: result.operation.destination.path,\n                icon: dstIsFolder ? \"fa fa-folder\" : app.shellRegistry.resolveIcon(mail.filetree.MimeType.resolve(result.operation.destination.path)),\n            }\n        };\n        return model;\n    }\n}\n\n(<any>FileConflictResolverWindowController.prototype).className = \"com.privmx.plugin.notes2.window.fileconflictresolver.FileConflictResolverWindowController\";"],"sourceRoot":"../../../src"}