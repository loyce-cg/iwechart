{"version":3,"sources":["window/recentfiles/RecentFilesWindowView.ts"],"names":[],"mappings":"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","file":"RecentFilesWindowView.js","sourcesContent":["import {component, JQuery as $, webUtils, window, Types, Q} from \"pmc-web\";\nimport {func as mainTemplate} from \"./template/main.html\";\nimport {func as fileItemTemplate} from \"./template/fileItem.html\";\nimport {func as emptyTemplate} from \"./template/empty.html\";\n\nimport {EntryViewModel} from \"./RecentFilesWindowController\";\n\nexport class RecentFilesWindowView extends window.base.BaseWindowView<void> {\n    \n    static DOUBLE_CLICK_TIME = 400;\n    \n    personsComponent: component.persons.PersonsView;\n    recentList: component.extlist.ExtListView<EntryViewModel>;\n    notifications: component.notification.NotificationView;\n    lastClickTid: NodeJS.Timer;\n    lastClickId: string;\n    \n    constructor(parent: Types.app.ViewParent) {\n        super(parent, mainTemplate);\n        this.personsComponent = this.addComponent(\"personsComponent\", new component.persons.PersonsView(this, this.helper));\n        this.recentList = this.addComponent(\"recentList\", new component.extlist.ExtListView(this, {\n            template: fileItemTemplate,\n            emptyTemplate: emptyTemplate,\n            extra: <any>this.templateManager.createTemplate(component.template.conversation)\n        }));\n        this.recentList.addEventListener(\"ext-list-change\", this.onAfterVersionListRender.bind(this));\n        this.notifications = this.addComponent(\"notifications\", new component.notification.NotificationView(this, {xs: true}));\n    }\n    \n    initWindow(): Q.Promise<void> {\n        return Q().then(() => {\n            this.turnTimeAgoRefresher();\n            this.$main.on(\"click\", \"[data-file-id]\", this.onFileClick.bind(this));\n            this.$main.on(\"click\", \"[data-action='open']\", this.onOpenClick.bind(this));\n            this.$main.on(\"click\", \"[data-action='close']\", this.onCloseClick.bind(this));\n            this.$main.on(\"click\", \"[data-action='clear-list']\", this.onClearListClick.bind(this));\n            this.$main.on(\"click\", \"[data-action='refresh']\", this.onRefreshClick.bind(this));\n            $(document).on(\"keydown\", this.onKeyDown.bind(this));\n            this.personsComponent.$main = this.$main;\n            this.recentList.$container = this.$main.find(\"tbody\");\n            \n            return Q.all([\n                this.personsComponent.triggerInit(),\n                this.recentList.triggerInit()\n            ]);\n        })\n        .then(() => {\n            this.notifications.$container = this.$main.find(\".notifications-container\");\n            return this.notifications.triggerInit();\n        })\n        .then(() => {\n            this.personsComponent.refreshAvatars();\n            this.$main.focus();\n        });\n    }\n    \n    onKeyDown(e: KeyboardEvent): void {\n        if (e.keyCode === webUtils.KEY_CODES.upArrow) {\n            e.preventDefault();\n            this.triggerEvent(\"selectUp\");\n        }\n        else if (e.keyCode === webUtils.KEY_CODES.downArrow) {\n            e.preventDefault();\n            this.triggerEvent(\"selectDown\");\n        }\n        else if (e.keyCode === webUtils.KEY_CODES.enter) {\n            e.preventDefault();\n            this.triggerEvent(\"openSelected\");\n        }\n        else if (e.keyCode === webUtils.KEY_CODES.escape) {\n            e.preventDefault();\n            this.triggerEvent(\"close\");\n        }\n    }\n    \n    onFileClick(e: MouseEvent): void {\n        let id = $(e.target).closest(\"[data-file-id]\").data(\"file-id\");\n        let did = $(e.target).closest(\"[data-file-did]\").data(\"file-did\");\n        this.triggerEvent(\"setActive\", id, did);\n        if (this.lastClickTid && this.lastClickId == id) {\n            clearTimeout(this.lastClickTid);\n            this.lastClickTid = null;\n            this.lastClickId = null;\n            this.triggerEvent(\"openSelected\");\n        }\n        else {\n            this.lastClickId = id;\n            this.lastClickTid = setTimeout(() => {\n                this.lastClickTid = null;\n                this.lastClickId = null;\n                //Single click - do nothing, active already selected\n            }, RecentFilesWindowView.DOUBLE_CLICK_TIME);\n        }\n    }\n    \n    onOpenClick(): void {\n        this.triggerEvent(\"openSelected\");\n    }\n    \n    onCloseClick() {\n        this.triggerEvent(\"close\");\n    }\n    \n    onClearListClick(): void {\n        this.triggerEvent(\"clearList\");\n    }\n    \n    onRefreshClick(): void {\n        this.triggerEvent(\"refresh\");\n    }\n    \n    onAfterVersionListRender() {\n        this.recentList.$container.find(\".image canvas:not(.resized)\").each((_i, e) => {\n            $(e).addClass(\"resized\").attr(\"data-width\", \"16\").attr(\"data-height\", \"16\").attr(\"width\", \"16\").attr(\"height\", \"16\");\n        });\n        this.recentList.$container.find(\".avatar-2 canvas:not(.resized)\").each((_i, e) => {\n            $(e).addClass(\"resized\").attr(\"data-width\", \"8\").attr(\"data-height\", \"8\").attr(\"width\", \"8\").attr(\"height\", \"8\");\n        });\n        this.personsComponent.refreshAvatars();\n        this.scrollTo(this.$main.find(\".active\"));\n        \n        let isEmpty = this.recentList.$container.children(\".empty\").length == 1;\n        this.$main.find(\"button[data-action=open]\").prop(\"disabled\", isEmpty);\n        this.$main.find(\".button-clear-list\").toggleClass(\"disabled\", isEmpty);\n    }\n    \n    scrollTo($ele: JQuery): void {\n        if ($ele.length == 0) {\n            return;\n        }\n        let ch = this.$main.find(\".table-container\")[0];\n        let eBB = $ele[0].getBoundingClientRect();\n        let lBB = ch.getBoundingClientRect();\n        if (eBB.bottom > lBB.bottom) {\n            ch.scrollTo(0, ch.scrollTop + (eBB.bottom - lBB.bottom));\n        }\n        if (eBB.top < lBB.top) {\n            ch.scrollTo(0, ch.scrollTop - (lBB.top - eBB.top));\n        }\n    }\n    \n    recentFilesListLoaded(): void {\n        this.$main.addClass(\"recent-files-list-loaded\");\n    }\n    \n    recentFilesListLoading(): void {\n        this.$main.removeClass(\"recent-files-list-loaded\");\n    }\n    \n    setRefreshing(refreshing: boolean): void {\n        this.$main.toggleClass(\"refreshing\", refreshing);\n        this.$main.find(\".loading-container .fa\").toggleClass(\"fa-spin\", refreshing);\n    }\n    \n}\n\n(<any>RecentFilesWindowView.prototype).className = \"com.privmx.plugin.notes2.window.recentfiles.RecentFilesWindowView\";"],"sourceRoot":"../../../src"}